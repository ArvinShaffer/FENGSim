\chapter{数值算例报告}
\label{ch:gallery}

\clearpage

\begin{align}
  x'(t) = f(t,x)
\end{align}
\begin{align}
  F(x,x',t) = 0
\end{align}
$t$是时间，$x$是向量，$x'$是导数。

\begin{subequations}
  \begin{align}
    x''(t) + y(t) = \cos(t)\\
    x(t) = \cos(t)
  \end{align}
\end{subequations}

\begin{subequations}
  \begin{align}
    x'''(t) + y'(t) = \sin(t)\\
    x(t) = \cos(t)
  \end{align}
\end{subequations}

\begin{subequations}
  \begin{align}
    x'''(t) + y'(t) = \sin(t)\\
    x'''(t) = \sin(t)
  \end{align}
\end{subequations}

\begin{subequations}
  \begin{align}
    x'''(t) + y'(t) = \sin(t)\\
    y'(t) = -2\sin(t)
  \end{align}
\end{subequations}


  \begin{align}
    x_{n+1} = x_n-\frac{f(x_n)}{f'(x_n)}
  \end{align}





\clearpage

\section{Delaunay网格剖分算法}

\subsection{Delaunay Triangulation}
Delaunay网格剖分介绍见\cite{FreyGeorge,GeorgeBorouchaki}。
Delaunay网格具备各种优异特点，最重要的是在点集可能形成的三角网格中，Delaunay网格三角形的最小角最大，是最接近规则化的的三角网格。
Delaunay网格有两种定义方法，一种是根据Voronoi图定义，一种是根据Delaunay准则定义，如定义\ref{def:3-1:1}和\ref{def:3-1:2}。

\begin{definition}
  Voronoi图是由连接两邻点直线的垂直平分线组成的连续多边形组成。
\end{definition}

\begin{definition}\label{def:3-1:1}
  Voronoi图的每一个多边形对应一个点，Delaunay网格是由相邻Voronoi多边形对应的点连接而成的三角形组成，Delaunay网格是Voronoi图的偶图。
\end{definition}

\begin{definition}\label{def:3-1:2}
  Delaunay网格的每个三角形的外接圆不包含面内的其他任何点, 称之为Delaunay准则。
\end{definition}

\subsection{Delaunay Meshing}
从点集生成Delaunay网格的方法包括Incremental Method, Edge Swap, Divide and Conquer和Sweeping方法。
根据Delaunay准则定义Delaunay Kernel，Incremental Method根据Delaunay Kernel逐步建立网格。
Incremental Method中插入点如在Convex Hull外需要更新Convex Hull, 因此用一个Box来封装所有点避免这种情况, 叫做Reduced Incremental Method。

\begin{definition}
  $\mathcal T_{i}$和$\mathcal T_{i+1}$是$P$插入前后网格，$\mathcal C_P$是由$\mathcal T_{i}$中外接圆包括$P$的三角形组成，$\mathcal B_P$是由$P$连接
  $\mathcal C_P$的外侧边形成的三角形组成。
  \begin{align}
    \mathcal T_{i+1} =     \mathcal T_{i} -\mathcal C_P + \mathcal B_P
  \end{align}
\end{definition}

\begin{algorithm}
  \caption{reduced incremental algorithm}  
  \begin{algorithmic}[1]
    \Require A set $P$ of $n$ points in the plane.
    \Ensure A Delaunay triangulation of $P$
    \State Let $p_{-1}$, $p_{-2}$ and $p_{-3}$ be a suitable set of three points such that $P$ is contained in the triangle $p_{-1}p_{-2}p_{-3}$.
    \State Initialize $\mathcal T$ as the triangulation consisting of the single triangle $p_{-1}p_{-2}p_{-3}$.
    \State Compute a random permutation $p_{1},p_{2},\cdots,p_{n}$ of $P$.
    \For{$r=1,\cdots,n$}
    \State Find a triangle $p_ip_jp_k\in\mathcal T$ containing $p_r$.
    \If{$p_r$ lies in the interior of the triangle $p_ip_jp_k$}
    \State Add edges from $p_r$ to the three vertices of $p_ip_jp_k$, thereby splitting $p_ip_jp_k$ into three triangles.
    \State LEGALIZEEDGE($p_r$, $p_ip_j$, $\mathcal T$)
    \State LEGALIZEEDGE($p_r$, $p_ip_k$, $\mathcal T$)
    \State LEGALIZEEDGE($p_r$, $p_jp_k$, $\mathcal T$)
    \Else{ $p_r$ lies on an edge of $p_ip_jp_k$, say the edge $p_ip_j$}
    \State Add edges from $p_r$ to $p_k$ and to the third vertex $p_l$ of the other triangle that is incident to $p_ip_j$, thereby splitting the two triangles
    incident to $p_ip_j$ into four triangles.
    \State LEGALIZEEDGE($p_r$, $p_ip_k$, $\mathcal T$)
    \State LEGALIZEEDGE($p_r$, $p_jp_k$, $\mathcal T$)
    \State LEGALIZEEDGE($p_r$, $p_ip_l$, $\mathcal T$)
    \State LEGALIZEEDGE($p_r$, $p_jp_l$, $\mathcal T$)
    \EndIf
    \EndFor
    \State Discard $p_{-1}$, $p_{-2}$ and $p_{-3}$ with all their incident edges from $\mathcal T$.
  \end{algorithmic}
 \label{al:3-1:1}
\end{algorithm}

\begin{algorithm}  
  \caption{legalize edge}  
  \begin{algorithmic}[1]
    \If{$p_ip_j$ is illegal}
    \State Let $p_ip_jp_k$ be the triangle adjacent to $p_ip_jp_r$ along $p_ip_j$.
    \State Replace $p_ip_j$ with $p_rp_k$.
    \State LEGALIZEEDGE($p_r$, $p_ip_k$, $\mathcal T$)
    \State LEGALIZEEDGE($p_r$, $p_jp_k$, $\mathcal T$)
    \EndIf
  \end{algorithmic}
  \label{al:3-1:2}
\end{algorithm}

Incremental Method详细见\cite{BergKreveldOvermarsSchwarzkopf}，算法\ref{al:3-1:1}和\ref{al:3-1:2}中可以看出，需要一个查询算法（point locate）确定插入点所在的网格单元，
对于三角形网格单元，需要知道三个顶点和相邻的网格单元，网格顶点对应一个关联的网格单元， 根据这个网格单元可以得到其他关联的网格单元，需要添加删除和修改网格单元和顶点，等等这些都反映在网格的数据结构中。
\ref{fig:3.1:1a}是初始的三点和外接圆，\ref{fig:3.1:1b}采用Incremental Method插入一点，但并没有采用Delaunay Kernek去检查，\ref{fig:3.1:1c}采用Incremental Method插入一点并采用Delaunay Kernek检查。
\begin{figure}[!htbp]
  \centering
  \subfigure[初始三点]{
    \label{fig:3.1:1a}
    \includegraphics[height=4cm]{fig/3/3.1/0.png}
    }\qquad
  \subfigure[Incremental Method网格]{
    \label{fig:3.1:1b}
    \includegraphics[height=4cm]{fig/3/3.1/1.png}}
  \qquad
  \subfigure[Delaunay网格]{
    \label{fig:3.1:1c}
  \includegraphics[height=4cm]{fig/3/3.1/2.png}}
  \caption{CGAL中的Incremental Method网格剖分和Delaunay网格剖分}
\end{figure}

\begin{figure}[!htbp]
  \centering
  \subfigure[Incremental Method网格]{
    \label{fig:3.1:1}
    \includegraphics[height=4cm]{fig/3/3.1/3.png}
    }\qquad
  \subfigure[Delaunay网格]{
    \label{fig:3.1:2}
  \includegraphics[height=4cm]{fig/3/3.1/4.png}}
  \caption{CGAL更大点集的Incremental Method网格剖分和Delaunay网格剖分}
\end{figure}

\subsection{Constrained Delaunay Meshing}
以上是根据已知点集来进行Delaunay网格剖分，对点集经常会有一些约束，例如定义点集的边界, 否则得到的是点集Convex Hull的网格，
又例如定义有限元计算中的材料，在约束条件下得到的是Constrained网格和Constrained Delaunay网格，需要注意的是Constrained网格可能不是Delaunay网格了。约束获取有两种方式：一种是CAD方式，\textcolor{red}{CAD模型是非线性几何方程和边界表示法构成的，约束也是通过几何方程和边界表示法定义的，并没有点集和定义在点集上的约束，首先根据CAD模型生成边界或者界面网格，边界或者界面网格作为约束再进行体网格剖分，点集是根据CAD模型生成的，先有边界点集再有内部点集}。另外一种是三维扫描方式，从扫描图像获取点云，但是没有定义在点云上的约束，对点云进行表面重构，Alpha Shape是一种基于Delaunay Tri的表面重构方法，表面重构得到的边界网格定义约束，再进行体网格剖分，先有边界点集再有内部点集。图\ref{fig:3.1:3a}中红线是定义的约束，但是没有采用带约束算法，所以网格不满足约束，图\ref{fig:3.1:3b}采用了约束算法，网格满足约束。
\begin{figure}[!htbp]
  \centering
  \subfigure[Delaunay网格]{
    \label{fig:3.1:3a}
    \includegraphics[height=4cm]{fig/3/3.1/5.png}
    }\qquad
  \subfigure[Constrained网格]{
    \label{fig:3.1:3b}
    \includegraphics[height=4cm]{fig/3/3.1/6.png}}
  \qquad
  \subfigure[加密网格]{
    \label{fig:3.1:3c}
  \includegraphics[height=4cm]{fig/3/3.1/7.png}}
  \caption{Delaunay网格和Constrained Delaunay网格}
\end{figure}

因此基于Delaunay的网格剖分基本步骤包括，采用Incremental Method或者Reduced Incremental Method对已知点集进行剖分（如果无点集则需要生成，例如CAD模型生成边界网格)，对网格进行强制约束（边界网格，CAD生成边界网格或者三维扫描表面重构），最后根据参数进一步加密和优化，细节见\cite{FreyGeorge}7.3.1节。
\begin{definition}classical Delaunay meshing
  \begin{itemize}
  \item Preparation step.
    \begin{itemize}
    \item Data input: point coordinates, boundary entitites and internal entities (if any),
    \item Construction of a bounding box and meshing of this box by means of a few elements.
    \end{itemize}
  \item Construction of the box mesh.
    \begin{itemize}
    \item Insertion of the given points in the box mesh using the Delaunay kernel.
    \end{itemize}
  \item Construction of the empty mesh (which is boundary conforming).
    \begin{itemize}
    \item Search for the missing specified entitites,
    \item Enforcement of these items,
    \item Definition of the connected components of the domain. 
    \end{itemize}
  \item Inernal point creation and point insertion.
    \begin{itemize}
    \item (1) Internal endges analysis, point creation along these edges.
    \item Point insertion via the Delaunay kernel and return to (1) until edge saturation.
    \end{itemize}
  \item Domain definition
    \begin{itemize}
    \item Removal of the elements exterior to the domain,
    \item Classification of the elements with respect to the connected components.
    \end{itemize}
  \item Optimization
  \end{itemize}
\end{definition}

\newpage
\section{Alpha Shape算法}

表面重构主要文献为\cite{DEY,CazalsGiesen,Alqudah}，
表面重构方法分为两大类，一类是基于Delaunay Tri的方法，一类是基于Implicit Function的方法，思路比较好理解，基于Delaunay Tri的方法是有了点集就可以进行Convex Hull网格剖分，然后去掉多余的网格单元，
基于Implicit Function的方法是根据点集计算边界的近似函数。Alpha Shape主要参考文献为\cite{Fischer,Edelsbrunner}，Edelsbrunner’s Algorithm是主要算法，\cite{Fischer}参考文献列出了Edelsbrunner关于Alpha Shape的主要文章。

\begin{definition}
  $S$是一个点集，$T\subset S$，$|T|=k+1\leq d+1$，$\Delta_T:=\mathrm{conv}(T)$，定义$\Delta_T$是一个\uline{k-simplex}。
\end{definition}

\begin{definition}
For $0 < \lambda < \infty$ let an \underline{$\lambda$-ball} be an open ball with radius $\lambda$.
Furthermore, a 0-ball is a point for us and an $\infty$-ball is an open half-space.
Now, a certain $\lambda$-ball $b$ (at a given location) is called \underline{empty} if $b\bigcap S = \emptyset$. With
this, a $k$-simplex $\Delta T$ is said to be \underline{$\alpha$-exposed} if there exists an empty $\alpha$-ball with
$T = \partial b \bigcap S$ where $\partial b$ is the surface of the sphere (for $d = 3$) or the circle ($d = 2$)
bounding $b$, respectively.
\end{definition}

\begin{definition}\label{def:3-2:2}
\underline{The boundary $\partial S_{\alpha}$} of the $\alpha$-shape of the point set $S$ consists of
all $k$-simplices of $S$ for $0 \leq k < d$ which are $\alpha$-exposed,
$\partial S_{\alpha} = \{\Delta T | T \subset S, |T | \leq d \textrm{ and }  \Delta_T \textrm{ is } \alpha-\textrm{exposed}\}$ .
\end{definition}

\begin{definition}
Given a set $S\subset R^d$ ($d = 2, 3$) in general position, \uline{the Delaunay
triangulation} of $S$ is the simplicial complex $DT(S)$ consisting only of
\begin{enumerate}
\item all $d$-simplices $\Delta T$ with $T\subset S$ such that the circumsphere of $T$ (for $d = 2$
this degenerates to the great circle of $T$ ) does not contain any other points
of $S$, and
\item all $k$-simplices which are faces of other simplices in $DT(S)$.
\end{enumerate}
\end{definition}



\begin{theorem}\label{th:3-2:0}
If $\Delta_T$ is an $\alpha$-exposed simplex of $S$, then $\Delta_T \in DT(S)$.
\end{theorem}

\begin{theorem}\label{th:3-2:1}
For any $0\leq \alpha \leq \infty$ we have $\partial S_{\alpha} \subset DT (S)$.
\end{theorem}

从定理\ref{th:3-2:1}和定义\ref{def:3-2:2}可以产生$S_{\alpha}$，也就是对Delaunay Triangulation中所有$k$-simplex进行$\alpha$-exposed的检查，$k<d$，但是对于$k=0$由于点有无穷多个外接圆，算法上无法实现，
因此定义$\alpha$-complex来调整算法，$\alpha$-complex中包括$d$-simplex和$0$-simplex，$0$-simplex是点，避免了对点的$\alpha$-exposed检查。
\begin{definition}
For a given point set $S\subset R^d$ and $0 \leq \alpha \leq \infty$, \uline{the $\alpha$-complex}
$C_{\alpha}(S)$ of $S$ is the following simplicial subcomplex of $DT(S)$. A simplex $\Delta T \in DT(S)$ is in $C_{\alpha} (S)$ if
\begin{enumerate}
\item $\sigma_T < \alpha$ and the $\sigma_T$ -ball located at $\mu_T$ is empty, or
\item $\Delta T$ is a face of another simplex in $C_{\alpha} (S)$.
\end{enumerate}
\end{definition}

\begin{theorem}\label{th:3-2:2}
  $\partial S_{\alpha}(S) = \partial C_{\alpha}(S)$.
\end{theorem}

\begin{theorem}\label{th:3-2:3}
$\alpha_1\leq\alpha_2 \rightarrow C_{\alpha_1} (S) \subset C_{\alpha_2}(S) \rightarrow S_{\alpha_1}(S)\subset S_{\alpha_2} (S)$.
\end{theorem}

\begin{algorithm}  
  \caption{Edelsbrunner Algorithm}
  \begin{algorithmic}[1]
  \Require given a point set $S\subset R^d$, computes a list $R$ of simplices $\Delta_T$ and two lists $B$, $I$ of intervals such that $\Delta T \in \partial S_{\alpha}$ if and only if $\alpha \in B_T$ and $\Delta_T\in \mathrm{int}(S_{\alpha})$ if and only if $\alpha\in I_T$ .
\State $R:= DT(S)$;
\For{each $d$-simplex $\Delta_T\in R^d$}
\State $B_T := \emptyset$; $I_T := (\sigma_{i}, \infty)$;
\EndFor
\For{$k:=d-1$ to 0 by -1}
\For{each $k$-simplex $\Delta_T\in R$}
\If{$b_T$ is empty}
\State $a:=\sigma_T$;
\Else
\State $a:= \min \{a_U | B_U = (a_U , b_U ), \Delta_U (k + 1)-\mathrm{simplex}, T \subset U \}$;
\EndIf
\If{$\Delta_T\in\partial\mathrm{conv}(S)$}
\State $b:=\infty$
\Else
\State $b:=\max \{a_U | B_U = (a_U , b_U ), \Delta_U (k + 1)-\mathrm{simplex}, T \subset U\}$;
\EndIf
\State $B_T := (a, b); I_T := (b, \infty)$;
\EndFor
\EndFor
\State return $(R, B, I)$;
\label{al:3-2:1}
\end{algorithmic}
\end{algorithm}

\begin{figure}[!htbp]
  \centering
  \includegraphics[height=4cm]{fig/3/3.2/fig3-2-1.png}
  \caption{CGAL程序中三种对应Edelsbrunner算法的三种情况}
\end{figure}

\begin{figure}[!htbp]
  \centering
  \subfigure[$\alpha=1$]{
    \label{fig:3-2:2a}
    \includegraphics[height=4cm]{fig/3/3.2/fig3-2-2.png}
    }\quad
  \subfigure[$\alpha=0.1$]{
    \label{fig:3-2:2b}
    \includegraphics[height=4cm]{fig/3/3.2/fig3-2-3.png}
  }\quad
  \subfigure[$\alpha=0.001$]{
    \label{fig:3-2:2c}
    \includegraphics[height=4cm]{fig/3/3.2/fig3-2-4.png}}
  \caption{alpha shape}
\end{figure}



\newpage


\section{Poisson Equation}
\subsection{偏微分方程和边界条件}
\subsection{变分形式}
\subsection{有限元离散}
\subsection{线性方程组}


\subsection{算例}

\subsubsection{二维Mixed边界条件}
\begin{shaded}
\begin{problem}\label{pro:3.3.5.1}
  \begin{align*}
    -\Delta u &= f & \textrm{in }\Omega\,,\\
    u &= u_{\textrm D} & \textrm{on }\Gamma_{\textrm D}\,,\\
    \mathbf n\cdot \nabla u &= u_{\textrm N} & \textrm{on }\Gamma_{\textrm N}\,,
  \end{align*}
  where
  \begin{align*}
    &\Omega:=(0,1)^2\,,\\
    &\Gamma_{\textrm D}:=\{x|x_i=0,0\leq x_j\leq1,j\neq i\}\,,\\
    &u_{\textrm D}=\mathrm e^{x_1+x_2}\,,\\
    &u_{\textrm N}=\mathrm e^{x_1+x_2}\,,\\
    &f=-2\mathrm e^{x_1+x_2}\,.
  \end{align*}
  $u$的解析解为
  \begin{align*}
    u=\mathrm e^{x_1+x_2}\,.
  \end{align*}
\end{problem}
\end{shaded}
  
\begin{figure}[!htbp]
  \centering
  \label{fig:1-6:1}
  \includegraphics[height=5cm]{fig/3/3.3.1/1.pdf}
  \caption{$u_h$, level 4}
\end{figure}

$L_2$误差和二次收敛速度如下表\ref{tab:3.3.5.1:1}。
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l}
    level & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|u-u_h\|_{L^2}$} & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 5 & 0.2046 &    \\
    \hline
    1 & 13 & 0.062793  &  3.258324973 \\
    \hline
    2 & 41 & 0.017337  &  3.621906904 \\
    \hline
    3 & 145 & 0.0044823  &  3.867880329 \\
    \hline
    4 & 545 & 0.0011314  & 3.961728832  \\
    \hline
    5 & 2\,113 & 0.00028354  & 3.990265924  \\
    \hline
    6 & 8\,321 & 7.0922e-05  & 3.9979132 \\
    \hline
    7 & 33\,025 & 1.7732e-05  & 3.999661629 \\
    \hline
    8 & 131\,585 & 4.4333e-06  & 3.999729321 \\
    \hline
    9 & 525\,313 & 1.1083e-06  & 4.000090228 \\
  \end{tabular}
  \caption{算例\ref{pro:3.3.5.1}的$L_2$误差和收敛速度，数值积分点为$(16,5)$}
  \label{tab:3.3.5.1:1}
\end{table}

\subsubsection{三维Mixed边界条件}

\begin{shaded}
\begin{problem}\label{pro:3.3.5.2}
  \begin{align*}
    -\Delta u &= f & \textrm{in }\Omega\,,\\
    u &= u_{\textrm D} & \textrm{on }\Gamma_{\textrm D}\,,\\
    \mathbf n\cdot \nabla u &= u_{\textrm N} & \textrm{on }\Gamma_{\textrm N}\,,
  \end{align*}
  where
  \begin{align*}
    &\Omega:=(0,1)^3\,,\\
    &\Gamma_{\textrm D}:=\{x|x_i=0,0\leq x_j\leq1,j\neq i\}\,,\\
    &u_{\textrm D}=\mathrm e^{x_1+x_2+x_3}\,,\\
    &u_{\textrm N}=\mathrm e^{x_1+x_2+x_3}\,,\\
    &f=-3\mathrm e^{x_1+x_2+x_3}\,.
  \end{align*}
  $u$的解析解为
    \begin{align*}
    u=\mathrm e^{x_1+x_2+x_3}\,.
  \end{align*}
\end{problem}
\end{shaded}

\begin{figure}[!htbp]
  \centering
  \label{fig:1-6:2}
  \includegraphics[height=5cm]{fig/3/3.3.1/2.pdf}
  \caption{$u_h$, level 4}
\end{figure}

$L_2$误差和二次收敛速度如下表\ref{tab:3.3.5.2:1}。
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l}
    level & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|u-u_h\|_{L^2}$} & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 15    &    0.24794 & \\
    \hline
    1 & 65     &   0.13021 &     1.904154827\\
    \hline
    2 & 369     &  0.038743 &    3.360865189\\
    \hline
    3 & 2\,465    &  0.010258  &   3.776857087\\
    \hline
    4 & 1\,7985   &  0.0026009  &  3.944019378\\
    \hline
    5 & 13\,7345  &  0.00065152  & 3.992049361\\
    \hline
    6 & 1\,073\,409 &  0.00016299  & 3.997300448
  \end{tabular}
  \caption{算例\ref{pro:3.3.5.2}的$L_2$误差和收敛速度}
  \label{tab:3.3.5.2:1}
\end{table}


\section{Heat Equation}
\subsection{偏微分方程和初始/边界条件}
\begin{align*}
  \frac{\partial u}{\partial t}-\Delta u &= f & \textrm{in }\Omega\,,\\
  u &= u_{\textrm D} & \textrm{on }\Gamma_{\mathrm D}\,,\\
  \mathbf n\cdot \nabla u &= u_{\textrm N} & \textrm{on }\Gamma_{\mathrm N}\,.
\end{align*}
\subsection{变分形式}
\begin{align*}
  \int_{\Omega}\Delta u v \ud x  + \int_{\Omega}\nabla u \cdot\nabla v \ud x&= \int_{\Gamma}\partial_n u  v\ud s 
\end{align*}
\begin{align*}
  \int_{\Omega}\frac{\partial u}{\partial t} v\ud x + \int_{\Omega}\nabla u \cdot\nabla v \ud x = \int_{\Omega}fv\ud x + \int_{\Gamma}\partial_n u  v\ud s 
\end{align*}

\subsection{有限元离散}
\begin{align*}
  M\dot  U + K U = f
\end{align*}
\begin{align*}
   M \frac{U^{n+1} - U^{n}}{k} + K U^{n+1} = f^{n+1}
\end{align*}
\subsection{线性方程组}
\begin{align*}
   (M + kK) U^{n+1} = MU^{n}  + kf^{n+1}
\end{align*}

\subsection{算例}
\begin{shaded}
  \subsubsection{二维Dirichlet边界条件}
  解析解为
  \begin{align*}
    u =& \mathrm e^{t}\mathrm e^{x_1+x_2}\,,\\
    f =& -\mathrm e^{t}\mathrm e^{x_1+x_2}\,.
  \end{align*}
\end{shaded}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l}
    $l_h$ & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|u-u_h\|_{L^2}$} & \multicolumn{1}{c}{ROC} \\
    \hline
    0,1 & 5 & 0.63298 &    \\
    \hline
    1,3 & 13 & 0.15346  &  4.124723055 \\
    \hline
    2,5 & 41 & 0.038291  &  4.007730276 \\
    \hline
    3,7 & 145 & 0.0095955  &  3.990516388 \\
    \hline
    4,9 & 545 & 0.0024024  &  3.994130869 \\
    \hline
    5,11 & 2\,113 & 0.00060097  &  3.997537315 \\
    \hline
    6,13 & 8\,321 & 0.00015028  & 3.999001863 
  \end{tabular}
  \caption{heat equation, 2D dirichlet b.c., $T=0.5$}
  \label{tab:3.2.2:1}
\end{table}
\begin{shaded}
\subsubsection{二维Mixed边界条件}
\begin{align*}
  u =& \mathrm e^{t}\mathrm e^{x_1+x_2}\\
  f =& -\mathrm e^{t}\mathrm e^{x_1+x_2}
\end{align*}
\end{shaded}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l}
    $l_h$ & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|u-u_h\|_{L^2}$} & \multicolumn{1}{c}{ROC} \\
    \hline
    0,1 & 5 & 0.38977 &    \\
    \hline
    1,3 & 13 & 0.11406  &  3.417236542 \\
    \hline
    2,5 & 41 & 0.030879           & 3.693772467  \\
    \hline
    3,7 & 145 & 0.007936           &  3.891003024 \\
    \hline
    4,9 & 545 & 0.0019999          &  3.96819841 \\
    \hline
    5,11 & 2\,113 & 0.00050099         & 3.991896046  \\
    \hline
    6,13 & 8\,321 & 0.0001253          & 3.998324022 
  \end{tabular}
  \caption{heat equation, 2D mixed b.c., $T=0.5$}
  \label{tab:3.2.2:1}
\end{table}

\begin{shaded}
\subsubsection{三维Mixed边界条件}
\begin{align*}
  u =& \mathrm e^{t}\mathrm e^{x_1+x_2+x_3}\\
  f =& -2\mathrm e^{t}\mathrm e^{x_1+x_2}
\end{align*}
\end{shaded}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|r|l|l}
    $l_h$ & $l_t$ & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|u-u_h\|_{L^2}$} & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 1 & 15 & 0.46853 &    \\
    \hline
    1 & 3 & 65 & 0.21396  &   \\
    \hline
    2 & 5 & 369  &  0.062935          &   \\
    \hline
    3 & 7 & 2\,465 & 0.016651          &   \\
    \hline
    4 & 9 &  17\,985 &  0.0042227         &   \\
    \hline
    5 & 11 & 137\,345 & 0.0010577         &  
  \end{tabular}
  \caption{heat equation, 3D mixed b.c., $T=0.5$}
  \label{tab:3.2.2:1}
\end{table}

          








\newpage


\section{线弹性方程}
\subsection{偏微分方程和边界条件}
\begin{shaded}
  \begin{subequations}
    \begin{align}
      \label{eq:3.5.1:1a}
      -\nabla\cdot\mathbf \sigma=& \mathbf b & \mathbf x\in\Omega\,,\\
      \mathbf \sigma\cdot\mathbf n =& \mathbf t & \mathbf x\in\Gamma_N\,,\\
      \mathbf u =& \mathbf g &\mathbf x\in\Gamma_D\,.
    \end{align}
    \end{subequations}
\end{shaded}
\subsection{变分形式}
对\eqref{eq:3.5.1:1a}两边点乘$\mathbf v$，在$\Omega$上积分得到
\begin{align}\label{eq:3.5.2:1}
  -\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\,.
\end{align}
\eqref{eq:3.5.2:1}左边为
\begin{equation}\label{eq:3.5.2:2}
  \begin{split}
    &-\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x\\
    =&  -\int_{\Omega}\left(
    \sum_{i=1}^3\frac{\partial \sigma_{i1}}{\partial x_i}v_1 + \sum_{i=1}^3\frac{\partial \sigma_{i2}}{\partial x_i}v_2 + \sum_{i=1}^3\frac{\partial \sigma_{i3}}{\partial x_i}v_3
    \right)\ud x  \\ 
    =&  -\int_{\Omega}\left(
    \nabla\cdot\mathbf\sigma_{\cdot 1}v_1 + \nabla\cdot\mathbf\sigma_{\cdot 2}v_2 + \nabla\cdot\mathbf\sigma_{\cdot 3}v_3
    \right)\ud x \\
    =&-\int_{\Gamma}\left(
    \mathbf n\cdot\mathbf \sigma_{\cdot 1}v_1 + \mathbf n\cdot\mathbf \sigma_{\cdot 2}v_2 + \mathbf n\cdot\mathbf\sigma_{\cdot 3}v_3\right)\ud s_x     
    +\int_{\Omega}\left(
    \nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}\right)\ud x\,.
    \end{split}
\end{equation}
对\eqref{eq:3.5.2:2}的第二个积分项，由$\mathbf\sigma=\mathbf\sigma^T$得到
\begin{equation}\label{eq:3.5.2:3}
  \begin{split}
    &\nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3} \\
    =&\frac{\partial v_1}{\partial x_1}\sigma_{11} + \frac{\partial v_1}{\partial x_2}\sigma_{21} + \frac{\partial v_1}{\partial x_3}\sigma_{31} + \frac{\partial v_2}{\partial x_1}\sigma_{12} + \frac{\partial v_2}{\partial x_2}\sigma_{22} + \frac{\partial v_2}{\partial x_3}\sigma_{32} 
    + \frac{\partial v_3}{\partial x_1}\sigma_{13} + \frac{\partial v_3}{\partial x_2}\sigma_{23} + \frac{\partial v_3}{\partial x_3}\sigma_{33} \\
    =&\frac{\partial v_1}{\partial x_1}\sigma_{11} + \frac{\frac{\partial v_1}{\partial x_2}+\frac{\partial v_2}{\partial x_1}}{2}\sigma_{21} 
    + \frac{\frac{\partial v_1}{\partial x_3}+\frac{\partial v_3}{\partial x_1}}{2}\sigma_{31}
    + \frac{\frac{\partial v_2}{\partial x_1}+\frac{\partial v_1}{\partial x_2}}{2}\sigma_{12}
    + \frac{\partial v_2}{\partial x_2}\sigma_{22} + \frac{\frac{\partial v_2}{\partial x_3}+\frac{\partial v_3}{\partial x_2}}{2}\sigma_{32} \\
    &+\frac{\frac{\partial v_3}{\partial x_1}+\frac{\partial v_1}{\partial x_3}}{2}\sigma_{13} + \frac{\frac{\partial v_3}{\partial x_2}+\frac{\partial v_2}{\partial x_3}}{2}\sigma_{23} + \frac{\partial v_3}{\partial x_3}\sigma_{33}\\
    =&\mathbf\sigma:\mathbf\varepsilon(\mathbf v)\,.
  \end{split}
\end{equation}
将\eqref{eq:3.5.2:3}代入\eqref{eq:3.5.2:2}，再将\eqref{eq:3.5.2:2}代入\eqref{eq:3.5.2:1}得到
\begin{align*}
  &-\int_{\Gamma}\mathbf\sigma\cdot\mathbf n\cdot\mathbf v\ud s_x      +\int_{\Omega}\mathbf\sigma:\mathbf\varepsilon(\mathbf v)\ud x = \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\,.
\end{align*}

根据本构关系有
\begin{align}\label{eq:3.5.2:4}
  \int_{\Omega}\mathbf\sigma(\mathbf u):\mathbf\varepsilon(\mathbf v)\ud x=&\int_{\Omega}(2\mu\mathbf \varepsilon(\mathbf u) + \lambda\mathrm{tr}(\mathbf\varepsilon(\mathbf u))\mathbf I):\mathbf\varepsilon(\mathbf v)\ud x\,.
\end{align}
\eqref{eq:3.5.2:4}右边积分第二项为
\begin{equation}\label{eq:3.5.2:5}
  \begin{split}
  &\lambda\mathrm{tr}(\mathbf\varepsilon(\mathbf u))\mathbf I:\mathbf\varepsilon(\mathbf v)\\
  =&\lambda
  \left(\begin{array}{ccc}
    \sum_{i=1}^3\frac{\partial u_i}{\partial x_i} & 0   & 0\\
    0 & \sum_{i=1}^3\frac{\partial u_i}{\partial x_i}   & 0\\
    0 & 0   & \sum_{i=1}^3\frac{\partial u_i}{\partial x_i}
  \end{array}
  \right):
  \left(\begin{array}{ccc}
    \frac{\partial v_1}{\partial x_1} &     \frac{\frac{\partial v_1}{\partial x_2} + \frac{\partial v_2}{\partial x_1}}{2} &     \frac{\frac{\partial v_1}{\partial x_3} + \frac{\partial v_3}{\partial x_1}}{2}\\
    \frac{\frac{\partial v_2}{\partial x_1} + \frac{\partial v_1}{\partial x_2}}{2} &     \frac{\partial v_2}{\partial x_2} &     \frac{\frac{\partial v_2}{\partial x_3} + \frac{\partial v_3}{\partial x_2}}{2}\\
    \frac{\frac{\partial v_3}{\partial x_1} + \frac{\partial v_1}{\partial x_3}}{2} &     \frac{\frac{\partial v_3}{\partial x_2} + \frac{\partial v_2}{\partial x_3}}{2} &    \frac{\partial v_3}{\partial x_3}
  \end{array}\right)\\
  =&\lambda\nabla\cdot\mathbf u\nabla\cdot\mathbf v\,.
  \end{split}
\end{equation}
将\eqref{eq:3.5.2:5}代入\eqref{eq:3.5.2:4}得到
\begin{align*}
  \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+\lambda\nabla\cdot\mathbf u \nabla\cdot\mathbf v\right)\ud x =
  \int_{\Gamma}\mathbf\sigma\cdot\mathbf n\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\,.
\end{align*}

\begin{shaded}
找到$\mathbf u\in\mathbf V_{\mathbf g}$使得
\begin{align*}
  \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+\lambda\nabla\cdot\mathbf u \nabla\cdot\mathbf v\right)\ud x =
  \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
对所有的$\mathbf v\in\mathbf V_{0}$成立。
\end{shaded}
  
\subsection{有限元离散}
$\mathbf V_h$中任意函数的分量是网格$\Omega_h$上的连续分段多项式函数。
\begin{shaded}
找到$\mathbf u_h\in\mathbf V_{\mathbf g,h}$使得
\begin{align*}
  \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u_h) :\mathbf\varepsilon(\mathbf v_h)+\lambda\nabla\cdot\mathbf u_h \nabla\cdot\mathbf v_h\right)\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x
\end{align*}
对所有的$\mathbf v_h\in\mathbf V_{0,h}$成立。
\end{shaded}

\subsection{线性方程组}
\begin{align*}
  \mathbf u_h=
  \left(\begin{array}{c}
    u_h^{(1)}\\
    u_h^{(2)}\\
    u_h^{(3)}
  \end{array}\right)=
  \left(\begin{array}{c}
    \sum_{j=1}^NU_j^{(1)}\phi_j\\
    \sum_{j=1}^NU_j^{(2)}\phi_j\\
    \sum_{j=1}^NU_j^{(3)}\phi_j
  \end{array}\right)
\end{align*}
\begin{gather*}
  \nabla \mathbf u_h = \left(
  \begin{array}{c}
    \nabla u_{h}^{(1)}\\
    \nabla u_{h}^{(2)}\\
    \nabla u_{h}^{(3)}
  \end{array}
  \right)=\left(
  \begin{array}{c}
    \sum_{j=1}^NU_j^{(1)}\nabla\phi_j\\
    \sum_{j=1}^NU_j^{(2)}\nabla\phi_j\\
    \sum_{j=1}^NU_j^{(3)}\nabla\phi_j
  \end{array}
  \right)
\end{gather*}
\begin{gather*}
  \nabla\cdot\mathbf u_h = \sum_{i=1}^3\frac{\partial u^{(i)}_{h}}{\partial x_i} = \sum_{i=1}^3\sum_{j=1}^NU_j^{(i)}\frac{\partial \phi_j}{\partial x_i}
\end{gather*}

\begin{shaded}
因此$A$和$b$可以根据Poisson方程中的$\nabla\phi_j$和$\phi_j$计算。
\begin{align*}
  AU = b
\end{align*}
\end{shaded}

\subsection{算例}
\subsubsection{2D Dirichlet B.C.}
\begin{shaded}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma
  \end{align*}
  \begin{align*}
    \Omega:=(0,1)^2
  \end{align*}
  \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =&-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u\\
    =& -(\mu+\lambda)\left(\begin{array}{c}
      \frac{\partial^2 u_1}{\partial x_1^2} + \frac{\partial^2 u_2}{\partial x_2\partial x_1}\\
      \frac{\partial^2 u_1}{\partial x_1\partial x_2} + \frac{\partial^2 u_2}{\partial x_2^2}
    \end{array}\right)-\mu\left(\begin{array}{c}
      \frac{\partial^2 u_1}{\partial x_1^2} + \frac{\partial^2 u_1}{\partial x_2^2}\\
      \frac{\partial^2 u_2}{\partial x_1^2} + \frac{\partial^2 u_2}{\partial x_2^2}
    \end{array}\right)\\
    =& -(\mu+\lambda)\left(\begin{array}{c}
      -2\pi^2\sin(\pi x_1)\cos(\pi x_2)\\
      -2\pi^2\sin(\pi x_1)\cos(\pi x_2)
    \end{array}\right)-\mu\left(\begin{array}{c}
      -2\pi^2\sin(\pi x_1)\cos(\pi x_2)\\
      -2\pi^2\sin(\pi x_1)\cos(\pi x_2)
    \end{array}\right)\\
    =&2(2\mu+\lambda)\pi^2\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)  \\
      \cos(\pi x_1)\sin(\pi x_2) 
    \end{array}\right)
  \end{align*}
\end{shaded}

\begin{figure}[!htbp]
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3.4.5:1a}
    \includegraphics[height=5cm]{fig/3/3.4.1/1.pdf}
  }
  \qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3.4.5:1b}
    \includegraphics[height=5cm]{fig/3/3.4.1/2.pdf}
  }
  \caption{$\mathbf u_h$, level 4}
  \label{fig:3.4.5:1}
\end{figure}

收敛速度受到有限元误差、\sout{给定项插值误差}、数值积分误差和locking问题的影响，比较$(\mu,\lambda)=(1,1)$和$(\mu,\lambda)=(1,1000)$的收敛速度，在网格足够加密的情况下，有限元误差占主导产生二次收敛如表\ref{tab:3.4.1:1}，由于$(\mu,\lambda)=(1,1000)$的泊松比接近0.5，是近不可压缩材料，产生了明显的locking问题，收敛速度明显减慢如表\ref{tab:3.4.1:2}。\textcolor{red}{locking问题和convection dominated问题的关联性。}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 & 10 &   0.1414      &    &1 \\
    \hline
    1 & 26 & 0.030175 &    4.685998343 &5\\
    \hline
    2 & 82 & 0.0079999 &    3.771922149 &16\\
    \hline
    3 & 290 & 0.002088 &    3.831369732 & 37\\
    \hline
    4 & 1\,090 & 0.00053149   & 3.928578148  & 86\\
    \hline
    5 & 4\,226 & 0.00013361   &  3.977920814 & 179\\
    \hline
    6 & 16\,642 & 3.3452e-05   & 3.994081071 &  346 \\
    \hline
    7 & 66\,050 & 8.3663e-06 &  3.998422242  &  692 \\
    \hline
    8 & 263\,170 & 2.0918e-06 &  3.999569749 & 1\,366 \\
    \hline
    9 & 1\,050\,626  & 5.2296e-07  & 3.999923512 & 2\,705 
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1)$, dirichlet b.c. 2d}
  \label{tab:3.4.1:1}
\end{table}

\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC}  & PCG\\
    \hline
    0 & 10 & 0.1414 &    & 1 \\
    \hline
    1 & 26 & 0.030175   & 4.6859983  & 5\\
    \hline
    2 & 82 & 0.012036   &  2.5070621  & 27\\
    \hline
    3 & 290 & 0.0092264    &  1.3045175 & 121\\
    \hline
    4 & 1\,090 & 0.0069234     & 1.33264 & 425 \\
    \hline
    5 & 4\,226 & 0.0037143    & 1.8639851 & 1\,293 \\
    \hline
    6 & 16\,642 & 0.0014707   & 2.5255321 & 3\,237 \\
    \hline
    7 & 66\,050 & 0.00048045 & 3.061088563  & 8\,362 \\
    \hline
    8 & 263\,170 & 0.00013467 &  3.567609713 & 17\,973 \\
    \hline
    9 & 1\,050\,626  & 3.4946e-05  & 3.853659932 & 37\,591
  \end{tabular}
  \caption{$(\mu,\lambda)=(1,1000)$, dirichlet b.c. 2d}
  \label{tab:3.4.1:2}
\end{table}




%=====================================================================================
%=====================================================================================
% 线弹性方程位移形式，Dirichlet Mixed B.C. 算例
%=====================================================================================
%=====================================================================================

\subsubsection{2D Mixed B.C.}

\begin{shaded}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma_D\\
    &\mathbf \sigma\cdot\mathbf n = \mathbf t &\mathbf x\in\Gamma_N
  \end{align*}
  \begin{align*}
    &\Omega:=(0,1)^2\\
    &\Gamma_D:=\{x_1=0\}\cup\{x_2=0\}
  \end{align*}
  \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =& 2(2\mu+\lambda)\pi ^2\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)  \\
      \cos(\pi x_1)\sin(\pi x_2) 
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \mathbf \sigma =& 2\mu\mathbf \varepsilon + \lambda\mathrm{tr}(\mathbf\varepsilon)\mathbf I \\
  =&2\mu\left(\begin{array}{cc}
    \frac{\partial u_1}{\partial x_1} &     \frac{1}{2}\left(\frac{\partial u_1}{\partial x_2} + \frac{\partial u_2}{\partial x_1}\right) \\
    \frac{1}{2}\left(\frac{\partial u_2}{\partial x_1} + \frac{\partial u_1}{\partial x_2}\right) &     \frac{\partial u_2}{\partial x_2} 
  \end{array}\right) + \lambda\left(\begin{array}{cc}
    \sum_{i=1}^2\frac{\partial u_i}{\partial x_i}&     0 \\
    0 &     \sum_{i=1}^2\frac{\partial u_i}{\partial x_i}
  \end{array}\right)
  \end{align*}
  \begin{align*}
    &\frac{\partial u_1}{\partial x_1} = \frac{\partial u_2}{\partial x_2} = \pi\cos(\pi x_1)\cos(\pi x_2)\\
    &\frac{1}{2}\left(\frac{\partial u_1}{\partial x_2} + \frac{\partial u_2}{\partial x_1}\right) = \frac{1}{2}\left(-\pi\sin(\pi x_1)\sin(\pi x_2) - \pi\sin(\pi x_1)\sin(\pi x_2) \right)=-\pi\sin(\pi x_1)\sin(\pi x_2)\\     
    &\sum_{i=1}^2\frac{\partial u_i}{\partial x_i} = \pi\cos(\pi x_1)\cos(\pi x_2) + \pi \cos(\pi x_1)\cos(\pi x_2) = 2\pi \cos(\pi x_1)\cos(\pi x_2)
  \end{align*}
  \begin{align*}
    \mathbf \sigma 
  =&2\mu\pi \left(\begin{array}{cc}
    \cos(\pi x_1)\cos(\pi x_2) &    -\sin(\pi x_1)\sin(\pi x_2) \\
    -\sin(\pi x_1)\sin(\pi x_2) &     \cos(\pi x_1)\cos(\pi x_2)
  \end{array}\right) \\&+ 2\lambda\pi \left(\begin{array}{cc}
    \cos(\pi x_1)\cos(\pi x_2)&     0 \\
    0 &     \cos(\pi x_1)\cos(\pi x_2)
  \end{array}\right)\\
   =&\left(\begin{array}{cc}
    2(\mu+\lambda)\pi \cos(\pi x_1)\cos(\pi x_2) &    -2\mu\pi \sin(\pi x_1)\sin(\pi x_2) \\
    -2\mu\pi \sin(\pi x_1)\sin(\pi x_2) &     2(\mu+\lambda)\pi \cos(\pi x_1)\cos(\pi x_2)
  \end{array}\right) 
  \end{align*}
  
\end{shaded}

\begin{figure}[!htbp]
  \centering
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3-4-1:2a}
    \includegraphics[height=5cm]{fig/3/3.4.1/5.pdf}
    }\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3-4-1:2b}
  \includegraphics[height=5cm]{fig/3/3.4.1/6.pdf}}
  \caption{$\mathbf u_h$, level 4}
\end{figure}

收敛速度受到有限元误差、\sout{给定项插值误差}、数值积分误差和locking问题的影响，比较$(\mu,\lambda)=(1,1)$和$(\mu,\lambda)=(1,1000)$的收敛速度，在网格足够加密的情况下，有限元误差占主导产生二次收敛如表\ref{tab:3.4.1:3}，由于$(\mu,\lambda)=(1,1000)$的泊松比接近0.5，是近不可压缩材料，产生了明显的locking问题，收敛速度明显减慢如表\ref{tab:3.4.1:4}，\textcolor{red}{图\ref{fig:3.4:3}中也产生明显误差}。

\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c|}{ROC} & \multicolumn{1}{c}{PCG} \\
    \hline
    0 & 10 & 0.13445 &   & 4\\
    \hline
    1 & 26 &  0.028664   & 4.69055261  & 17\\
    \hline
    2 & 82 & 0.0076485   & 3.74766294 & 40\\
    \hline
    3 & 290 & 0.002005   & 3.814713217 & 95\\
    \hline
    4 & 1\,090 & 0.00051163   & 3.918847605 & 201\\
    \hline
    5 & 4\,226 & 0.00012867   & 3.976295951 & 410\\
    \hline
    6 & 16\,642 & 3.2209e-05   & 3.994846161 & 816 \\
    \hline
    7 & 66\,050 & 8.0541e-06   & 3.999081213 & 1\,626 \\
    \hline
    8 & 263\,170 & 2.0136e-06   & 3.999851013 & 3\,232\\
    \hline
    9 & 1\,050\,626 &  5.0338e-07  & 4.000158926 & 6\,425
  \end{tabular}
  \caption{$(\mu,\lambda)=(1,1)$, displacement formulation, mixed b.c. 2d}
  \label{tab:3.4.1:3}
\end{table}





\clearpage
\begin{figure}[!htbp]
  \centering
  \includegraphics[height=5cm]{fig/3/3.5/1.png}
  \caption{$\mathbf u_h$, level 4}
\end{figure}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c|}{ROC} \\
    \hline
    2 &0.0089004& \\
    \hline
    3 &0.0021415 &   4.15615223 \\
    \hline
    4 &0.00053014 &  4.039499 \\
    \hline  
    5 &0.00013222 &  4.009529572 \\
    \hline
    6 &3.3038e-05 &  4.0021 \\
    \hline
    7 &8.2586e-06 &  4.00043591 \\
    \hline
    8 &2.0646e-06 &  4.000096871 \\
    \hline
    9 &5.1615e-07 &  4
  \end{tabular}
  \caption{$(\mu,\lambda)=(1,1)$, displacement formulation, mixed b.c. 2d, quadrilateral}
  \label{tab:3.4.1:3}
\end{table}


\clearpage

\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c|}{ROC} & \multicolumn{1}{c}{PCG} \\
    \hline
    0 & 10 & 0.1413   &    & 5 \\
    \hline
    1 & 26 & 0.030106    & 4.693416595 & 25 \\
    \hline
    2 & 82 & 0.01211    & 2.486044591 & 116\\
    \hline
    3 & 290 & 0.0095471    & 1.26844801 & 504\\
    \hline
    4 & 1\,090 & 0.0088274    & 1.081530235 & 1\,392\\
    \hline
    5 & 4\,226 & 0.0064062    & 1.377946364  & 3\,825\\
    \hline
    6 & 16\,642 & 0.0031212   & 2.052479815 & 9\,022\\
    \hline
    7 & 66\,050 & 0.0010586   & 2.948422445 & 19\,719 \\
    \hline
    8 & 263\,170 & 0.00029308   & 3.611983076 & 43\,555\\
    \hline
    9 & 1\,050\,626 & 7.5243e-05   & 3.895113167 & 90\,401 
  \end{tabular}
  \caption{$(\mu,\lambda)=(1,1000)$, displacement formulation,  mixed b.c. 2d}
  \label{tab:3.4.1:4}
\end{table}

\subsubsection{3D Dirichlet B.C.}

\begin{shaded}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma
  \end{align*}
  \begin{align*}
    \Omega:=(0,1)^3
  \end{align*}
  \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =&-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u\\
    =& -(\mu+\lambda)\left(\begin{array}{c}
      \frac{\partial^2 u_1}{\partial x_1^2} + \frac{\partial^2 u_2}{\partial x_2\partial x_1} + \frac{\partial^2 u_3}{\partial x_3\partial x_1}\\
      \frac{\partial^2 u_1}{\partial x_1\partial x_2} + \frac{\partial^2 u_2}{\partial x_2^2} + \frac{\partial^2 u_3}{\partial x_3\partial x_2}\\
      \frac{\partial^2 u_1}{\partial x_1\partial x_3} + \frac{\partial^2 u_2}{\partial x_2\partial x_3} + \frac{\partial^2 u_3}{\partial x_3^2}
    \end{array}\right)-\mu\left(\begin{array}{c}
      \frac{\partial^2 u_1}{\partial x_1^2} + \frac{\partial^2 u_1}{\partial x_2^2} + \frac{\partial^2 u_1}{\partial x_3^2} \\
      \frac{\partial^2 u_2}{\partial x_1^2} + \frac{\partial^2 u_2}{\partial x_2^2} + \frac{\partial^2 u_2}{\partial x_3^2} \\
      \frac{\partial^2 u_3}{\partial x_1^2} + \frac{\partial^2 u_3}{\partial x_2^2} + \frac{\partial^2 u_3}{\partial x_3^2} 
    \end{array}\right)\\
    =& -(\mu+\lambda)3\left(\begin{array}{c}
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)
    \end{array}\right)-\mu3\left(\begin{array}{c}
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)
    \end{array}\right)\\
    =&-3(2\mu+\lambda)\left(\begin{array}{c}
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3)\\
      \exp(x_1+x_2+x_3) 
    \end{array}\right)
  \end{align*}
\end{shaded}

\begin{figure}[!htbp]
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3.4.5:1a}
    \includegraphics[height=5cm]{fig/3/3.4.1/3.pdf}
  }
  \qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3.4.5:1b}
    \includegraphics[height=5cm]{fig/3/3.4.1/4.pdf}
  }
  \caption{$\mathbf u_h$, level 4}
  \label{fig:3.4.5:1}
\end{figure}

收敛速度受到有限元误差、\sout{给定项插值误差}、数值积分误差和locking问题的影响，比较$(\mu,\lambda)=(1,1)$和$(\mu,\lambda)=(1,1000)$的收敛速度，在网格足够加密的情况下，有限元误差占主导产生二次收敛如表\ref{tab:3.4.1:3}，由于$(\mu,\lambda)=(1,1000)$的泊松比接近0.5，是近不可压缩材料，产生了明显的locking问题，收敛速度明显减慢如表\ref{tab:3.4.1:4}。
\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 & 45     & 0.013858    &             &     1 \\
    \hline
    1 & 195    & 0.0038868   &  3.565400844   & 25       \\
    \hline
    2 & 1\,107   & 0.0010364   &  3.750289464   & 67       \\
    \hline
    3 & 7\,395   & 0.00026215  &  3.953461759   & 140      \\
    \hline
    4 & 53\,955  & 6.5206e-05  &  4.020335552   & 285 \\
    \hline
    5 & 412\,035 & 1.6165e-05  &  4.033776678   & 570      
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1)$, dirichlet b.c. 3d}
  \label{tab:3.4.1:3}
\end{table}

\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC}  & PCG\\
     \hline
    0 & 45     & 0.015768    &              &    1 \\
    \hline
    1 & 195    & 0.0048149   &  3.274834368   & 33       \\
    \hline
    2 & 1\,107   & 0.0015349   &  3.136947032   & 176       \\
    \hline
    3 & 7\,395   & 0.00080836  &  1.898782721   & 669      \\
    \hline
    4 & 53\,955  & 0.00052425  &  1.541936099   & 2\,200 \\
    \hline
    5 & 412\,035 & 0.00023906  &  2.192964109   & 5\,940
  \end{tabular}
  \caption{$(\mu,\lambda)=(1,1000)$, dirichlet b.c. 3d}
  \label{tab:3.4.1:4}
\end{table}

\subsubsection{3D Mixed B.C.}

\begin{shaded}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma_D\\
    &\mathbf \sigma\cdot\mathbf n = \mathbf t &\mathbf x\in\Gamma_N
  \end{align*}
  \begin{align*}
    &\Omega:=(0,1)^3\\
    &\Gamma_D:=\{x_1=0\}\cup\{x_2=0\}\cup\{x_3=0\}
  \end{align*}
    \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =
    -3(2\mu+\lambda)\left(\begin{array}{c}
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}
    \end{array}\right)`
  \end{align*}
  \begin{align*}
    \mathbf \sigma =& 2\mu\mathbf \varepsilon + \lambda\mathrm{tr}(\mathbf\varepsilon)\mathbf I \\
  =&2\mu\left(\begin{array}{ccc}
    \frac{\partial u_1}{\partial x_1} &     \frac{1}{2}\left(\frac{\partial u_1}{\partial x_2} + \frac{\partial u_2}{\partial x_1}\right) &     \frac{1}{2}\left(\frac{\partial u_1}{\partial x_3} + \frac{\partial u_3}{\partial x_1}\right)\\
    \frac{1}{2}\left(\frac{\partial u_2}{\partial x_1} + \frac{\partial u_1}{\partial x_2}\right) &     \frac{\partial u_2}{\partial x_2} &     \frac{1}{2}\left(\frac{\partial u_2}{\partial x_3} + \frac{\partial u_3}{\partial x_2}\right)\\
    \frac{1}{2}\left(\frac{\partial u_3}{\partial x_1} + \frac{\partial u_1}{\partial x_3}\right)  &     \frac{1}{2}\left(\frac{\partial u_3}{\partial x_2} + \frac{\partial u_2}{\partial x_3} \right)
&     \frac{\partial u_3}{\partial x_3}  \end{array}\right) + \lambda\left(\begin{array}{ccc}
    \sum_{i=1}^3\frac{\partial u_i}{\partial x_i}&     0 &     0 \\
    0 &     \sum_{i=1}^3\frac{\partial u_i}{\partial x_i} &     0 \\
    0 &       0 &   \sum_{i=1}^3\frac{\partial u_i}{\partial x_i} 
  \end{array}\right)
  \end{align*}
  \begin{align*}
    \mathbf \sigma 
   =&\left(\begin{array}{ccc}
     (2\mu+3\lambda)      \mathrm e^{x_1+x_2+x_3} & 2\mu      \mathrm e^{x_1+x_2+x_3} & 2\mu      \mathrm e^{x_1+x_2+x_3}  \\
     2\mu      \mathrm e^{x_1+x_2+x_3} & (2\mu+3\lambda)      \mathrm e^{x_1+x_2+x_3} &  2\mu      \mathrm e^{x_1+x_2+x_3}  \\
     2\mu      \mathrm e^{x_1+x_2+x_3} & 2\mu      \mathrm e^{x_1+x_2+x_3}  & (2\mu+3\lambda)      \mathrm e^{x_1+x_2+x_3}
  \end{array}\right) 
  \end{align*}
  
\end{shaded}

\begin{figure}[!htbp]
  \centering
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3.4:3}
    \includegraphics[height=5cm]{fig/3/3.4.1/7.pdf}
    }\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3.4:3}
  \includegraphics[height=5cm]{fig/3/3.4.1/8.pdf}}
  \caption{$\mathbf u_h$, level 4}
\end{figure}

收敛速度受到有限元误差、\sout{给定项插值误差}、数值积分误差和locking问题的影响，比较$(\mu,\lambda)=(1,1)$和$(\mu,\lambda)=(1,1000)$的收敛速度，在网格足够加密的情况下，有限元误差占主导产生二次收敛如表\ref{tab:3.4.1:3}，由于$(\mu,\lambda)=(1,1000)$的泊松比接近0.5，是近不可压缩材料，产生了明显的locking问题，收敛速度明显减慢如表\ref{tab:3.4.1:4}。


\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 & 45     & 0.0033304    &             &     4 \\
    \hline
    1 & 195    & 0.0020929   & 1.59128482    & 57      \\
    \hline
    2 & 1\,107   & 0.00062361   &  3.356103975   & 123       \\
    \hline
    3 & 7\,395   & 0.00016868  &  3.697000237   & 258     \\
    \hline
    4 & 53\,955  & 4.3285e-05  & 3.896961996    & 521 \\
    \hline
    5 & 412\,035 & 1.093e-05  &  3.960201281   & 1\,040     
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1)$, mixed b.c. 3d}
  \label{tab:3.4.1:3}
\end{table}

\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC}  & PCG\\
     \hline
    0 & 45     & 1.0789    &              &    12 \\
    \hline
    1 & 195    & 0.29479   &  3.659893483   & 167       \\
    \hline
    2 & 1\,107   & 0.078928   &  3.734922968   & 926       \\
    \hline
    3 & 7\,395   & 0.022729  &  3.472568085   & 2\,647      \\
    \hline
    4 & 53\,955  & 0.0069539  &  3.268525576   & 6\,685 \\
    \hline
    5 & 412\,035 & 0.0020488  &  3.394133151   & 14\,822
  \end{tabular}
  \caption{$(\mu,\lambda)=(1,1000)$, mixed b.c. 3d}
  \label{tab:3-4-1:4}
\end{table}


\iffalse

\clearpage

\begin{problem}[Traction 2D]\label{problem:3}
  \begin{align*}
    -(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u=& \mathbf b &\mathbf x\in\Omega\,,\\
    \mathbf u =& \mathbf g &\mathbf x\in\Gamma_D\,,\\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t &\mathbf x\in\Gamma_N\,,
  \end{align*}
  where
  \begin{align*}
    &\Omega:=(0,1)^2\,,\\
    &\Gamma_D:=\{x_2=0\}\,,\\
    &\mathbf g = 0\,,\\
    &\mathbf t = \left\{\begin{array}{ll} (0,1) & x_2 = 1 \\ (0,0) & x_2 \neq 1 \end{array}\right.\,.
  \end{align*}
\end{problem}

\begin{figure}[!htbp]
  \centering
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$ ]{
    \label{fig:3.4:3}
    \includegraphics[height=5cm]{fig/3/3.4.1/9.pdf}
    }\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$ ]{
    \label{fig:3.4:3}
  \includegraphics[height=5cm]{fig/3/3.4.1/10.pdf}}
  \caption{$\mathbf u_h$, level 4, traction 2d}
\end{figure}

\begin{align*}
  &\textcolor{red}{\mathbf u(1,1)=(-0.064721,0.37117)}\\
  &\textcolor{red}{\mathbf u(1,1)=(-0.14178,0.18423)}
\end{align*}

\clearpage
\begin{problem}[Traction 3D]\label{problem:3}
  \begin{align*}
    -(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u=& \mathbf b &\mathbf x\in\Omega\,,\\
    \mathbf u =& \mathbf g &\mathbf x\in\Gamma_D\,,\\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t &\mathbf x\in\Gamma_N\,,
  \end{align*}
  where
  \begin{align*}
    &\Omega:=(0,1)^3\,,\\
    &\Gamma_D:=\{x_3=0\}\,,\\
    &\mathbf g = 0\,,\\
    &\mathbf t = \left\{\begin{array}{ll} (0,0,1) & x_3 = 1 \\ (0,0,0) & x_3 \neq 1 \end{array}\right.\,.
  \end{align*}
\end{problem}

\begin{figure}[!htbp]
  \centering
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3.4:3}
    \includegraphics[height=5cm]{fig/3/3.4.1/11.pdf}
    }\qquad\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3.4:3}
  \includegraphics[height=5cm]{fig/3/3.4.1/12.pdf}}
  \caption{$\mathbf u_h$, level 4, traction, 3d}
\end{figure}

\begin{align*}
  &\textcolor{red}{\mathbf u(1,1,1)=(-0.051514,-0.05149,0.39465)}\\
  &\textcolor{red}{\mathbf u(1,1,1)=(-0.093004,-0.087071,0.28653)}
\end{align*}

\fi


\subsubsection{Cook Membrane}
\begin{shaded}
\begin{align*}
  &\Omega = \textrm{conv}\{x_0,x_1,x_2,x_3\}  & \\
  & x_0=(0,0)  & \\
  & x_1=(48,44) & \\
  & x_2=(48,60) & \\
  & x_3=(0,44) &\\
  & \textbf{u}_{\textrm d} = 0 & \textrm{on }(x_0,x_3) \\
  & \mathbf{\textrm n}\cdot\mathbf{\sigma} = \left(0,\frac{1}{16}\right) & \textrm{on }(x_1,x_2) \\
  & E = 1 & \\
  & \nu = \frac{1}{3} 
\end{align*}
\end{shaded}
\begin{figure}[!htbp]
  \centering
  \includegraphics[height=5cm]{fig/3/3.5.5.5/2.png}
  \label{fig:3.5.5.5:1}
  \caption{cook membrane}
\end{figure}

请用abaqus输出位移$u_2(x_2)$的计算结果。

\begin{figure}[!htbp]
  \centering
  \includegraphics[height=5cm]{fig/3/3.5.5.5/1.png}
  \label{fig:3.5.5.5:2}
  \caption{displacement}
\end{figure}

\begin{table}
  \centering
  \begin{tabular}{c|l|l}
    l & $u_2(x_2)$ & \textrm{cov} \\
    \hline
    0 & 22.384 & \\
    \hline
    1 & 22.503 & 0.119 \\
    \hline
    2 & 22.56 & 0.057 \\
    \hline
    3 & 22.586 & 0.026\\
    \hline
    4 & 22.599 & 0.013 
  \end{tabular}
  \caption{convergence}
\end{table}


\newpage
\newpage

%=====================================================================================
%=====================================================================================
% 线弹性方程位移/压强形式
%=====================================================================================
%=====================================================================================

\subsection{线弹性方程位移/压强形式}
\subsubsection{偏微分方程和边界条件}
\begin{mdframed}[backgroundcolor=orange!20] 
  \begin{subequations}
    \begin{align}
      \label{eq:3-4-2:1}
      -\nabla\cdot\mathbf \sigma=& \mathbf b & \mathbf x\in\Omega\,,\\
      \mathbf \sigma\cdot\mathbf n =& \mathbf t & \mathbf x\in\Gamma_N\,,\\
      \mathbf u =& \mathbf g &\mathbf x\in\Gamma_D\,.
    \end{align}
  \end{subequations}
\end{mdframed}

\subsubsection{变分形式}
标准形式为
\begin{align*}
  \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+\lambda\nabla\cdot\mathbf u \nabla\cdot\mathbf v\right)\ud x =
  \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\,.
\end{align*}
定义$p=\lambda\nabla\cdot\mathbf u$，两边乘以$q$做$\Omega$上的体积分得到
\begin{align*}
  \int_{\Omega}\nabla\cdot\mathbf u q\ud x - \frac{1}{\lambda}\int_{\Omega}pq\ud x=0\,.
\end{align*}
\begin{formulation}[\underline{\textbf{变分形式}}]
找到$(\mathbf u,p)\in\mathbf V_{\mathbf g}\times Q$使得
\begin{align*}
  &\int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+p \nabla\cdot\mathbf v\right)\ud x =
  \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\\
  &\int_{\Omega}\nabla\cdot\mathbf u q\ud x - \frac{1}{\lambda}\int_{\Omega}pq\ud x = 0
\end{align*}
对所有的$(\mathbf v,q)\in\mathbf V_{0}\times Q$成立。
\end{formulation}

\subsubsection{有限元离散}
$\mathbf V_h=(V_h^{(1)},V_h^{(2)})$。$V_h^{(i)}$和$Q_h$是连续分段线性函数空间。
\begin{formulation}[\underline{\textbf{离散形式}}]
找到$(\mathbf u_h,p_h)\in\mathbf V_{\mathbf g,h}\times Q_h$使得
\begin{align*}
  &\int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u_h) :\mathbf\varepsilon(\mathbf v_h)+p_h \nabla\cdot\mathbf v_h\right)\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x\\
  &\int_{\Omega}\nabla\cdot\mathbf u_h q_h\ud x - \frac{1}{\lambda}\int_{\Omega}p_hq_h\ud x = 0
\end{align*}
对所有的$(\mathbf v_h,q_h)\in\mathbf V_{0,h}\times Q_h$成立。
\end{formulation}

\subsubsection{线性方程组}
\begin{align*}
  \left(\begin{array}{cc}
    A_{nn} & A_{nm} \\
    A_{mn} & A_{mm} 
    \end{array}\right)\left(\begin{array}{c}
    U_n\\
    U_m
  \end{array}\right)=
  \left(\begin{array}{c}
    b_n\\
    b_m
    \end{array}\right)
\end{align*}

\subsubsection{算例}

%=====================================================================================
%=====================================================================================
% 线弹性方程位移/压强形式 算例 2D mixed
%=====================================================================================
%=====================================================================================

\begin{problem}[Displacement and Pressure Formulation, 2D Mixed]\label{problem:4}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma_D\\
    &\mathbf \sigma\cdot\mathbf n = \mathbf t &\mathbf x\in\Gamma_N
  \end{align*}
  \begin{align*}
    &\Omega:=(0,1)^2\\
    &\Gamma_D:=\{x_1=0\}\cup\{x_2=0\}
  \end{align*}
  \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =& 2(2\mu+\lambda)\pi ^2\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)  \\
      \cos(\pi x_1)\sin(\pi x_2) 
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \mathbf \sigma 
   =&\left(\begin{array}{cc}
    2(\mu+\lambda)\pi \cos(\pi x_1)\cos(\pi x_2) &    -2\mu\pi \sin(\pi x_1)\sin(\pi x_2) \\
    -2\mu\pi \sin(\pi x_1)\sin(\pi x_2) &     2(\mu+\lambda)\pi \cos(\pi x_1)\cos(\pi x_2)
  \end{array}\right) 
  \end{align*}
  \begin{align*}
    p=\lambda\nabla\cdot \mathbf u 
   =2\lambda\pi \cos(\pi x_1)\cos(\pi x_2)
  \end{align*}
  
\end{problem}

\begin{figure}[!htbp]
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$, displacement and pressure formulation, 2d mixed b.c.]{
    \label{fig:3-4-2:1a}
    \includegraphics[height=5cm]{fig/3/3.4.2/1.pdf}
  }\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$, displacement and pressure formulation, 2d mixed b.c.]{
    \label{fig:3-4-2:1b}
    \includegraphics[height=5cm]{fig/3/3.4.2/2.pdf}
  }
  \caption{$u_h$, level 4}
  \label{fig:3-4-2:1}
\end{figure}

收敛速度受到有限元误差、\sout{给定项插值误差}、数值积分误差和locking问题的影响，在网格足够加密的情况下，有限元误差占主导产生二次收敛如表\ref{tab:4-2-3:1}和\ref{tab:4-2-3:2}，当$(\mu,\lambda)=(1,1000)$泊松比接近0.5时是近不可压缩材料，但是位移/压强形式避免了locking问题，保持二次收敛如表\ref{tab:3-4-2:3}和\ref{tab:3-4-2:4}，\textcolor{red}{图\ref{fig:3-4-2:1b}中误差明显比\ref{fig:3-4-1:2b}减小}。另外\textcolor{red}{需要注意混合形式和一般形式的Jacobi预条件子的区别，混合形式迭代次数明显增加需要更高级的预条件子。}

\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u - \mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & \multicolumn{1}{c}{PCG} \\
    \hline
    0 & 15 & 0.13419 &   & 12\\
    \hline
    1 & 39 & 0.025028   & 5.361595014 & 45\\
    \hline
    2 & 123 & 0.0064124   & 3.903062816 & 178\\
    \hline
    3 & 435 & 0.0016553   & 3.873859723 & 558 \\
    \hline
    4 & 1\,635 & 0.00041902   & 3.950408095 & 1\,277 \\
    \hline
    5 & 6\,339 & 0.0001051   & 3.986869648 & 2\,876 \\
    \hline
    6 & 24\,963 & 2.6292e-05   & 3.997413662 & 5\,638\\
    \hline
    7 & 99\,075 & 6.5737e-06   & 3.99957406  & 12\,206\\
    \hline
    8 & 394\,755 &  1.6434e-06  & 4.000060849  & 23\,601\\
    \hline
    9 & 1\,575\,939  & 4.1085e-07  & 4. & 48\,359
  \end{tabular}
  \caption{$\mathbf u$, $(\mu,\lambda)=(1,1)$, displacement and pressure formulation, 2d mixed b.c.}
  \label{tab:4-2-3:1}
\end{table}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|p - p_h\|_{L^2}$} &  \multicolumn{1}{c|}{ROC} &  \multicolumn{1}{c}{PCG} \\
    \hline
    0 & 15 & 0.64389  &   & 12\\
    \hline
    1 & 39 & 0.13772   & 4.675355794 & 45\\
    \hline
    2 & 123 & 0.030765   & 4.476515521 & 178\\
    \hline
    3 & 435 & 0.0075088   & 4.097192627 & 558 \\
    \hline
    4 & 1\,635 & 0.0018679   & 4.019915413 & 1\,277\\
    \hline
    5 & 6\,339 & 0.00046672   &  4.002185465 & 2\,876\\
    \hline
    6 & 24\,963 & 0.00011669   & 3.999657211 & 5\,638\\
    \hline
    7 & 99\,075 & 2.9176e-05   & 3.999520154 & 12\,206\\
    \hline
    8 & 394\,755 & 7.2942e-06   & 3.99989032  & 23\,601\\
    \hline
    9 & 1\,575\,939  & 1.8235e-06  & 4.000109679 & 48\,359
  \end{tabular}
  \caption{$p$, $(\mu,\lambda)=(1,1)$, displacement and pressure formulation, 2d mixed b.c.}
  \label{tab:4-2-3:2}
\end{table}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u - \mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & \multicolumn{1}{c}{PCG} \\
    \hline
    0 & 15 & 0.1413 &   & 13\\
    \hline
    1 & 39 & 0.028378 & 4.979209247 & 69\\
    \hline
    2 & 123 & 0.030112  & 0.942414984 & 483\\
    \hline
    3 & 435 & 0.0024218   & 12.43372698 & 2\,726 \\
    \hline
    4 & 1\,635 & 0.00027993   & 8.651448576 &  13\,130\\
    \hline
    5 & 6\,339 & 7.8382e-05   & 3.571355668 & 38\,408 \\
    \hline
    6 & 24\,963 &  2.0771e-05  & 3.773626691 & 97\,825 \\
    \hline
    7 & 99\,075 &  5.2774e-06  & 3.935839618  &  250\,083 \\
    \hline
    8 & 394\,755 & 1.3293e-06   & 3.97005943  &  445\,120 \\
    \hline
    9 & 1\,575\,939  & 3.3538e-07  & 3.963563719 & 1\,014\,615
  \end{tabular}
  \caption{$\mathbf u$, $(\mu,\lambda)=(1,1000)$, displacement and pressure formulation, 2d mixed b.c.}
  \label{tab:3-4-2:3}
\end{table}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|p - p_h\|_{L^2}$} &  \multicolumn{1}{c|}{ROC} &  \multicolumn{1}{c}{PCG} \\
    \hline
    0 & 15 & 628.49 &   & 13\\
    \hline
    1 & 39 & 95.173 & 6.603658601 & 69\\
    \hline
    2 & 123 & 15.773  & 6.033918722 & 483\\
    \hline
    3 & 435 & 3.6806   & 4.285442591 & 2\,726 \\
    \hline
    4 & 1\,635 & 0.90692   & 4.058351343 &  13\,130\\
    \hline
    5 & 6\,339 & 0.22595   & 4.013808365 &  38\,408\\
    \hline
    6 & 24\,963 & 0.05644   & 4.003366407 & 97\,825\\
    \hline
    7 & 99\,075 &  0.014107  &  4.000850642  & 250\,083 \\
    \hline
    8 & 394\,755 &  0.0035266  &  4.000170136 & 445\,120 \\
    \hline
    9 & 1\,575\,939  & 0.00088163  & 4.000090741 & 1\,014\,615
  \end{tabular}
  \caption{$p$, $(\mu,\lambda)=(1,1000)$, displacement and pressure formulation, 2d mixed b.c.}
  \label{tab:3-4-2:4}
\end{table}

%=====================================================================================
%=====================================================================================
% 线弹性方程位移/压强形式 算例 3D mixed
%=====================================================================================
%=====================================================================================

\clearpage
\begin{problem}[displacement and pressure formulation, 3d mixed]\label{problem:3-4-2:2}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma_D\\
    &\mathbf \sigma\cdot\mathbf n = \mathbf t &\mathbf x\in\Gamma_N
  \end{align*}
  \begin{align*}
    &\Omega:=(0,1)^3\\
    &\Gamma_D:=\{x_1=0\}\cup\{x_2=0\}\cup\{x_3=0\}
  \end{align*}
    \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =
    -3(2\mu+\lambda)\left(\begin{array}{c}
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}\\
      \mathrm e^{x_1+x_2+x_3}
    \end{array}\right)`
  \end{align*}
  \begin{align*}
    \mathbf \sigma 
   =&\left(\begin{array}{ccc}
     (2\mu+3\lambda)      \mathrm e^{x_1+x_2+x_3} & 2\mu      \mathrm e^{x_1+x_2+x_3} & 2\mu      \mathrm e^{x_1+x_2+x_3}  \\
     2\mu      \mathrm e^{x_1+x_2+x_3} & (2\mu+3\lambda)      \mathrm e^{x_1+x_2+x_3} &  2\mu      \mathrm e^{x_1+x_2+x_3}  \\
     2\mu      \mathrm e^{x_1+x_2+x_3} & 2\mu      \mathrm e^{x_1+x_2+x_3}  & (2\mu+3\lambda)      \mathrm e^{x_1+x_2+x_3}
  \end{array}\right) 
  \end{align*}
  \begin{align*}
    p = 3\lambda \mathrm e^{x_1+x_2+x_3}
  \end{align*}

\end{problem}

\begin{figure}[!htbp]
  \centering
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3-4-2:2a}
    \includegraphics[height=5cm]{fig/3/3.4.1/7.pdf}
    }\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3-4-2:2b}
  \includegraphics[height=5cm]{fig/3/3.4.1/8.pdf}}
  \caption{$\mathbf u_h$, level 4}
\end{figure}

收敛速度受到有限元误差、\sout{给定项插值误差}、数值积分误差和locking问题的影响，比较$(\mu,\lambda)=(1,1)$和$(\mu,\lambda)=(1,1000)$的收敛速度，在网格足够加密的情况下，有限元误差占主导产生二次收敛如表\ref{tab:3-4-2:5}，由于$(\mu,\lambda)=(1,1000)$的泊松比接近0.5，是近不可压缩材料，产生了明显的locking问题，收敛速度明显减慢如表\ref{tab:3-4-1:4}，但是混合形式会改进收敛速度如表\ref{tab:3-4-2:7}。


\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 &  60    & 0.0033304    &             &  18    \\
    \hline
    1 &  260   &  0.0020755  & 1.604625391    &   514    \\
    \hline
    2 &  1\,476  &  0.00059156  &  3.508519846   &       1\,874  \\
    \hline
    3 & 9\,860   & 0.00015686  & 3.771260997    &  5\,536 \\
    \hline
    4 & 71\,940  & 4.017e-05  &  3.904904157   & 11\,882 \\
    \hline
    5 & 549\,380 & 1.0165e-05  &  3.951795376   & 25\,410
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1)$, displacement and pressure formulation, mixed b.c. 3d}
  \label{tab:3-4-2:5}
\end{table}

\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|p-p_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 &  60    & 0.019408    &             &  18    \\
    \hline
    1 &  260   & 0.0086747   &  2.2373108   &   514    \\
    \hline
    2 & 1\,476   & 0.0027838   &  3.116136217   &     1\,874   \\
    \hline
    3 & 9\,860   & 0.00092882  &  2.997136151   &  5\,536  \\
    \hline
    4 & 71\,940  & 0.0003597  &   2.582207395  &  11\,882 \\
    \hline
    5 & 549\,380 & 0.00015766  &  2.281491818   & 25\,410
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1)$, displacement and pressure formulation, mixed b.c. 3d}
  \label{tab:3-4-2:6}
\end{table}


\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|\mathbf u-\mathbf u_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 &  60    &  1.0789   &             &   23   \\
    \hline
    1 &  260   &  0.33259  &  3.243933973   &    1\,303   \\
    \hline
    2 &  1\,476  &  0.11727  &  2.836104716   &    10\,510     \\
    \hline
    3 & 9\,860   & 0.032122 &  3.650768943   &  30\,998 \\
    \hline
    4 & 71\,940  & 0.0083777  & 3.834226578    & 71\,992 \\
    \hline
    5 & 549\,380 & 0.0021355  &  3.923062515   & 174\,109
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1000)$, displacement and pressure formulation, mixed b.c. 3d}
  \label{tab:3-4-2:7}
\end{table}

\begin{table}[!htbp]
  \centering
  \begin{tabular}{r|r|l|l|r}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\|p-p_h\|_{L^2}$} & \multicolumn{1}{c|}{ROC} & PCG\\
    \hline
    0 &  60    &  15.26   &             &   23   \\
    \hline
    1 &  260   &  13.499  &  1.130454108   &   1\,303    \\
    \hline
    2 &  1\,476  & 1.8218   &  7.409704688   &    10\,510     \\
    \hline
    3 & 9\,860   &0.45637  &  3.991936367   & 30\,998  \\
    \hline
    4 & 71\,940  & 0.12085  &  3.776334299   &  71\,992 \\
    \hline
    5 & 549\,380 & 0.03185  &  3.794348509   & 174\,109
  \end{tabular}  
  \caption{$(\mu,\lambda)=(1,1000)$, displacement and pressure formulation, mixed b.c. 3d}
  \label{tab:3-4-2:8}
\end{table}


\newpage
\subsection{线弹性方程位移/压强PPP形式}
PPP形式参考\cite{Lamichhane}中(3.3)式。
\subsubsection{偏微分方程和边界条件}
\begin{subequations}
  \begin{align}
    \label{eq:3-1:7}
    -\nabla\cdot\mathbf \sigma=& \mathbf b & \mathbf x\in\Omega\,,\\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t & \mathbf x\in\Gamma_N\,,\\
    \mathbf u =& \mathbf g &\mathbf x\in\Gamma_D\,.
  \end{align}
\end{subequations}

\subsubsection{变分形式}
\begin{formulation}[\underline{\textbf{变分形式}}]
找到$(\mathbf u,p)\in\mathbf V_{\mathbf g}\times Q$使得
\begin{align*}
  &\int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+p \nabla\cdot\mathbf v\right)\ud x =
  \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\\
  &\int_{\Omega}\nabla\cdot\mathbf u q\ud x - \left(\frac{1}{\lambda}\int_{\Omega}pq\ud x + \int_{\Omega}(p-\rho_{k-1}p)(q-\rho_{k-1}q)\ud x\right) = 0
\end{align*}
对所有的$(\mathbf v,q)\in\mathbf V_{0}\times Q$成立。
\end{formulation}

\subsubsection{有限元离散}
\begin{formulation}[\underline{\textbf{离散形式}}]
找到$(\mathbf u_h,p_h)\in\mathbf V_{\mathbf g,h}\times Q_h$使得
\begin{align*}
  &\int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u_h) :\mathbf\varepsilon(\mathbf v_h)+p_h \nabla\cdot\mathbf v_h\right)\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x\\
  &\int_{\Omega}\nabla\cdot\mathbf u_h q_h\ud x - \left(\frac{1}{\lambda}\int_{\Omega}p_hq_h\ud x + \int_{\Omega}(p_h-\rho_{k-1}p_h)(q_h-\rho_{k-1}q_h)\ud x\right) = 0
\end{align*}
对所有的$(\mathbf v_h,q_h)\in\mathbf V_{0,h}\times Q_h$成立。
\end{formulation}


\begin{figure}[!htbp]
  \centering
    \label{fig:3-4-2:2a}
    \includegraphics[height=4cm]{fig/3/3.4.3/fig3-4-3-1.png}
  \caption{reference element}
\end{figure}

\begin{align*}
    & \int_{\hat T}\left[\left(1+\frac{1}{\lambda}\right)\hat\varphi_1 - \frac{1}{3}\right]\left(\hat\xi_1 + \frac{\lambda}{3}\right)\ud \mathbf x \\
  = & \int_0^1\int_0^{1-x}\left[\left(1+\frac{1}{\lambda}\right)(1-x-y) - \frac{1}{3}\right]\left(3-4x-4y + \frac{\lambda}{3}\right)\ud y\ud x \\
  = & \int_0^1\int_0^{1-x}\left[\left(1+\frac{1}{\lambda}\right)(1-x-y)(-4y) + \frac{4}{3}y\right]\ud y\ud x \\
  & +  \int_0^1\int_0^{1-x}\left[\left(1+\frac{1}{\lambda}\right)(1-x-y) - \frac{1}{3}\right]\left(3-4x + \frac{\lambda}{3}\right)\ud y\ud x \\
    = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\left(\frac{1}{2}y^2-x\frac{1}{2}y^2-\frac{1}{3}y^3\right)(-4) + \frac{2}{3}y^2\right]|_0^{1-x}\ud x \\
    & +  \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\left(y-xy-\frac{1}{2}y^2\right) - \frac{1}{3}y\right]\left(3-4x + \frac{\lambda}{3}\right)|_0^{1-x}\ud x\\
    = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{6}(1-x)^3(-4) + \frac{2}{3}(1-x)^2\right]\ud x \\
    & +  \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right]\left(3-4x + \frac{\lambda}{3}\right)\ud x\\
        = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{6}(1-x)^3(-4) + \frac{2}{3}(1-x)^2\right]\ud x \\
        & +  \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right]\left(3 + \frac{\lambda}{3}\right)\ud x \\
        & +  \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right](-4x) \ud x \\
        = & \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{6}(1-x)^4 - \frac{2}{3}\frac{1}{3}(1-x)^3\right]|_0^1 \\
        & + \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3}(1-x)^3(-1) + \frac{1}{3}\frac{1}{2}(1-x)^2\right]\left(3 + \frac{\lambda}{3}\right)|_0^1 \\
        & +  \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\left(\frac{1}{2}x^2-\frac{2}{3}x^3+ \frac{1}{4}x^4\right) - \frac{1}{3}\left(\frac{1}{2}x^2-\frac{1}{3}x^3\right)\right](-4) |_0^1\\
        = & -\left(1+\frac{1}{\lambda}\right)\frac{1}{6} + \frac{2}{3}\frac{1}{3} 
         - \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3}(-1) + \frac{1}{3}\frac{1}{2}\right]\left(3 + \frac{\lambda}{3}\right) 
         +  \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{12} - \frac{1}{3}\frac{1}{6}\right](-4) \\
         = & -\left(1+\frac{1}{\lambda}\right)\frac{1}{6} + \frac{2}{3}\frac{1}{3} 
         + \left(1+\frac{1}{\lambda}\right)\frac{1}{2} - \frac{1}{2}
         + \left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3}\frac{\lambda}{3} - \frac{1}{3}\frac{1}{2}\frac{\lambda}{3}
         -  \left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3} + \frac{2}{3}\frac{1}{3}\\
                  = & \left(1+\frac{1}{\lambda}\right)\frac{1}{6} 
\end{align*}


\begin{align*}
    & \int_{\hat T}\left[\left(1+\frac{1}{\lambda}\right)\hat\varphi_1 - \frac{1}{3}\right]\left(\hat\xi_2 + \frac{\lambda}{3}\right)\ud \mathbf x \\
  = & \int_0^1\int_0^{1-x}\left[\left(1+\frac{1}{\lambda}\right)(1-x-y) - \frac{1}{3}\right]\left(4x-1 + \frac{\lambda}{3}\right)\ud y\ud x \\
  = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\left(y - xy -\frac{1}{2}y^2\right) - \frac{1}{3}y\right]\left(4x-1 + \frac{\lambda}{3}\right)|_0^{1-x}\ud x \\
  = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\left((1-x) - x(1-x) -\frac{1}{2}(1-x)^2\right) - \frac{1}{3}(1-x)\right]\left(4x-1 + \frac{\lambda}{3}\right)\ud x \\
  = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right]\left(4x-1 + \frac{\lambda}{3}\right)\ud x \\
  = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right]4x\ud x  \\
  & - \int_0^1\left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right]\left(1 - \frac{\lambda}{3}\right)\ud x \\
  = & \left[\left(1+\frac{1}{\lambda}\right)2\left(\frac{1}{2}x^2-\frac{2}{3}x^3 + \frac{1}{4}x^4\right) - \frac{4}{3}\left(\frac{1}{2}x^2-\frac{1}{3}x^3\right)\right]|_0^1  \\
  & - \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\left(x-x^2+\frac{1}{3}x^3\right) - \frac{1}{3}\left(x-\frac{1}{2}x^2\right)\right]\left(1 - \frac{\lambda}{3}\right)|_0^1 \\
  = &  \left(1+\frac{1}{\lambda}\right)\frac{1}{6} - \frac{4}{3}\frac{1}{6}
  - \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{6} - \frac{1}{6}\right]\left(1 - \frac{\lambda}{3}\right) \\
  = &  \left(1+\frac{1}{\lambda}\right)\frac{1}{6} - \frac{4}{3}\frac{1}{6} - \left(1+\frac{1}{\lambda}\right)\frac{1}{6} + \frac{1}{6}
  + \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{6} - \frac{1}{6}\right]\frac{\lambda}{3} \\
  = &   - \frac{1}{3}\frac{1}{6} 
  + \left[\left(1+\frac{1}{\lambda}\right)\frac{1}{6} - \frac{1}{6}\right]\frac{\lambda}{3}\\
  = &  - \frac{1}{3}\frac{1}{6} 
  + \frac{1}{\lambda}\frac{1}{6}\frac{\lambda}{3} \\
  = & 0
\end{align*}


\begin{align*}
    & \int_{\hat T}\left[\left(1+\frac{1}{\lambda}\right)\hat\varphi_1 - \frac{1}{3}\right]\left(\hat\xi_3 + \frac{\lambda}{3}\right)\ud \mathbf x \\
  = & \int_0^1\int_0^{1-x}\left[\left(1+\frac{1}{\lambda}\right)(1-x-y) - \frac{1}{3}\right]\left(4y - 1 + \frac{\lambda}{3}\right)\ud y\ud x  \\
  = & \int_0^1\int_0^{1-x}\left[\left(1+\frac{1}{\lambda}\right)(1-x-y)4y - \frac{4}{3}y
    + \left(\left(1+\frac{1}{\lambda}\right)(1-x-y) - \frac{1}{3}\right)\left(- 1 + \frac{\lambda}{3}\right)\right]\ud y\ud x \\
  = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)4\left(\frac{1}{2}y^2-x\frac{1}{2}y^2-\frac{1}{3}y^3\right) - \frac{2}{3}y^2
    + \left(\left(1+\frac{1}{\lambda}\right)(y-xy-\frac{1}{2}y^2) - \frac{1}{3}y\right)\left(- 1 + \frac{\lambda}{3}\right)\right]|_0^{1-x}\ud x\\
  = & \int_0^1\left[\left(1+\frac{1}{\lambda}\right)4\frac{1}{6}(1-x)^3 - \frac{2}{3}(1-x)^2
    + \left(\left(1+\frac{1}{\lambda}\right)\frac{1}{2}(1-x)^2 - \frac{1}{3}(1-x)\right)\left(- 1 + \frac{\lambda}{3}\right)\right]\ud x \\
  = & \left(1+\frac{1}{\lambda}\right)\frac{2}{3}\frac{1}{4}(1-x)^4(-1) - \frac{2}{3}\frac{1}{3}(1-x)^3(-1)
  + \left(\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3}(1-x)^3(-1) - \frac{1}{3}\frac{1}{2}(1-x)^2(-1)\right)\left(- 1 + \frac{\lambda}{3}\right) \\
  = & \left(1+\frac{1}{\lambda}\right)\frac{2}{3}\frac{1}{4} - \frac{2}{3}\frac{1}{3}
  + \left(\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3} - \frac{1}{3}\frac{1}{2}\right)\left(- 1 + \frac{\lambda}{3}\right)\\
  = & \left(1+\frac{1}{\lambda}\right)\frac{1}{3}\frac{1}{2} - \frac{2}{3}\frac{1}{3}
  -\left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3} + \frac{1}{3}\frac{1}{2}
  + \left(1+\frac{1}{\lambda}\right)\frac{1}{2}\frac{1}{3}\frac{\lambda}{3} - \frac{1}{3}\frac{1}{2}\frac{\lambda}{3}\\
    = &  - \frac{2}{3}\frac{1}{3}
   + \frac{1}{3}\frac{1}{2}
   + \frac{1}{2}\frac{1}{3}\frac{1}{3} \\
   = &  - \frac{1}{2}\frac{1}{3}\frac{1}{3}
   + \frac{1}{2}\frac{1}{3}\frac{1}{3} \\
   = & 0
\end{align*}



\begin{figure}[!htbp]
  \centering
    \label{fig:3-4-2:2a}
    \includegraphics[height=4cm]{fig/3/3.4.3/fig3-4-3-2.png}
  \caption{basis functions}
\end{figure}

\begin{align*}
  3\xi_1 - \xi_2 =& a\\
  -\xi_1 + 3\xi_2 - \xi_3=& b\\
  -\xi_2 + 3\xi_3=& c
\end{align*}

\begin{align*}
  8\xi_2 - 3\xi_3=& 3b + a\\
  -\xi_2 + 3\xi_3=& c
\end{align*}

\begin{align*}
  \xi_2 = \frac{3b + a + c}{7}
\end{align*}

\begin{align*}
  \sigma_K=\left\{
    \begin{array}{cc}
      \frac{1}{\sqrt{\mathrm{area}(K)}} & x\in K\\
      0 & x\notin K
    \end{array}
    \right.
\end{align*}

\begin{align*}
   p_h=&\sum_{j=1}^nU_j\phi_j 
\end{align*}

\begin{align*}
   p_h - \Pi p_h=\sum_{j=1}^nU_j(\phi_j - \Pi\phi_j)
\end{align*}

\begin{align*}
  \Pi\phi_j = &  \sum_{K\in\Omega_h}\left(\int_{\Omega}\phi_j\sigma_K\ud x\right)\sigma_K\\
  = &  \sum_{K\in\Omega_h}\left(\int_{K}\phi_j\sigma_K\ud x\right)\sigma_K
\end{align*}

\begin{figure}[!htbp]
  \centering
    \label{fig:3-4-2:2a}
    \includegraphics[height=6cm]{fig/3/3.4.3/fig3-4-3-4.png}
  \caption{basis functions}
\end{figure}

\begin{align*}
  \int_{\hat K} (1 - x - y)\sigma_K\ud x\ud y =& \int_0^1\int_0^{1-x} (1 - x - y)2\ud y\ud x \\
  =& \int_0^1 2\left(y - xy - \frac{1}{2}y^2\right)|_{0}^{1-x}\ud x \\
  =& \int_0^1 2\left((1-x) - x(1-x) - \frac{1}{2}(1-x)^2\right) \ud x \\
  =& \int_0^1 2\frac{1}{2}(1-x)^2 \ud x \\
  =& -\frac{1}{3}(1-x)^3|_0^1 \\
  =& \frac{1}{3}
\end{align*}

\begin{align*}
  \int_{\hat K} x\sigma_K\ud x\ud y =& \int_0^1\int_0^{1-x} x2\ud y\ud x \\
  =& \int_0^1 2xy|_{0}^{1-x}\ud x \\
  =& \int_0^1 2x(1-x)\ud x \\
  =& \left(x^2 - \frac{2}{3}x^3\right)|_0^1 \\
  = & \frac{1}{3}
\end{align*}

\begin{align*}
  \int_{\hat K} y\sigma_K\ud x\ud y =& \int_0^1\int_0^{1-x} y2\ud y\ud x \\
  =& \int_0^1 y^2|_{0}^{1-x}\ud x \\
  =& \int_0^1 (1-x)^2\ud x \\
  =& \left(- \frac{1}{3}(1-x)^3\right)|_0^1 \\
  = & \frac{1}{3}
\end{align*}

\begin{align*}
  &\int_{\Omega}(p_h-\Pi p_h)(q_h-\Pi q_h)\ud x\\
  = &\sum_{j=1}^nU_j\int_{\Omega}(\phi_j-\Pi \phi_j)(\phi_i-\Pi \phi_i)\ud x\\
  =&\sum_{j=1}^nU_j\int_{\Omega}\left(\phi_j - \sum_{K\in\Omega_h}\left(\int_{K}\phi_j\sigma_K\ud x\right)\sigma_K\right)\left(\phi_i - \sum_{K\in\Omega_h}\left(\int_{\Omega}\phi_i\sigma_K\ud x\right)\sigma_K\right)\ud x\\
  =&\sum_{j=1}^nU_j\left[\sum_K\int_{K}\left(\phi_j - \sum_{K\in\Omega_h}\left(\int_{K}\phi_j\sigma_K\ud x\right)\sigma_K\right)\left(\phi_i - \sum_{K\in\Omega_h}\left(\int_{\Omega}\phi_i\sigma_K\ud x\right)\sigma_K\right)\ud x\right]
\end{align*}


\subsubsection{线性方程组}


\subsubsection{算例}

\begin{problem}[2D Mixed]\label{problem:5}
  \begin{align*}
    &-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u= \mathbf b &\mathbf x\in\Omega\\
    &\mathbf u = \mathbf g &\mathbf x\in\Gamma_D\\
    &\mathbf \sigma\cdot\mathbf n = \mathbf t &\mathbf x\in\Gamma_N
  \end{align*}
  \begin{align*}
    &\Omega:=(0,1)^2\\
    &\Gamma_D:=\{x_1=0\}\cup\{x_2=0\}
  \end{align*}
  \begin{align*}
    \mathbf u =& \left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \qquad\mathbf b =& 2(2\mu+\lambda)\pi ^2\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)  \\
      \cos(\pi x_1)\sin(\pi x_2) 
    \end{array}\right)
  \end{align*}
  \begin{align*}
    \mathbf \sigma 
   =&\left(\begin{array}{cc}
    2(\mu+\lambda)\pi \cos(\pi x_1)\cos(\pi x_2) &    -2\mu\pi \sin(\pi x_1)\sin(\pi x_2) \\
    -2\mu\pi \sin(\pi x_1)\sin(\pi x_2) &     2(\mu+\lambda)\pi \cos(\pi x_1)\cos(\pi x_2)
  \end{array}\right) 
  \end{align*}
  \begin{align*}
    p=\lambda\nabla\cdot \mathbf u 
   =2\lambda\pi \cos(\pi x_1)\cos(\pi x_2)
  \end{align*}
  
\end{problem}

\begin{figure}[!htbp]
  \centering
  \subfigure[$(\mu,\lambda)=(1,1)$]{
    \label{fig:3-4-3:1a}
    \includegraphics[height=5cm]{fig/3/3.4.3/1.pdf}
  }\qquad
  \subfigure[$(\mu,\lambda)=(1,1000)$]{
    \label{fig:3-4-3:1b}
    \includegraphics[height=5cm]{fig/3/3.4.3/2.pdf}
  }
  \caption{level 4}
  \label{fig:3-4-3:1}
\end{figure}

收敛速度受到有限元误差、给定项插值误差、数值积分误差、locking问题、混合形式和PPP算法的影响。混合形式中压强是一个对流方程，稳定性肯定不好，P1P1单元由于\textcolor{red}{离散空间不一致？}，没有从有限元单元定义上改进稳定性，因此不满足稳定性条件，PPP算法添加penalty或者稳定因子增强扩散效果，\textcolor{red}{保持一致性？}，满足稳定性条件。添加稳定因子和未添加稳定因子的问题形式是不一致的，因此会引起数值解的偏差，但是添加和未添加稳定因子的数值解都要收敛到同一个解上，这也是PPP算法中projection的作用。在网格比较稀疏情况下，由于添加了稳定因子，数值解产生了比较大的偏差，可以对稳定因子乘以一个系数降低稳定因子的影响，如图。在网格足够加密的情况下，有限元误差占主导，P1P1算法位移和压强为二次收敛，PPP算法位移和压强为二次和一次收敛，在实际计算中PPP压强收敛速度高于一次。

当$(\mu,\lambda)=(1,1000)$泊松比接近0.5时，是近不可压缩材料，位移/压强形式避免了locking问题，该算例没有发生数值震荡，PPP的稳定因子会引起$\mathbf u_h$初始误差增大，但不影响收敛速度如表\ref{tab:3-4-3:3}和图\ref{fig:3-4-3:1b}。文章\cite{Lamichhane}(3.7)和(3.8)式中的$g$-biorthogonality是用于方便消除线性方程组中的压强变量。

\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l|l}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$L^2$-error} & \multicolumn{1}{c}{ROC|} & PCG \\
    \hline
    0 & 15 & 0.13405  &   & \\
    \hline
    1 & 39 & 0.023615   & 5.6764768 & \\
    \hline
    2 & 123 & 0.0057522   & 4.1053858 & \\
    \hline
    3 & 435 & 0.0014833   & 3.8779748 & \\
    \hline
    4 & 1\,635 & 0.0003769   & 3.9353178 & \\
    \hline
    5 & 6\,339 & 0.0000947   & 3.9789714 & \\
    \hline
    6 & 24\,963 & 0.0000237   & 3.9937603  &
  \end{tabular}
  \caption{2D, displacement and pressure, PPP, $(\mu,\lambda)=(1,1)$, $\mathbf u$}
  \label{tab:3-4-3:1}
\end{table}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$L^2$-error}  & \multicolumn{1}{c}{cov} \\
    \hline
    0 & 15 & 0.64372  &   \\
    \hline
    1 & 39 & 0.20425   & 3.1516279 \\
    \hline
    2 & 123 & 0.050326   & 4.0585383 \\
    \hline
    3 & 435 & 0.012773   & 3.9400298 \\
    \hline
    4 & 1\,635 & 0.0033412   & 3.822878 \\
    \hline
    5 & 6\,339 & 0.0009076   &  3.6811952 \\
    \hline
    6 & 24\,963 & 0.0002595   & 3.4969755
  \end{tabular}
  \caption{2D, displacement and pressure, PPP, $(\mu,\lambda)=(1,1)$, $p$}
  \label{tab:3-4-3:2}
\end{table}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$L^2$-error} & \multicolumn{1}{c}{cov} \\
    \hline
    0 & 15 & 0.1413  &   \\
    \hline
    1 & 39 & 18.438   & 0.0076635   \\
    \hline
    2 & 123 & 5.4221   & 3.4005275   \\
    \hline
    3 & 435 & 1.424   &  3.8076545  \\
    \hline
    4 & 1\,635 & 0.36163   &  3.9377264  \\
    \hline
    5 & 6\,339 & 0.090947   &  3.9762719  \\
    \hline
    6 & 24\,963 & 0.022795   &  3.9897785
  \end{tabular}
  \caption{$\mathbf u$，$(\mu,\lambda)=(1,1000)$}
  \label{tab:3-4-3:3}
\end{table}
\begin{table}[!htbp]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$L^2$-error} & \multicolumn{1}{c}{cov} \\
    \hline
    0 & 15 & 628.49  &   \\
    \hline
    1 & 39 & 308.29   & 2.0386325   \\
    \hline
    2 & 123 & 87.325   & 3.530375 \\
    \hline
    3 & 435 & 23.616    &  3.6977049 \\
    \hline
    4 & 1\,635 & 6.5745   & 3.5920602 \\
    \hline
    5 & 6\,339 & 1.9201   &  3.4240404 \\
    \hline
    6 & 24\,963 & 0.59266   & 3.2398002
  \end{tabular}
  \caption{$p$，$(\mu,\lambda)=(1,1000)$}
  \label{tab:3-4-3:4}
\end{table}



\clearpage
\section{瞬态线弹性方程} 
\subsection{偏微分方程和初始/边界条件}
\begin{mdframed}[style=mystyle1]
\begin{subequations}
  \begin{align}
    \label{eq:3.6.1:1a}
    \rho\ddot{\mathbf u}-\nabla\cdot\mathbf \sigma=& \mathbf b & x\in\Omega \\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t & x\in\Gamma_N\\
    \mathbf u =& \mathbf g & x\in\Gamma_D\\
    \mathbf u(0,x) = & \mathbf h_1 & x\in\overline\Omega\\
    \dot{\mathbf u}(0,x) = & \mathbf h_2 & x\in\overline\Omega
  \end{align}
\end{subequations}
\end{mdframed}

\subsection{变分形式}
对\eqref{eq:3.6.1:1a}两边点乘$\mathbf v$做$\Omega$上积分得到
\begin{align*}
 \int_{\Omega}\rho\frac{\partial ^2 \mathbf u}{\partial t^2}\cdot\mathbf v\ud x -\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\,.
\end{align*}
\begin{mdframed}[style=mystyle1]
找到$\mathbf u(t,x)\in (0,T]\times\mathbf V_{\mathbf g}$使得
\begin{align*}
  \int_{\Omega}\rho\frac{\partial ^2 \mathbf u}{\partial t^2}\cdot\mathbf v\ud x + \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+\lambda\nabla\cdot\mathbf u \nabla\cdot\mathbf v\right)\ud x =
  \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
对所有的$\mathbf v\in\mathbf V_{0}$成立。
\end{mdframed}
  
\subsection{有限元离散}
\begin{mdframed}[style=mystyle1]
找到$\mathbf u_h(t,x)\in (0,T]\times\mathbf V_{\mathbf g,h}$使得
\begin{align*}
  \int_{\Omega}\rho\frac{\partial ^2 \mathbf u_h}{\partial t^2}\cdot\mathbf v_h\ud x + \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u_h) :\mathbf\varepsilon(\mathbf v_h)+\lambda\nabla\cdot\mathbf u_h \nabla\cdot\mathbf v_h\right)\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x
\end{align*}
对所有的$\mathbf v_h\in\mathbf V_{0,h}$成立。
\end{mdframed}

\subsection{线性方程组}
\begin{mdframed}[style=mystyle1]
\begin{align*}
  M\ddot U + K U = f
\end{align*}
\end{mdframed}

\subsection{时间离散}
\textcolor{red}{
  这种时间离散是错误的，对于抛物线方程时间导数只有一次，所以只需要forward或者backward，但是双曲的时间导数是两次，如果还按照抛物方程去做forward或者backward，
  很明显时间离散对应空间的误差很大，因此对应时间离散，空间也要做调整。
  \begin{align*}
    M\frac{U^{n+1}-2U^n+U^{n-1}}{k^2} + KU^{n+1} =& f^{n+1}\\
      MU^{n+1} + k^2KU^{n+1} =& k^2f^{n+1} + M(2U^n - U^{n-1})
\end{align*}}

\begin{align*}
  M\frac{U^{n+1}-2U^n+U^{n-1}}{k^2} + K\frac{U^{n+1}+2U^{n}+U^{n-1}}{4} = f^{n}
\end{align*}
\begin{mdframed}[style=mystyle1]
\begin{align*}
  MU^{n+1} + \frac{1}{4}k^2KU^{n+1} = k^2f^{n} + M(2U^n - U^{n-1}) - \frac{1}{4}k^2KU^{n-1} - \frac{1}{2}k^2KU^{n}
\end{align*}
\begin{align*}
  U(0,x)&=\mathbf h_1 \\
  U'(0,x)&=\mathbf h_2\\
  U'(0,x) &\approx \frac{U(0,x) - U(-k,x)}{k}
\end{align*}


\end{mdframed}


\subsection{算例}
\subsubsection{2D Dirichlet B.C.}
\begin{mdframed}[style=mystyle2]
  \begin{align*}
    \rho\ddot{\mathbf u}-\nabla\cdot\mathbf \sigma=& \mathbf b & x\in\Omega \\
    \mathbf u =& \mathbf g & x\in\Gamma\\
    \mathbf u(0,x) = & \mathbf h_1 & x\in\overline\Omega\\
    \dot{\mathbf u}(0,x) = & \mathbf h_2 & x\in\overline\Omega
  \end{align*}

  \begin{align*}
    &\Omega:=(0,1)^2\\
    &\rho =1
  \end{align*}

  \begin{align*}
    \mathbf u =& \mathrm e^t\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right)
  \end{align*}

  \begin{align*}
    \mathbf u(0,x) = \dot{\mathbf u}(0,x)=& \left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right)
  \end{align*}

  \begin{align*}
    \mathbf b 
    =&\ddot{\mathbf u}-(\mu+\lambda)\nabla(\nabla\cdot\mathbf u) - \mu\nabla^2\mathbf u\\
    =&\mathrm e^t\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)\\
      \cos(\pi x_1)\sin(\pi x_2)
    \end{array}\right) + \mathrm e^t2(2\mu+\lambda)\pi^2\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)  \\
      \cos(\pi x_1)\sin(\pi x_2) 
    \end{array}\right)\\
    =& \mathrm e^t(1+2(2\mu+\lambda)\pi^2)\left(\begin{array}{c}
      \sin(\pi x_1)\cos(\pi x_2)  \\
      \cos(\pi x_1)\sin(\pi x_2) 
    \end{array}\right)
  \end{align*}
\end{mdframed}

\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/1.png}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, $(l_h,l_t)=(4,5)$, dirichlet b.c.}
  \label{fig:4-3-1:1}
\end{figure}

\newpage

\begin{table}[H]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level} & \multicolumn{1}{c|}{$\|\mathbf u - \mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0,1)& 0.18156 & \\
    \hline
    (1,2)&0.043462 &         4.177442363 \\
    \hline
    (2,3)&0.012657  &        3.433831082 \\
    \hline
    (3,4)&0.0035181  &       3.597680566 \\
    \hline
    (4,5)&0.00091219  &      3.856762297\\
    \hline
    (5,6)&0.00023056   &     3.956410479\\
    \hline
    (6,7)&5.7836e-05    &    3.9864\\
    \hline
    (7,8)&1.4475e-05     &   3.995578584 \\
    \hline
    (8,9)&3.6203e-06 & 3.99828743
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, dirichlet b.c.}
  \label{tab:4-3-1:1}
\end{table}


\subsubsection{2D Mixed B.C.}
  

\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/2.png}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, $(l_h,l_t)=(4,5)$, mixed b.c.}
  \label{fig:4-3-2:1}
\end{figure}

\newpage
\begin{table}[H]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\|\mathbf u - \mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0,1) & 0.17469 & \\
    \hline
    (1,2) & 0.040526 &           4.310566056\\
    \hline
    (2,3) & 0.011555  &          3.507226309\\
    \hline
    (3,4) & 0.0031476  &         3.67096932\\
    \hline
    (4,5) & 0.00081516  &        3.861327837\\
    \hline
    (5,6) & 0.00020617   &       3.953824514\\
    \hline
    (6,7) & 5.1739e-05    &      3.9848\\
    \hline
    (7,8) & 1.2954e-05     &     3.99405589\\
    \hline
    (8,9) & 3.2404e-06     &     0.399765461
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, 2d mixed b.c.}
  \label{tab:4-3-1:1}
\end{table}



\subsubsection{3D Dirichlet B.C.}
  
\begin{table}[H]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\|\mathbf u - \mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0,1) & 0.0199 & \\
    \hline
    (1,2) & 0.0064161 &    3.101572606       \\
    \hline
    (2,3) & 0.0018385  &   3.489855861       \\
    \hline
    (3,4) & 0.00047845  &  3.842616783       \\
    \hline
    (4,5) & 0.00012046  &  3.971857878      \\
    \hline
    (5,6) & 3.0035e-05   & 4.0107 \\
    \hline
    (6,7) & 7.4785e-06 & 4.016179715
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, 3d dirichlet b.c.}
  \label{tab:4-3-1:1}
\end{table}


\subsubsection{3D Mixed B.C.}

\begin{table}[H]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\|\mathbf u - \mathbf u_h\|_{L^2}$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0,1) & 0.015677 & \\
    \hline
    (1,2) & 0.0047315  &    3.313325584      \\
    \hline
    (2,3) & 0.0013579  &    3.484424479       \\
    \hline
    (3,4) & 0.00036259 &    3.745001241       \\
    \hline
    (4,5) & 9.1995e-05 &    3.9414      \\
    \hline
    (5,6) & 2.3058e-05 & 3.989721572 
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, 3d mixed b.c.}
  \label{tab:4-3-1:1}
\end{table}




\subsubsection{Traction}
\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/3.png}
  \caption{蓝色边固定，红色边始终保持垂直向上大小为(0,1,0)的力，弹性模量为2.5，泊松比为0.25。}
  \label{fig:3.6.6:3}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/3.6.6.5:1.png}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 2d by M++}
  \label{fig:3.6.6.5:1}
\end{figure}
\begin{table}[H]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\max\|\mathbf u_h\|_2$}  & \multicolumn{1}{c}{ROC} \\
    \hline
 (4,5) &  0.3249562933566073 & \\
    \hline
 (5,6) &  0.3297781783614334 &   0.004821885 \\
    \hline
 (6,7) &  0.3308362930444164       &   0.001058115 \\
    \hline
 (7,8) &  0.33162117725911733      &   0.000784884 \\
    \hline
 (8,9) &  0.331920443785975        &   0.000299267
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 2d by M++}
  \label{tab:4-3-1:1}
\end{table}



\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/3.6.6.5:4.png}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 3d by M++}
  \label{fig:3.6.6.5:1}
\end{figure}
\begin{table}[H]
  \centering
  \begin{tabular}{c|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\max\|\mathbf u_h\|_2$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0,5) & 0.33026386382409095 & \\
    \hline
    (1,6) & 0.3331673931969547 & 0.002903529 \\
    \hline
    (2,7) & 0.3320205649356582 & 0.001146828
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 3d by M++}
  \label{tab:4-3-1:1}
\end{table}




\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/3.6.6.5:2.png}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 2d by Abaqus}
  \label{fig:3.6.6.5:2}
\end{figure}
\begin{table}[H]
  \centering
  \begin{tabular}{l|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\max\|\mathbf u_h\|_2$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0.1,0.05) & 0.3302  & \\
    \hline
    (0.05,0.025) & 0.3337  &    \\
    \hline
    (0.025,0.0125) &     0.3344    &    \\
    \hline
    (0.0125,0.00625) &     0.3343   &    
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 2d by Abaqus}
  \label{tab:4-3-1:1}
\end{table}

\begin{figure}[H]
  \centering
  \includegraphics[height=5cm]{fig/3/3.6.6/3.6.6.5:3.png}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 3d by Abaqus}
  \label{fig:3.6.6.5:2}
\end{figure}
\begin{table}[H]
  \centering
  \begin{tabular}{l|l|l}
    \multicolumn{1}{c|}{level}  & \multicolumn{1}{c|}{$\max\|\mathbf u_h\|_2$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    (0.1,0.05) & 0.3302  & \\
    \hline
    (0.05,0.025) & 0.3334  &    \\
    \hline
    (0.025,0.0125) &     0.3333    &    \\
    \hline
    (0.0125,0.00625) &     0.3323   &    
  \end{tabular}
  \caption{$T=0.5$, $(E,\nu)=(2.5,0.25)$, traction 3d by Abaqus}
  \label{tab:4-3-1:1}
\end{table}
























\newpage
\section{静态弹塑性方程}


\subsection{偏微分方程和初始/边界条件}
静态弹塑性方程和边界条件为，
\begin{shaded}
\begin{subequations}
  \begin{align}
    \label{eq:3-4-15a}
    -\nabla\cdot\mathbf \sigma=& \mathbf b & x\in\Omega \,,\\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t & x\in\Gamma_N\,,\\
    \mathbf u =& \mathbf g & x\in\Gamma_D\,.
  \end{align}
\end{subequations}
\end{shaded}

\subsection{变分形式}
\iffalse
\begin{align*}\label{eq:}
    \int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x  =&  \int_{\Omega}\left(
    \sum_{i=1}^3\frac{\partial \sigma_{i1}}{\partial x_i}v_1 + \sum_{i=1}^3\frac{\partial \sigma_{i2}}{\partial x_i}v_2 + \sum_{i=1}^3\frac{\partial \sigma_{i3}}{\partial x_i}v_3
    \right)\ud x  \notag\\ 
    =&  \int_{\Omega}\left(
    \nabla\cdot\mathbf\sigma_{\cdot 1}v_1 + \nabla\cdot\mathbf\sigma_{\cdot 2}v_2 + \nabla\cdot\mathbf\sigma_{\cdot 3}v_3
    \right)\ud x \notag\\
    =&\int_{\Gamma}\left(
    \mathbf n\cdot\mathbf \sigma_{\cdot 1}v_1 + \mathbf n\cdot\mathbf \sigma_{\cdot 2}v_2 + \mathbf n\cdot\mathbf\sigma_{\cdot 3}v_3\right)\ud s_x     \notag\\
    &-\int_{\Omega}\left(
    \nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}\right)\ud x\,.
\end{align*}

\begin{align*}
  &\nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}\\
  =&\frac{\partial v_1}{\partial x_1}\sigma_{11} + \frac{\partial v_1}{\partial x_2}\sigma_{21} + \frac{\partial v_1}{\partial x_3}\sigma_{31} 
   + \frac{\partial v_2}{\partial x_1}\sigma_{12} + \frac{\partial v_2}{\partial x_2}\sigma_{22} + \frac{\partial v_2}{\partial x_3}\sigma_{32} \\
  & + \frac{\partial v_3}{\partial x_1}\sigma_{13} + \frac{\partial v_3}{\partial x_2}\sigma_{23} + \frac{\partial v_3}{\partial x_3}\sigma_{33} 
\end{align*}

\begin{align*}
  \mathbf\sigma:\frac{1}{2}(\nabla_{\mathbf x}\mathbf v^T+\nabla_{\mathbf x}\mathbf v)
  = \mathbf\sigma:\frac{1}{2}\left(\begin{array}{ccc}
    2\frac{\partial v_1}{\partial x_1} &     \frac{\partial v_1}{\partial x_2} + \frac{\partial v_2}{\partial x_1} &     \frac{\partial v_1}{\partial x_3} + \frac{\partial v_3}{\partial x_1}\\
    \frac{\partial v_2}{\partial x_1} + \frac{\partial v_1}{\partial x_2} &     2\frac{\partial v_2}{\partial x_2} &     \frac{\partial v_2}{\partial x_3} + \frac{\partial v_3}{\partial x_2}\\
    \frac{\partial v_3}{\partial x_1} + \frac{\partial v_1}{\partial x_3} &     \frac{\partial v_3}{\partial x_2} + \frac{\partial v_2}{\partial x_3} &    2 \frac{\partial v_3}{\partial x_3}
  \end{array}\right)
  = \mathbf\sigma:\nabla^s\mathbf v
\end{align*}

\begin{align*}
  \nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}
  =\mathbf\sigma:\nabla^s\mathbf v
\end{align*}

对\eqref{eq:3-4-15a}两边点乘$\mathbf v$做$\Omega$上积分得到
\begin{align*}
  -\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\\
  \int_{\Omega}\mathbf\sigma:\nabla^s\mathbf v\ud x =& \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
\fi
\begin{shaded}
\begin{definition}[\textbf{变分形式}]
找到$\mathbf u(x)\in \mathbf V_{\mathbf g}$使得
  \begin{align*}
  \int_{\Omega}\mathbf\sigma(\mathbf\varepsilon(\mathbf u)):\nabla^s\mathbf v\ud x =& \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
对所有的$\mathbf v\in\mathbf V_{0}$成立。
\end{definition}
\end{shaded}
  
\subsection{有限元离散}
用$\mathbf u_h(x)$替换$\mathbf u(x)$。
\begin{shaded}
\begin{definition}[\textbf{离散形式}]
找到$\mathbf u_h(x)\in \mathbf V_{\mathbf g,h}$使得
\begin{align*}
  \int_{\Omega}\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h)):\nabla^s\mathbf v_h\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x
\end{align*}
对所有的$\mathbf v_h\in\mathbf V_{0,h}$成立。
\end{definition}
\end{shaded}

\subsection{非线性方程组}
从离散空间基函数系数得到非线性方程组。
\begin{shaded}
\begin{align*}
  K(U) = f
\end{align*}
\end{shaded}

\subsection{非线性Newton方法}
Newton方法简单定义.
\begin{align}
F'(U_k)(U_{k+1}-U_k) + F(U_k) = 0
\end{align}

先来求Frechet derivative。
\begin{align}
  F(U) = K(U) - f = 0
\end{align}
\begin{align*}
  &\lim_{s\rightarrow 0}  \frac{F(U+s U') - F(U) }{s}\\
  =&\lim_{s\rightarrow 0}  \frac{K(U+sU') - K(U)}{s}\\
  =&\lim_{s\rightarrow 0}\left(\frac{\int_{\Omega}(\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h + s\mathbf u_h')-\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h)):\nabla^s\mathbf{v}_i\ud x}{s}\right)_{i}\\
  =&\left(\int_{\Omega}\lim_{s\rightarrow 0}\frac{\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h + s\mathbf u_h'))-\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h))}{s}:\nabla^s\mathbf{v}_i\ud x\right)_{i}\\
  =&\left(\int_{\Omega}\lim_{s\rightarrow 0}\frac{\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h + s\mathbf u_h'))-\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h))}{\mathbf\varepsilon(\mathbf u_h + s\mathbf u_h')-\mathbf\varepsilon(\mathbf u_h)}:\frac{\mathbf\varepsilon(\mathbf u_h + s\mathbf u_h')-\mathbf\varepsilon(\mathbf u_h)}{s}:\nabla^s\mathbf{v}_i\ud x\right)_{i}\\
  =&\left(\int_{\Omega}\frac{\partial\mathbf\sigma}{\partial\mathbf\varepsilon}(\mathbf u_h):\mathbf\varepsilon(\mathbf u_h'):\nabla^s\mathbf{v}_i\ud x\right)_{i}
\end{align*}

因此需要计算三阶张量
\begin{align*}
  \frac{\partial\mathbf\sigma}{\partial\varepsilon}(\mathbf u_h)\qquad\textrm{and}\qquad\mathbf\sigma(\mathbf u_h)
\end{align*}
如果是弹性形变
\begin{align*}
  \frac{\partial\mathbf\sigma}{\partial\varepsilon}
  =\mathbf C
\end{align*}
这里注意$\mathbf u_h$是已知，需要求解的是$\mathbf u_h'$。

\subsubsection{Return Mapping Algorithm For Perfect Plasticity}
Return mapping algorithm用于time dependent方程，对于静态弹塑性时间步只有一步，就是从初始状态，到稳定状态。
\eqref{eq:3.7.1.4:1}和\eqref{eq:3.7.1.4:2}经常用到。
\begin{align}\label{eq:3.7.1.4:1}
  \begin{split}
  &\mathrm{trace}(\mathrm{dev}(A)) \\ = &\mathrm{trace}\left(\begin{array}{ccc} A_{00}-\frac{1}{3}\sum_iA_{ii} & A_{01} & A_{02}\\
    A_{10} & A_{11}-\frac{1}{3}\sum_iA_{ii} & A_{12}\\
     A_{20} & A_{21} & A_{22}-\frac{1}{3}\sum_iA_{ii} \\
    \end{array}\right) = 0
    \end{split}
\end{align}

\begin{align}\label{eq:3.7.1.4:2}
  \mathrm{dev}(\mathrm{trace}(A)\mathbf I) = \mathrm{dev}\left(\begin{array}{ccc} \sum_iA_{ii} & 0 & 0\\
    0 & \sum_iA_{ii} & 0\\
     0 & 0 & \sum_iA_{ii} \\
  \end{array}\right) = 0
\end{align}

在\cite{CermakSysalaValdman}中$K$和$G$定义为
\begin{align*} 
  K = & \frac{E}{3(1-2\upsilon)}\,, \\
  G = & \frac{E}{2(1+\upsilon)}\,,
\end{align*}
$E$ is Young's modulus and $\upsilon$ is Poisson's ratio.
\begin{align*}
  \mu=\frac{E}{2(1+\upsilon)}\qquad\lambda=\frac{Ev}{(1+\upsilon)(1-2\upsilon)}
\end{align*}

给出perfect plasticity弹塑性本构关系，
\begin{align*}
  &\sigma = \mathbf C:(\varepsilon-\varepsilon^p)\,,\\
  &f (\mathbf \sigma,\mathbf q) = \|\xi\|-\sqrt{\frac{2}{3}}Y, \quad\xi:=\mathrm{dev}(\sigma)\,,\\
  &\dot{\mathbf\varepsilon}^p=\mathbf\gamma\frac{\xi}{\|\xi\|}\,.
\end{align*}
离散后得到
\begin{align*}
  &\|\xi_{n+1}\|-\sqrt{\frac{2}{3}}Y =0\,,\\
  &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\,,\\
  &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\,,
\end{align*}
根据以上求解$\Delta \mathbf\gamma$。

\begin{align*}
  \sigma_{n+1} =& \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n}+\varepsilon^p_{n}-\varepsilon^p_{n+1})\\
  \sigma_{n+1} =& \sigma_{n+1}^{\mathrm{trial}}-\mathbf C:(\varepsilon^p_{n+1}-\varepsilon^p_{n})\\
  \sigma_{n+1} =& \sigma_{n+1}^{\mathrm{trial}}-\mathbf C:\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\\
  \sigma_{n+1} =& \sigma_{n+1}^{\mathrm{trial}}-\left(2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|} +\lambda\mathrm{trace}\left(\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right)\mathbf I\right)\\
  \mathrm{dev}(\sigma_{n+1}) =& \mathrm{dev}(\sigma_{n+1}^{\mathrm{trial}})-2\mu\Delta \mathbf\gamma \frac{\mathrm{dev}(\xi_{n+1})}{\|\xi_{n+1}\|}\\
  \mathrm{dev}(\sigma_{n+1}) =& \mathrm{dev}(\sigma_{n+1}^{\mathrm{trial}})-2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align*}

\begin{align*}
  \xi_{n+1} =& \xi_{n+1}^{\mathrm{trial}}-2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\\
  \left(1+2\mu\Delta \mathbf\gamma \frac{1}{\|\xi_{n+1}\|} \right)\xi_{n+1} =& \xi_{n+1}^{\mathrm{trial}}
\end{align*}


\begin{align*}
  \frac{\xi_{n+1}}{\|\xi_{n+1}\|} = \frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}
\end{align*}

\begin{align*}
  \|\xi_{n+1}\| = \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma
\end{align*}

根据塑性约束条件
\begin{align*}
  \begin{split}
  \|\xi_{n+1}\| - \sqrt{\frac{2}{3}}Y 
  = \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  -  \sqrt{\frac{2}{3}}Y
  = 0
  \end{split}
\end{align*}

\begin{shaded}
\begin{align*}
  \Delta\gamma = \frac{   \|\xi^{\mathrm{trial}}_{n+1}\|    -  \sqrt{\frac{2}{3}}Y }{2\mu}  
\end{align*}
根据$\Delta\gamma$就可以算出$\sigma_{n+1}$，对于静态弹塑性就是$\sigma_{1}$。
\begin{align*}
  &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|} = \mathbf\varepsilon^p_{n}
  + \Delta \mathbf\gamma \frac{\xi_{n+1}^{\mathrm{trial}}}{\|\xi_{n+1}^{\mathrm{trial}}\|}\\
  &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})
\end{align*}
\end{shaded}
  
继续推导tangent modulus。
\begin{align*}
  &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n} - \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right)\\
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n}\right)-\mathbf C:\left(\Delta \mathbf\gamma \frac{\xi_{n+1}^{\mathrm{trial}}}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)\\
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n}\right)-2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}^{\mathrm{trial}}}{\|\xi_{n+1}^{\mathrm{trial}}\|}
\end{align*}

\begin{align}\label{eq:3.7.1.4:3}
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n}\right)-2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}^{\mathrm{trial}}}{\|\xi_{n+1}^{\mathrm{trial}}\|}
\end{align}

\begin{align*}
  \frac{\partial a\mathbf A}{\partial \varepsilon} =&   \frac{\partial }{\partial \varepsilon}\left(\begin{array}{ccc}
    a\mathbf A_{00} & a\mathbf A_{01} & a\mathbf A_{02} \\
    a\mathbf A_{10} & a\mathbf A_{11} & a\mathbf A_{12} \\
    a\mathbf A_{20} & a\mathbf A_{21} & a\mathbf A_{22} 
\end{array}
  \right) \\
  =&\left(\begin{array}{ccccccccc}
    \frac{\partial a}{\partial \varepsilon_{00}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{00}} & \frac{\partial a}{\partial \varepsilon_{01}}\mathbf A_{00} +  a    \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{01}} & \frac{\partial a}{\partial \varepsilon_{02}}\mathbf A_{00} +  a    \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{02}} & & & & & & \\
    \frac{\partial a}{\partial \varepsilon_{10}}\mathbf A_{00} +  a    \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{10}} & \frac{\partial a}{\partial \varepsilon_{11}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{11}} & \frac{\partial a}{\partial \varepsilon_{12}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{12}} & \cdots & & & & & \\
    \frac{\partial a}{\partial \varepsilon_{20}}\mathbf A_{00} +  a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{20}} & \frac{\partial a}{\partial \varepsilon_{21}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{21}} & \frac{\partial a}{\partial \varepsilon_{22}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{22}} & & & & & & \\
    \vdots  &   &  & \ddots & & & & & 
\end{array}
  \right) \\
  =& \frac{\partial a}{\partial \varepsilon}\otimes \mathbf A + a \frac{\partial \mathbf A}{\partial \varepsilon}
\end{align*}

对\eqref{eq:3.7.1.4:1}求导。
\begin{align*}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& \textcolor{red}{2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}}} + \textcolor{blue}{\lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}}} \textcolor{orange}{- 2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}}\textcolor{greendark}{- 2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}}
\end{align*}

\begin{align*}
  \textcolor{red}{2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}} =2\mu\mathbf I}
\end{align*}

\begin{align*}
  \textcolor{blue}{\lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} = \lambda\frac{\partial}{\partial\varepsilon_{n+1}}\left(\begin{array}{ccc}
      \mathrm{tr}(\varepsilon_{n+1}) & 0 & 0 \\
      0 & \mathrm{tr}(\varepsilon_{n+1}) & 0  \\
      0 & 0 & \mathrm{tr}(\varepsilon_{n+1}) 
      \end{array}\right)= \lambda\mathbf 1\otimes\mathbf 1}
\end{align*}

\begin{align*}
  &\frac{\partial}{\partial\varepsilon_{n+1}}\left\{\|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  - \sqrt{\frac{2}{3}}Y \right\}   
  =\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}  - 2\mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}    
  =0
\end{align*}

\begin{align*}
\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}  
  =\frac{1}{2\mu}\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
\end{align*}

\begin{align*}
  \xi^{\mathrm{trial}}_{n+1}
  =&\mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1})\\
  =&\mathrm{dev}\left(2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)+\lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1\right)\\
  =&2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)-\frac{2}{3}\mu\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1
\end{align*}

\begin{align*}
  \|\xi^{\mathrm{trial}}_{n+1}\|
  =&\sqrt{\sum_{ij}{\xi^{\mathrm{trial}}_{n+1,ij}}^2}
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{{n+1}}\|}{\partial\varepsilon_{n+1}}
  =&\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}
  \left(\begin{array}{ccc}\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,ii}}}{\partial \varepsilon_{00}} & 2\xi^{\mathrm{trial}}_{{n+1,01}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,01}}}{\partial \varepsilon_{01}} & 2\xi^{\mathrm{trial}}_{{n+1,02}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,02}}}{\partial \varepsilon_{02}}\\
    2\xi^{\mathrm{trial}}_{{n+1,10}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,10}}}{\partial \varepsilon_{10}} & \sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,ii}}}{\partial \varepsilon_{11}} & 2\xi^{\mathrm{trial}}_{{n+1,12}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,12}}}{\partial \varepsilon_{12}}\\
    2\xi^{\mathrm{trial}}_{{n+1,20}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,20}}}{\partial \varepsilon_{20}} & 2\xi^{\mathrm{trial}}_{{n+1,21}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,21}}}{\partial \varepsilon_{21}} &\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,ii}}}{\partial \varepsilon_{22}}
  \end{array}\right)\\
  =&\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}
  \left(\begin{array}{ccc}2\xi^{\mathrm{trial}}_{{n+1,00}}2\mu & 2\xi^{\mathrm{trial}}_{{n+1,01}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,01}}}{\partial \varepsilon_{01}} & 2\xi^{\mathrm{trial}}_{{n+1,02}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,02}}}{\partial \varepsilon_{02}}\\
    2\xi^{\mathrm{trial}}_{{n+1,10}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,10}}}{\partial \varepsilon_{10}} & 2\xi^{\mathrm{trial}}_{{n+1,11}}2\mu & 2\xi^{\mathrm{trial}}_{{n+1,12}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,12}}}{\partial \varepsilon_{12}}\\
    2\xi^{\mathrm{trial}}_{{n+1,20}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,20}}}{\partial \varepsilon_{20}} & 2\xi^{\mathrm{trial}}_{{n+1,21}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,21}}}{\partial \varepsilon_{21}} & 2\xi^{\mathrm{trial}}_{{n+1,22}}2\mu
  \end{array}\right)\\
  &+\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}
  \left(\begin{array}{ccc}\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}(-\frac{2}{3})\mu & 0 & 0\\
0 & \sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}(-\frac{2}{3})\mu & 0 \\
0 & 0 &\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}(-\frac{2}{3})\mu
  \end{array}\right)
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =&\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}\left(2\mu\xi^{\mathrm{trial}}_{{n+1}} - \frac{2}{3}\mu\mathrm{tr}(\xi^{\mathrm{trial}}_{{n+1}})\mathbf 1\right)
\end{align*}

\begin{align*}
  \frac{1}{3}\mathrm{tr}(\xi^{\mathrm{trial}}_{{n+1}})\mathbf 1
  = \frac{1}{3}\mathrm{tr}(\mathrm{dev}(\sigma^{\mathrm{trial}}_{{n+1}}))\mathbf 1
  = \frac{1}{3}\mathrm{tr}\left(\sigma^{\mathrm{trial}}_{{n+1}}-\frac{1}{3}\mathrm{tr}(\sigma^{\mathrm{trial}}_{{n+1}})\mathbf 1\right)\mathbf 1 = 0
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =&2\mu\mathbf n_{n+1}
\end{align*}

\textcolor{orange}{
  \begin{align*}
    -2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1} =& -2 \mu\frac{1}{2\mu}\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}
    = -2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}
\end{align*}}

\begin{align*}
  &2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =2 \mu\Delta\gamma\frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)
  =2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\frac{\partial \xi^{\mathrm{trial}}_{n+1}}{\partial\varepsilon_{n+1}}
  + 2 \mu\Delta\gamma\frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)\otimes\xi^{\mathrm{trial}}_{n+1}
\end{align*}

\begin{align*}
  \frac{\partial \xi^{\mathrm{trial}}_{n+1}}{\partial\varepsilon_{n+1}}
  =2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
\end{align*}

\begin{align*}
  \frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)
  =&-\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}\|^3}
  \frac{\partial \|\xi^{\mathrm{trial}}\|^2}{\partial\varepsilon_{{n+1}}}\\
  =&-\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{n+1}\|^3}4\mu\xi^{\mathrm{trial}}\\
  =&-\frac{2\mu\mathbf n_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|^2}
\end{align*}

\textcolor{greendark}{
\begin{align*}
  &-2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =-2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}
\end{align*}
}

\begin{align*}
  \begin{split}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& 2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}} + \lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} - 2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}- 2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
  & -2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
  & -4 \mu^2\frac{\Delta \gamma}{\|\xi_{n+1}^{\mathrm{trial}}\|} \left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
  & -4 \mu^2\frac{   \|\xi^{\mathrm{trial}}_{n+1}\|    -  \sqrt{\frac{2}{3}}Y }{2\mu}  \frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|} \left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
    =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
    & -2 \mu\left(1- \frac{\sqrt{\frac{2}{3}}Y }{\|\xi_{n+1}^{\mathrm{trial}}\|}\right) \left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
    =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 -2 \mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)  + 2 \mu\frac{\sqrt{\frac{2}{3}}Y }{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
  \end{split}
\end{align*}

\begin{shaded}
\begin{align*}
  \begin{split}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} 
    = 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 -2 \mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)  + 2 \mu\frac{\sqrt{\frac{2}{3}}Y }{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)
  \end{split}
\end{align*}
结果可以和\cite{CermakSysalaValdman}比较验证。
\end{shaded}


\subsubsection{Return Mapping Algorithm For Linear Isotropic Hardening}
给出J2弹塑性本构关系，
\begin{align*}
  &\sigma = \mathbf C:(\varepsilon-\varepsilon^p)\,,\\
  &f (\mathbf \sigma,\mathbf \beta, \alpha) = \|\xi\|-\sqrt{\frac{2}{3}}K(\alpha), \quad\xi:=\mathrm{dev}(\sigma)\,,\\
  &\dot{\mathbf\varepsilon}^p=\mathbf\gamma\frac{\xi}{\|\xi\|}\,,\\
  &\dot\alpha=\gamma\sqrt{\frac{2}{3}}\,,
\end{align*}
离散后得到
\begin{align*}
    &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\,,\\
    &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\,,\\
    &\alpha_{n+1}=\alpha_{n}+\Delta\gamma\sqrt{\frac{2}{3}}\,.
\end{align*}

\begin{align*}
  \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf I)\\
  =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}))\\
  =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon_{n}+\varepsilon_{n}-\varepsilon^p_{n}))\\
  =&2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + 2\mu\mathrm{dev}(\varepsilon_{n}-\varepsilon_{n}^p)\\
  =&2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + \mathrm{dev}(2\mu(\varepsilon_{n}-\varepsilon_{n}^p) + \lambda\mathrm{tr}(\varepsilon_{n}-\varepsilon_{n}^p)\mathbf I)\\
    =&2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + \mathrm{dev}(\sigma_n)
\end{align*}

\begin{align*}
  \mathrm{dev}(\sigma_{n+1}) 
  =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n+1}^p)\mathbf I) \\
  =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p)) \\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon_{n})\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon^p_{n}+\varepsilon^p_{n}-\varepsilon_{n})\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon^p_{n}) + \mathrm{dev}(\sigma_n)
\end{align*}

\begin{align*}
 \mathrm{dev}(\sigma_{n+1})
 &= \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon^p_{n}) \\
 &= \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - 2\mu\mathrm{dev}\left(\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right) \\
 &= \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - 2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|} 
\end{align*}
\begin{align*}
 \xi_{n+1} &= \xi^{\mathrm{trial}}_{n+1}  - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} 
\end{align*}
\begin{align*}
  \frac{\xi_{n+1}}{\|\xi_{n+1}\|} = \frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}
\end{align*}
\begin{align*}
  \|\xi_{n+1}\| = \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma
\end{align*}

根据塑性约束条件
\begin{align*}
  &\|\xi_{n+1}\| - \sqrt{\frac{2}{3}}K(\alpha_{n+1}) \\
  =& \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma   - \sqrt{\frac{2}{3}}K(\alpha_{n+1}) \\
  =& \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  - \sqrt{\frac{2}{3}}K\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right) = 0
\end{align*}

\begin{align*}
  K\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right) = k \left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right) + l
\end{align*}

\begin{shaded}
\begin{align*}
  \Delta\gamma = \frac{\|\xi^{\mathrm{trial}}_{n+1}\| - \sqrt{\frac{2}{3}}(k\alpha_{n}+l)}{ 2\mu  + \frac{2}{3}k}
\end{align*}
\end{shaded}


\begin{shaded}
Wieners's PrandtReuss
\begin{align*}
  &\|\xi_{n+1}\| - \left(\mu H_0\alpha_{n+1}+\sqrt{\frac{2}{3}}K_0\right) \\
  =& \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma   - \left(\mu H_0\alpha_{n+1}+\sqrt{\frac{2}{3}}K_0\right) \\
  =& \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  - \left(\mu H_0(\alpha_{n}+\Delta\gamma)+\sqrt{\frac{2}{3}}K_0\right)\\
  =& 0
\end{align*}
\begin{align*}
  \Delta\gamma =& \frac{\|\xi^{\mathrm{trial}}_{n+1}\| - \left(\mu H_0\alpha_{n}+\sqrt{\frac{2}{3}}K_0\right)}{ 2\mu  + \mu H_0}\\
  =& \frac{1}{2\mu}\frac{\|\xi^{\mathrm{trial}}_{n+1}\| - \left(\mu H_0\alpha_{n}+\sqrt{\frac{2}{3}}K_0\right)}{ 1  + 0.5 H_0}
\end{align*}
\begin{align*}
    &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align*}
\begin{align*}
  \sigma_{n+1} =& \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1}) \\
  =& \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n} -(\varepsilon^p_{n+1}-\varepsilon^p_{n})) \\
  =& \sigma^{\mathrm{trial}}_{n+1} - \mathbf C:(\varepsilon^p_{n+1}-\varepsilon^p_{n}) \\
  =& \sigma^{\mathrm{trial}}_{n+1} - \mathbf C:(\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}) \\
  =& \sigma^{\mathrm{trial}}_{n+1} - 2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align*}
\end{shaded}


Return mapping algorithm用于time dependent方程，对于静态弹塑性时间步只有一步，就是从初始状态，到稳定状态。
\eqref{eq:3.7.1.4:1}和\eqref{eq:3.7.1.4:2}经常用到。
\begin{align}\label{eq:3.7.1.4:1}
  \begin{split}
  &\mathrm{trace}(\mathrm{dev}(A)) \\ = &\mathrm{trace}\left(\begin{array}{ccc} A_{00}-\frac{1}{3}\sum_iA_{ii} & A_{01} & A_{02}\\
    A_{10} & A_{11}-\frac{1}{3}\sum_iA_{ii} & A_{12}\\
     A_{20} & A_{21} & A_{22}-\frac{1}{3}\sum_iA_{ii} \\
    \end{array}\right) = 0
    \end{split}
\end{align}

\begin{align}\label{eq:3.7.1.4:2}
  \mathrm{dev}(\mathrm{trace}(A)\mathbf I) = \mathrm{dev}\left(\begin{array}{ccc} \sum_iA_{ii} & 0 & 0\\
    0 & \sum_iA_{ii} & 0\\
     0 & 0 & \sum_iA_{ii} \\
  \end{array}\right) = 0
\end{align}

在\cite{CermakSysalaValdman}中$K$和$G$定义为
\begin{align*} 
  K = & \frac{E}{3(1-2\upsilon)}\,, \\
  G = & \frac{E}{2(1+\upsilon)}\,,
\end{align*}
$E$ is Young's modulus and $\upsilon$ is Poisson's ratio.
\begin{align*}
  \mu=\frac{E}{2(1+\upsilon)}\qquad\lambda=\frac{Ev}{(1+\upsilon)(1-2\upsilon)}
\end{align*}
  
继续推导tangent modulus。
\begin{align*}
  &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n} - \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right)\\
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n}\right)-\mathbf C:\left(\Delta \mathbf\gamma \frac{\xi_{n+1}^{\mathrm{trial}}}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)\\
  &\sigma_{n+1} = \mathbf C:\left(\varepsilon_{n+1}-\mathbf\varepsilon^p_{n}\right)-2\mu\Delta \mathbf\gamma \frac{\xi_{n+1}^{\mathrm{trial}}}{\|\xi_{n+1}^{\mathrm{trial}}\|}
\end{align*}

\begin{align*}
  \frac{\partial a\mathbf A}{\partial \varepsilon} =&   \frac{\partial }{\partial \varepsilon}\left(\begin{array}{ccc}
    a\mathbf A_{00} & a\mathbf A_{01} & a\mathbf A_{02} \\
    a\mathbf A_{10} & a\mathbf A_{11} & a\mathbf A_{12} \\
    a\mathbf A_{20} & a\mathbf A_{21} & a\mathbf A_{22} 
\end{array}
  \right) \\
  =&\left(\begin{array}{ccccccccc}
    \frac{\partial a}{\partial \varepsilon_{00}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{00}} & \frac{\partial a}{\partial \varepsilon_{01}}\mathbf A_{00} +  a    \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{01}} & \frac{\partial a}{\partial \varepsilon_{02}}\mathbf A_{00} +  a    \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{02}} & & & & & & \\
    \frac{\partial a}{\partial \varepsilon_{10}}\mathbf A_{00} +  a    \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{10}} & \frac{\partial a}{\partial \varepsilon_{11}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{11}} & \frac{\partial a}{\partial \varepsilon_{12}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{12}} & \cdots & & & & & \\
    \frac{\partial a}{\partial \varepsilon_{20}}\mathbf A_{00} +  a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{20}} & \frac{\partial a}{\partial \varepsilon_{21}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{21}} & \frac{\partial a}{\partial \varepsilon_{22}}\mathbf A_{00} +   a   \frac{\partial\mathbf A_{00}}{\partial \varepsilon_{22}} & & & & & & \\
    \vdots  &   &  & \ddots & & & & & 
\end{array}
  \right) \\
  =& \frac{\partial a}{\partial \varepsilon}\otimes \mathbf A + a \frac{\partial \mathbf A}{\partial \varepsilon}
\end{align*}

\begin{align*}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& \textcolor{red}{2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}}} + \textcolor{blue}{\lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}}} \textcolor{orange}{- 2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}}\textcolor{greendark}{- 2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}}
\end{align*}

\begin{align*}
  \textcolor{red}{2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}} =2\mu\mathbf I}
\end{align*}

\begin{align*}
  \textcolor{blue}{\lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} = \lambda\frac{\partial}{\partial\varepsilon_{n+1}}\left(\begin{array}{ccc}
      \mathrm{tr}(\varepsilon_{n+1}) & 0 & 0 \\
      0 & \mathrm{tr}(\varepsilon_{n+1}) & 0  \\
      0 & 0 & \mathrm{tr}(\varepsilon_{n+1}) 
      \end{array}\right)= \lambda\mathbf 1\otimes\mathbf 1}
\end{align*}

\begin{align*}
  &\frac{\partial}{\partial\varepsilon_{n+1}}\left\{\|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  - \sqrt{\frac{2}{3}}\left(k \left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right) + l\right) \right\} \\  
  =&\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}  - \left(2\mu+\frac{2}{3}k\right)\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}    \\
  =&0
\end{align*}

\begin{align*}
\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}  
  =\frac{1}{2\mu+\frac{2}{3}k}\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
\end{align*}


\begin{shaded}
Wieners's PrandtReuss
\begin{align*}
   \frac{\partial}{\partial\varepsilon_{n+1}}\left\{ \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  - \left(\mu H_0(\alpha_{n}+\Delta\gamma)+\sqrt{\frac{2}{3}}K_0\right)\right\} = 0
\end{align*}
\begin{align*}
\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}  
  =\frac{1}{2\mu+\mu H_0}\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
\end{align*}

\end{shaded}

\begin{align*}
  \xi^{\mathrm{trial}}_{n+1}
  =&\mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1})\\
  =&\mathrm{dev}\left(2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)+\lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1\right)\\
  =&\mathrm{dev}\left(2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)\right)\\
  =&2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)-\frac{2}{3}\mu\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1
\end{align*}

\begin{align*}
  \|\xi^{\mathrm{trial}}_{n+1}\|
  =&\sqrt{\sum_{ij}{\xi^{\mathrm{trial}}_{n+1,ij}}^2}
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{{n+1}}\|}{\partial\varepsilon_{n+1}}
    =&\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}   \frac{\partial\|\xi^{\mathrm{trial}}_{{n+1}}\|^2}{\partial\varepsilon_{n+1}}\\
  =&\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}
  \left(\begin{array}{ccc}\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,ii}}}{\partial \varepsilon_{00}} & 2\xi^{\mathrm{trial}}_{{n+1,01}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,01}}}{\partial \varepsilon_{01}} & 2\xi^{\mathrm{trial}}_{{n+1,02}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,02}}}{\partial \varepsilon_{02}}\\
    2\xi^{\mathrm{trial}}_{{n+1,10}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,10}}}{\partial \varepsilon_{10}} & \sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,ii}}}{\partial \varepsilon_{11}} & 2\xi^{\mathrm{trial}}_{{n+1,12}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,12}}}{\partial \varepsilon_{12}}\\
    2\xi^{\mathrm{trial}}_{{n+1,20}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,20}}}{\partial \varepsilon_{20}} & 2\xi^{\mathrm{trial}}_{{n+1,21}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,21}}}{\partial \varepsilon_{21}} &\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,ii}}}{\partial \varepsilon_{22}}
  \end{array}\right)\\
  =&\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}
  \left(\begin{array}{ccc}2\xi^{\mathrm{trial}}_{{n+1,00}}2\mu & 2\xi^{\mathrm{trial}}_{{n+1,01}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,01}}}{\partial \varepsilon_{01}} & 2\xi^{\mathrm{trial}}_{{n+1,02}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,02}}}{\partial \varepsilon_{02}}\\
    2\xi^{\mathrm{trial}}_{{n+1,10}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,10}}}{\partial \varepsilon_{10}} & 2\xi^{\mathrm{trial}}_{{n+1,11}}2\mu & 2\xi^{\mathrm{trial}}_{{n+1,12}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,12}}}{\partial \varepsilon_{12}}\\
    2\xi^{\mathrm{trial}}_{{n+1,20}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,20}}}{\partial \varepsilon_{20}} & 2\xi^{\mathrm{trial}}_{{n+1,21}}\frac{\partial \xi^{\mathrm{trial}}_{{n+1,21}}}{\partial \varepsilon_{21}} & 2\xi^{\mathrm{trial}}_{{n+1,22}}2\mu
  \end{array}\right)\\
  &+\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}
  \left(\begin{array}{ccc}\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}(-\frac{2}{3})\mu & 0 & 0\\
0 & \sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}(-\frac{2}{3})\mu & 0 \\
0 & 0 &\sum _{i=0}^2 2\xi^{\mathrm{trial}}_{{n+1,ii}}(-\frac{2}{3})\mu
  \end{array}\right)
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =&\frac{1}{2\|\xi^{\mathrm{trial}}_{{n+1}}\|}\left(4\mu\xi^{\mathrm{trial}}_{{n+1}} - \frac{4}{3}\mu\mathrm{tr}(\xi^{\mathrm{trial}}_{{n+1}})\mathbf 1\right)
\end{align*}

\begin{align*}
  \frac{1}{3}\mathrm{tr}(\xi^{\mathrm{trial}}_{{n+1}})\mathbf 1
  = \frac{1}{3}\mathrm{tr}(\mathrm{dev}(\sigma^{\mathrm{trial}}_{{n+1}}))\mathbf 1
  = \frac{1}{3}\mathrm{tr}\left(\sigma^{\mathrm{trial}}_{{n+1}}-\frac{1}{3}\mathrm{tr}(\sigma^{\mathrm{trial}}_{{n+1}})\mathbf 1\right)\mathbf 1 = 0
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =&2\mu\mathbf n_{n+1}
\end{align*}

\textcolor{orange}{
  \begin{align*}
    -2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1} =& -2 \mu\frac{1}{2\mu+\frac{2}{3}k}\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}
    = -\frac{4 \mu^2}{2\mu+\frac{2}{3}k}\mathbf n_{n+1}\otimes\mathbf n_{n+1}
\end{align*}}

\begin{shaded}
  Wieners's PrandtReuss
  \begin{align*}
    -2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1} =& -2 \mu\frac{1}{2\mu+\mu H_0}\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}\\
    =& -\frac{4 \mu^2}{2\mu+\mu H_0}\mathbf n_{n+1}\otimes\mathbf n_{n+1}\\
    =& -\frac{2 \mu}{1+\frac{1}{2} H_0}\mathbf n_{n+1}\otimes\mathbf n_{n+1}
  \end{align*}
  \begin{align*}
    \mathbf n\otimes\mathbf n:\mathbf m
    =\left(\begin{array}{ccc}\mathbf n_{11}\mathbf n & \mathbf n_{12}\mathbf n & \mathbf n_{13}\mathbf n\\
      \mathbf n_{21}\mathbf n & \mathbf n_{22}\mathbf n & \mathbf n_{23}\mathbf n\\
      \mathbf n_{31}\mathbf n & \mathbf n_{32}\mathbf n & \mathbf n_{33}\mathbf n\end{array}\right):\mathbf m
      =(\mathbf n:\mathbf m) \mathbf n
  \end{align*}
  \begin{align*}
    \mathbf n:\mathbf m = \mathbf n : (2\mu \mathbf m + \lambda\mathrm{trace} (\mathbf m)\mathbf I) 
  \end{align*}
  
\end{shaded}

\begin{align*}
  &2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =2 \mu\Delta\gamma\frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)
  =2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\frac{\partial \xi^{\mathrm{trial}}_{n+1}}{\partial\varepsilon_{n+1}}
  + 2 \mu\Delta\gamma\frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)\otimes\xi^{\mathrm{trial}}_{n+1}
\end{align*}

\begin{align*}
  \frac{\partial \xi^{\mathrm{trial}}_{n+1}}{\partial\varepsilon_{n+1}}
  =2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
\end{align*}

\begin{align*}
  \frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)
  =&-\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}\|^3}
  \frac{\partial \|\xi^{\mathrm{trial}}\|^2}{\partial\varepsilon_{{n+1}}}\\
  =&-\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{n+1}\|^3}4\mu\xi^{\mathrm{trial}}\\
  =&-\frac{2\mu\mathbf n_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|^2}
\end{align*}

\textcolor{greendark}{
\begin{align*}
  &-2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =-2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}
\end{align*}
}

\begin{shaded}
\begin{align*}
  -2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =&-2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}\\
    =&-4 \mu^2\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)
\end{align*}
\begin{align*}
  \Delta\gamma = \frac{1}{2\mu}\frac{\|\xi^{\mathrm{trial}}_{n+1}\| - \left(\mu H_0\alpha_{n}+\sqrt{\frac{2}{3}}K_0\right)}{ 1  + 0.5 H_0}
\end{align*}
\begin{align*}
  -2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
= -4 \mu^2\frac{1}{2\mu}\frac{\|\xi^{\mathrm{trial}}_{n+1}\| - \left(\mu H_0\alpha_{n}+\sqrt{\frac{2}{3}}K_0\right)}{ 1  + 0.5 H_0}\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
- \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
= -2 \mu\frac{\|\xi^{\mathrm{trial}}_{n+1}\| - \left(\mu H_0\alpha_{n}+\sqrt{\frac{2}{3}}K_0\right)}{ 1  + 0.5 H_0}\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)
\end{align*}

\end{shaded}


\begin{align*}
  \begin{split}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& 2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}} + \lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} - 2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}- 2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
  & -2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
  & -4 \mu^2\frac{\Delta \gamma}{\|\xi_{n+1}^{\mathrm{trial}}\|} \left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
  & -4 \mu^2\frac{   \|\xi^{\mathrm{trial}}_{n+1}\|    -  \sqrt{\frac{2}{3}}Y }{2\mu}  \frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|} \left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
    =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - 2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}  \\
    & -2 \mu\left(1- \frac{\sqrt{\frac{2}{3}}Y }{\|\xi_{n+1}^{\mathrm{trial}}\|}\right) \left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
    =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 -2 \mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)  + 2 \mu\frac{\sqrt{\frac{2}{3}}Y }{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)\\
  \end{split}
\end{align*}

\begin{shaded}
\begin{align*}
  \begin{split}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} 
    = 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 -2 \mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)  + 2 \mu\frac{\sqrt{\frac{2}{3}}Y }{\|\xi_{n+1}^{\mathrm{trial}}\|}\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1 - \mathbf n_{n+1}\otimes\mathbf n_{n+1}\right)
  \end{split}
\end{align*}
结果可以和\cite{CermakSysalaValdman}比较验证。
\end{shaded}


\newpage
\subsection{算例}

\subsubsection{internally pressurized problem 2d}
该问题将三维模型简化成二维模型。压力作用在内柱表面，随着压力的增大，沿着半径方向，从弹性应变到塑性应变，塑性应变最前端不断扩展，当扩展到外柱表面时会发生垮塌（collapse），也就是压力不再增大但是也会发生位移。$P$是作用在内柱表面的压强，$\mathbf d_b$是外柱表面沿着半径方向发生的位移，$Y=0.24$是perfect plasticity的屈服极限，$E=210$是Young模量，$\upsilon=0.3$是泊松比，$c\in [1,2]$是沿着半径方向发生塑性变形的最前端，$a=1$和$b=2$分别是内圆和外圆半径。
\begin{figure}[!htbp]
  \centering
  \subfigure[三维模型]{
    \label{fig:3.7.6.1:1a}
    \includegraphics[height=4cm]{fig/3/3.7.6.1/fig3-7-2-7:1.png}
    }\hskip 2cm
  \subfigure[简化后的二维模型]{
    \label{fig:3.7.6.1:1b}
    \includegraphics[height=4cm]{fig/3/3.7.6.1/1.png}
  }
  \caption{三维简化二维}
\end{figure}

\begin{figure}[!htbp]
  \centering
  \subfigure[二维模型中的对称区域]{
    \label{fig:3.7.6.1:2a}
    \includegraphics[height=4cm]{fig/3/3.7.6.1/2.png}
  }
  \subfigure[二维对称简化模型]{
    \label{fig:3.7.6.1:2b}
    \includegraphics[height=4cm]{fig/3/3.7.6.1/3.png}
  }
  \caption{二维对称简化}
\end{figure}

\begin{align*}
  P =& \frac{2}{\sqrt{3}}Y\left(\log\left(\frac{c}{a}\right) + \frac{1}{2}\left(1-\frac{c^2}{b^2}\right)\right)\\
  c =& 1.5 \\
  a =& 1 \\
  b =& 2 \\  
\end{align*}

请用abaqus输出图\ref{fig:3.7.6.1:2b}中$u_1(2,0)$的计算结果近似与0.001351。
\begin{figure}[!htbp]
  \centering
  \includegraphics[height=6cm]{fig/3/3.7.6.1/4.pdf}
  \caption{$u_1(2,0)=0.0013537$}
\end{figure}




\newpage

\begin{align*}
  d_r =   \frac{(1 + \upsilon) c^2Y}{E\sqrt{3}}  \left(\frac{1}{r} + (1 - 2  \upsilon)\frac{  r}{b^2}\right)
\end{align*}
当$r=b$时 
\begin{align*}
  d_r & =   \frac{(1 + \upsilon) c^2Y}{E\sqrt{3}}  \left(\frac{1}{r} + (1 - 2  \upsilon)\frac{  r}{b^2}\right)\\
  & =   \frac{(1 + \upsilon) c^2Y}{E\sqrt{3}}  \left(\frac{1}{b} + (1 - 2  \upsilon)\frac{  b}{b^2}\right)\\
  & =   \frac{(1 + \upsilon) c^2Y}{E\sqrt{3}} \frac{2 - 2  \upsilon  }{b}\\
  & =   \frac{2(1 - \upsilon^2) c^2Y}{E\sqrt{3}b}
\end{align*}

计算结果要解释四个问题，第一个问题是要看到数值解向解析解的收敛，第二个问题是解析解其实也是做了简化的，需要验证越接近不可压缩材料，数值解和解析解吻合的越好，但是越接近不可压缩材料会产生locking现象影响收敛速度，
第三个问题是检验非线性Newton收敛效果，第四个问题是看到弹塑性过程。

\begin{table}[H]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{$l_h$} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\mathbf u(\mathbf x)$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 17\,280  & 0.0013379   &   \\
    \hline
    1 & 69\,120  & 0.0013508  & 0.0000129  \\
    \hline
    2 & 276\,480 & 0.0013541  & 0.0000033  \\
    \hline
    3 & 1\,105\,920  & 0.0013548  & 0.0000007  \\
    \hline
    4 & 4\,423\,680 & 0.0013549  & 0.0000001  \\
  \end{tabular}
  \caption{$(E,\nu)=(210,0.3)$，$c=1.5$，$\mathbf x=(2,0)$，$\mathbf u(\mathbf x) = (0.001351,0)$}
  \label{tab:3.7.2.1:1}
\end{table}

\begin{table}[H]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{$l_h$} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\mathbf u(\mathbf x)$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 17\,280  &  0.0011484  &   \\
    \hline
    1 & 69\,120  & 0.0011746  & 0.0000262  \\
    \hline
    2 & 276\,480 & 0.0011818  & 0.0000072  \\
    \hline
    3 & 1\,105\,920  & 0.0011837  &  0.0000019  \\
    \hline
    4 & 4\,423\,680 & 0.0011842  & 0.0000005  \\
  \end{tabular}
  \caption{$(E,\nu)=(210,0.45)$，$c=1.5$，$\mathbf x=(2,0)$，$\mathbf u(\mathbf x) = (0.001184,0)$}
  \label{tab:3.7.2.1:2}
\end{table}


\begin{table}[H]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{$l_h$} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\mathbf u(\mathbf x)$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 17\,280  &  0.0010232  &   \\
    \hline
    1 & 69\,120  & 0.0010931  & 0.0000699  \\
    \hline
    2 & 276\,480 & 0.0011185  & 0.0000254  \\
    \hline
    3 & 1\,105\,920  & 0.0011257  & 0.0000072  \\
    \hline
    4 & 4\,423\,680 & 0.0011276  & 0.0000019  \\
  \end{tabular}
  \caption{$(E,\nu)=(210,0.49)$，$c=1.5$，$\mathbf x=(2,0)$，$\mathbf u(\mathbf x) = (0.0011282,0)$}
  \label{tab:3.7.2.1:3}
\end{table}

在表\ref{tab:3.7.2.1:1}、\ref{tab:3.7.2.1:2}、\ref{tab:3.7.2.1:3}中，可以清楚观察到数值解的收敛，随着泊松比接近0.5，数值解更加接近解析解，但是收敛速度受到locking影响。

\begin{table}[H]
  \centering
  \begin{tabular}{c|r|l|l}
    \multicolumn{1}{c|}{$l_h$} & \multicolumn{1}{c|}{dof} & \multicolumn{1}{c|}{$\mathbf u(\mathbf x)$}  & \multicolumn{1}{c}{ROC} \\
    \hline
    0 & 17\,280  & 0.0013468   &   \\
    \hline
    1 & 69\,120  & 0.0015897  & 0.0002429  \\
    \hline
    2 & 276\,480 & 0.0017568  & 0.0001671  \\
    \hline
    3 & 1\,105\,920  & 0.0018478  & 0.000091  \\
    \hline
    4 & 4\,423\,680 & 0.0018881  & 0.0000403  \\
  \end{tabular}
  \caption{$(E,\nu)=(210,0.49)$，$c=1.95$，$\mathbf x=(2,0)$，$\mathbf u(\mathbf x) = (0.0019066,0)$}
  \label{tab:3.7.2.1:4}
\end{table}


在表\ref{tab:3.7.2.1:3}和\ref{tab:3.7.2.1:4}中，将塑性应变达到的最前端从$c=1.5$扩展到$c=1.95$，可以清楚观察到数值解的收敛，但是表\ref{tab:3.7.2.1:4}中收敛速度受到locking影响更大了，
表\ref{tab:3.7.2.1:5}给出表\ref{tab:3.7.2.1:4}中自由度为4423680的牛顿迭代收敛情况。
\begin{table}[H]
  \centering
  \begin{tabular}{c|l|c|l|c|l}
    \multicolumn{1}{c|}{$k$} & \multicolumn{1}{c|}{$\|K(U)-f\|$} & \multicolumn{1}{c|}{$k$} & \multicolumn{1}{c|}{$\|K(U)-f\|$} & \multicolumn{1}{c|}{$k$} & \multicolumn{1}{c}{$\|K(U)-f\|$} \\
    \hline
    0 & 0.011478  & 6 & 2.4993e-05 &12  & 1.3475e-06 \\
    \hline
    1 & 0.0061065 & 7 & 2.0761e-05 &13  &  4.2426e-07\\
    \hline
    2 & 0.0033377  & 8 & 1.2759e-05 &14  &  3.6811e-07 \\
    \hline
    3 & 0.0016994 & 9 &7.8084e-06  &15  & 8.213e-08  \\
    \hline
    4 & 0.00072288 & 10 &6.3567e-06  &16  &  3.3409e-08 \\
    \hline
    5 & 0.0002288 & 11 & 2.3543e-06 &17  & 1.9656e-08  \\
  \end{tabular}
  \caption{$(E,\nu)=(210,0.49)$，$c=1.95$，$\mathbf x=(2,0)$，$\mathbf u(\mathbf x) = (0.0019066,0)$}
  \label{tab:3.7.2.1:5}
\end{table}

\begin{figure}[!htbp]
  \centering
  \label{fig:3.7.2.1:5}
  \includegraphics[height=6cm]{fig/3/3.7.2.1/fig3-7-2-1:5.png}
  \caption{$(E,\nu)=(210,0.45)$，$\mathbf x=(2,0)$，$c$接近2.0时的偏差是由于locking收敛速度受影响引起的。}
\end{figure}


\newpage
\subsubsection{internally pressurized problem 3d}
根据对称将问题简化，压力作用在内球表面，随着压力的增大，沿着半径方向，从弹性应变到塑性应变，塑性应变最前端不断扩展，当扩展到外球表面时会发生垮塌（collapse），也就是压力不再增大但是也会发生位移。$P$是作用在内球表面的压强，$d_b$是外球表面沿着半径方向发生的位移，$Y=0.24$是perfect plasticity的屈服极限，$E=210$是Young模量，$\upsilon=0.3$是泊松比，$c\in [1,2]$是沿着半径方向发生塑性变形的最前端，$a=1$和$b=2$分别是内球和外球半径。
\begin{figure}[!htbp]
  \centering
  \subfigure[三维模型]{
    \label{fig:3.7.6.1:1a}
    \includegraphics[height=4cm]{fig/3/3.7.6.2/1.png}
    }\hskip 2cm
  \subfigure[对称简化模型]{
    \label{fig:3.7.6.1:1b}
    \includegraphics[height=4cm]{fig/3/3.7.6.2/2.png}
  }
  \caption{对称简化模型}
\end{figure}


\begin{align*}
  P =& Y\left(2\log\left(\frac{c}{a}\right) + \frac{2}{3}\left(1-\frac{c^3}{b^3}\right)\right)\\
  c =& 1.5 \\
  a =& 1 \\
  b =& 2 \\  
  d_b =& \frac{Yc^3}{3Eb^3r^2}\left(2(1-2\upsilon)b^3 + (1+\upsilon)b^3\right)
\end{align*}

请用abaqus输出图\ref{fig:3.7.6.1:2b}中$u_1(2,0,0)$的计算结果。



\newpage
\section{准静态弹塑性方程}

\newpage


\section{瞬态弹塑性方程}

\subsection{有限元方法}

\subsubsection{偏微分方程和初始/边界条件}
瞬态弹塑性方程和边界条件为，
\begin{shaded}
\begin{subequations}
  \begin{align}
    \label{eq:3-4-15a}
   \frac{\partial^2 \mathbf u}{\partial t^2} -\nabla\cdot\mathbf \sigma=& \mathbf b & x\in\Omega \,,\\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t & x\in\Gamma_N\,,\\
    \mathbf u =& \mathbf g & x\in\Gamma_D\,.
  \end{align}
\end{subequations}
\end{shaded}

\subsubsection{变分形式}

对\eqref{eq:3-4-15a}两边点乘$\mathbf v$做$\Omega$上积分得到
\begin{align*}
  \int_{\Omega}\frac{\partial^2 \mathbf u}{\partial t^2}\cdot\mathbf v \ud x-\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\\
  \int_{\Omega}\frac{\partial^2 \mathbf u}{\partial t^2}\cdot\mathbf v \ud x + \int_{\Omega}\mathbf\sigma:\nabla^s\mathbf v\ud x =& \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}

\begin{shaded}
\begin{definition}[\textbf{变分形式}]
找到$\mathbf u(x)\in \mathbf V_{\mathbf g}$使得
  \begin{align*}
    \int_{\Omega}\frac{\partial^2 \mathbf u}{\partial t^2}\cdot\mathbf v \ud x + \int_{\Omega}\mathbf\sigma(\mathbf\varepsilon(\mathbf u)):\nabla^s\mathbf v\ud x =& \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
对所有的$\mathbf v\in\mathbf V_{0}$成立。
\end{definition}
\end{shaded}
  
\subsubsection{有限元离散}
用$\mathbf u_h(x)$替换$\mathbf u(x)$。
\begin{shaded}
\begin{definition}[\textbf{离散形式}]
找到$\mathbf u_h(x)\in \mathbf V_{\mathbf g,h}$使得
\begin{align*}
  \int_{\Omega}\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h)):\nabla^s\mathbf v_h\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x
\end{align*}
对所有的$\mathbf v_h\in\mathbf V_{0,h}$成立。
\end{definition}
\end{shaded}

\subsubsection{非线性方程组}
从离散空间基函数系数得到非线性方程组。
\begin{shaded}
\begin{align*}
M \frac{\frac{U^{n+1}-U^{n}}{k} - \frac{U^{n}-U^{n-1}}{k}}{k} +  K(\frac{U^{n+1} + U^{n-1}}{2}) = f^n
\end{align*}
\end{shaded}

\subsubsection{非线性}
Newton方法简单定义.
\begin{align}
F'(U_k)(U_{k+1}-U_k) + F(U_k) = 0
\end{align}

先来求Frechet derivative。
\begin{align}
  F(U) = K(U) - f = 0
\end{align}
\begin{align*}
  &\lim_{s\rightarrow 0}  \frac{F(U+s U') - F(U) }{s}\\
  =&\lim_{s\rightarrow 0}  \frac{K(U+sU') - K(U)}{s}\\
  =&\lim_{s\rightarrow 0}\left(\frac{\int_{\Omega}(\mathbf\sigma(\mathbf\varepsilon(m(\mathbf u_h + s\mathbf u_h'))-\mathbf\sigma(\mathbf\varepsilon(m(\mathbf u_h))):\nabla^s\mathbf{v}_i\ud x}{s}\right)_{i}\\
  =&\left(\int_{\Omega}\lim_{s\rightarrow 0}\frac{\mathbf\sigma(\mathbf\varepsilon(m(\mathbf u_h + s\mathbf u_h')))-\mathbf\sigma(\mathbf\varepsilon(m(\mathbf u_h)))}{s}:\nabla^s\mathbf{v}_i\ud x\right)_{i}\\
  =&\left(\int_{\Omega}\lim_{s\rightarrow 0}\frac{\mathbf\sigma(\mathbf\varepsilon(m(\mathbf u_h + s\mathbf u_h')))-\mathbf\sigma(\mathbf\varepsilon(m(\mathbf u_h)))}{\mathbf\varepsilon(m(\mathbf u_h + s\mathbf u_h'))-\mathbf\varepsilon(m(\mathbf u_h))}:\frac{\mathbf\varepsilon(m(\mathbf u_h + s\mathbf u_h'))-\mathbf\varepsilon(m(\mathbf u_h))}{s}:\nabla^s\mathbf{v}_i\ud x\right)_{i}\\
  =&\left(\int_{\Omega}\frac{\partial\mathbf\sigma}{\partial\mathbf\varepsilon}(m(\mathbf u_h)):\mathbf\varepsilon(m(\mathbf u_h')):\nabla^s\mathbf{v}_i\ud x\right)_{i}
\end{align*}

因此需要计算三阶张量
\begin{align*}
  \frac{\partial\mathbf\sigma}{\partial\varepsilon}(\mathbf u_h)\qquad\textrm{and}\qquad\mathbf\sigma(\mathbf u_h)
\end{align*}
如果是弹性形变
\begin{align*}
  \frac{\partial\mathbf\sigma}{\partial\varepsilon}
  =\mathbf C
\end{align*}
这里注意$\mathbf u_h$是已知，需要求解的是$\mathbf u_h'$。




\newpage
%\subsection{瞬态弹塑性方程}

  
\subsection{返回映射算法 (Return Mapping Algorithm)}

\begin{notice}
  Return Mapping Algorithm需要给定$\varepsilon_{n+1}$，但是$\varepsilon_{n+1}$是需要求解的，是未知的，那么如何使用Return Mapping Algorithm？
  原因所有文献都没有直接点出，而这是Elastoplastiticy问题算法的核心，原因是$\varepsilon_{n+1}$的求解是一个非线性问题，对于非线性问题使用Newton Method会给出
  一个$\varepsilon_{n+1}$的Initial Guess，有了Initial Guess的$\varepsilon_{n+1}$就可以使用Return Mapping Algorithm了。
\end{notice}

\begin{notice}
  Elastoplastiticy问题实际是将非线性弹塑性方程和
  本构关系中Flow Rule和Isotropic Hardening，Kinematic Hardening的常微分方程耦合，非线性提供$\varepsilon_{n+1}$的Initial Guess，然后常微分方程对Internal Variables进行更新。
\end{notice}



\subsubsection{一维弹塑性}
方程为:
\begin{subequations}\label{eq:3-4-1:1}
  \begin{align}
    &\sigma = E(\varepsilon-\varepsilon^p)\\
    &\dot\varepsilon^p = \gamma\mathrm{sign}(\sigma) \\
    &\dot\alpha = \gamma 
  \end{align}
\end{subequations}
约束为:
\begin{align}
  \label{eq:3-4-1:2}
  \gamma\geq 0,\quad f(\sigma,\alpha)\leq 0,\quad\gamma f(\sigma,\alpha)=0
\end{align}

采用\eqref{eq:3-4-1:3}隐式backward方法. 
\begin{align}\label{eq:3-4-1:3}
  \frac{x_{n+1}-x_n}{\Delta t} = f(x_{n+1})
\end{align}
对方程\eqref{eq:3-4-1:1}进行离散.
\begin{subequations}
  \begin{align}
    &\sigma_{n+1} = E(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
    &\frac{\varepsilon^p_{n+1}-\varepsilon^p_{n}}{\Delta t} = \gamma\mathrm{sign}(\sigma_{n+1}) \\
    &\frac{\alpha_{n+1}-\alpha_{n}}{\Delta t} = \gamma 
  \end{align}
\end{subequations}
对约束\eqref{eq:3-4-1:2}进行离散. 
\begin{align}\label{eq:3-4-1:5b}
  \gamma\geq 0,\quad f(\sigma_{n+1},\alpha_{n+1})\leq 0,\quad\gamma f(\sigma_{n+1},\alpha_{n+1})=0
\end{align}

\begin{figure}[!htbp]
  \centering
  \subfigure[弹性变形]{
    \label{fig:3-4-1:1}
    \includegraphics[height=5cm]{fig/3/3.4.1/3-4-1-1.png}
    }
  \subfigure[塑性变形]{
    \label{fig:3-4-1:2}
    \includegraphics[height=5cm]{fig/3/3.4.1/3-4-1-2.png}
    }
  \caption{判断弹性和塑性}
\end{figure}

\textcolor{red}{给定$\varepsilon_{n+1}=\varepsilon_{n} + \Delta\varepsilon_{n+1}$来判断是弹性还是塑性变形, 再计算$(\sigma_{n+1},\varepsilon_{n+1}^p,\alpha_{n+1})$}.
\textcolor{red}{
  \begin{subequations}
    \begin{align}
      \left\{\begin{array}{l}
      \sigma^{\mathrm{trial}}_{n+1}=E(\varepsilon_{n+1}-\varepsilon^p_n)\\
      \varepsilon^{p^{\mathrm{trial}}}_{n+1}=\varepsilon^p_n\\
      \alpha^{\mathrm{trial}}_{n+1}=\alpha_n\\
      f^{\mathrm{trial}}_{n+1}=|\sigma^{\mathrm{trial}}_{n+1}| - (\sigma_Y+K\alpha_n)
      \end{array}\right.
    \end{align}
  \end{subequations}
  \begin{align}
    f^{\mathrm{trial}}_{n+1}
    \left\{\begin{array}{ll}
      \leq 0 & \textrm{elastic step}\\
      > 0 & \textrm{plastic step}
    \end{array}\right.
  \end{align}
}

如果是弹性变形, 就非常简单. 
\begin{align}
  \left\{\begin{array}{l}
  \sigma_{n+1} = \sigma^{\mathrm{trial}}_{n+1}\\
  \varepsilon_{n+1}=\varepsilon^p_n\\
  \alpha_{n+1}=\alpha_n\\
  f_{n+1}\leq 0
  \end{array}\right.
\end{align}
如果是塑性变形, $\Delta\gamma=\Delta t\gamma$, 根据
\begin{align}\label{eq:3-4-1:21}
  \left\{\begin{array}{l}
  \sigma_{n+1} = E(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
  \varepsilon^p_{n+1} = \varepsilon^p_{n} + \Delta\gamma\mathrm{sign}(\sigma_{n+1}) \\
  \alpha_{n+1} = \alpha_{n} + \Delta\gamma \\
  f(\sigma_{n+1},\alpha_{n+1})=|\sigma_{n+1}|-(\sigma_Y + K\alpha_{n+1})= 0
  \end{array}\right.
\end{align}
计算得到$\Delta\gamma$, 并带入\eqref{eq:3-4-1:21}
\textcolor{red}{
\begin{align}
  \left\{\begin{array}{l}
  \Delta\gamma=\frac{f^{\mathrm{trial}}_{n+1}}{E+K}\\
  \sigma_{n+1} = \sigma^{\mathrm{trial}}_{n+1}-\Delta\gamma E\mathrm{sign}(\sigma^{\mathrm{trial}}_{n+1})\\
  \varepsilon^p_{n+1} = \varepsilon^p_{n} + \Delta\gamma\mathrm{sign}(\sigma^{\mathrm{trial}}_{n+1}) \\
  \alpha_{n+1} = \alpha_{n} + \Delta\gamma 
  \end{array}\right.
\end{align}}


\newpage
\subsubsection{多维弹塑性}

首先根据本构关系给出方程, 约束和初始条件.
\begin{align*}
  &\sigma = \mathbf C:(\varepsilon-\varepsilon^p)\\
  &\dot{\mathbf\varepsilon}^p=\mathbf\gamma \mathbf r(\mathbf \sigma, \mathbf q)\\
  &\dot{\mathbf q}=-\mathbf\gamma \mathbf h(\mathbf \sigma, \mathbf q)\\
  &\gamma\geq 0, \quad f(\mathbf\sigma,\mathbf q)\leq 0, \quad\gamma f(\mathbf\sigma,\mathbf q) = 0\\
  &(\varepsilon,\varepsilon^p,\mathbf q)|_{t_n} = (\varepsilon_n,\varepsilon^p_n,\mathbf q_n)
\end{align*}
给出associate plasticity的方程, 约束和初始条件.
\begin{align*}
  &\sigma = \mathbf C:(\varepsilon-\varepsilon^p)\\
  &\dot{\mathbf\varepsilon}^p=\mathbf\gamma \frac{\partial f(\mathbf \sigma, \mathbf q)}{\partial \sigma}\\
  &\dot{\mathbf q}=-\mathbf\gamma \mathbf D \frac{\partial f(\mathbf \sigma, \mathbf q)}{\partial \mathbf q}\\
  &\gamma\geq 0, \quad f(\mathbf\sigma,\mathbf q)\leq 0, \quad\gamma f(\mathbf\sigma,\mathbf q) = 0\\
  &(\varepsilon,\varepsilon^p,\mathbf q)|_{t_n} = (\varepsilon_n,\varepsilon^p_n,\mathbf q_n)
\end{align*}
离散后得到
\begin{subequations}\label{eq:3-4-2:23}
  \begin{align}
    &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
    &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \partial_{\sigma} f(\mathbf \sigma_{n+1}, \mathbf q_{n+1})\\
    &\mathbf q_{n+1}=\mathbf q_{n}-\Delta\mathbf\gamma \mathbf D \partial_{\mathbf q} f(\mathbf \sigma_{n+1}, \mathbf q_{n+1})\\
    &\Delta\gamma\geq 0, \quad f(\mathbf\sigma_{n+1},\mathbf q_{n+1})\leq 0, \quad\Delta\gamma f(\mathbf\sigma_{n+1},\mathbf q_{n+1}) = 0\\
    &(\varepsilon,\varepsilon^p,\mathbf q)|_{t_n} = (\varepsilon_n,\varepsilon^p_n,\mathbf q_n)
  \end{align}
\end{subequations}
\eqref{eq:3-4-2:23}中给出了塑性本构关系和加载/卸载条件. 首先假设发生弹性形变
\begin{subequations}\label{eq:3-4-2:23}
  \begin{align}
    &\sigma^{\mathrm{trial}}_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n})\\
    &\mathbf q^{\mathrm{trial}}_{n+1}=\mathbf q_{n}
  \end{align}
\end{subequations}
再根据$f^{\mathrm{trial}}(\mathbf\sigma^{\mathrm{trial}}_{n+1},\mathbf q^{\mathrm{trial}}_{n+1})$判断是弹性还是塑性.


\clearpage
\subsubsection{多维J2弹塑性}
给出J2弹塑性本构关系.
\begin{align*}
  &\sigma = \mathbf C:(\varepsilon-\varepsilon^p)\\
  &f (\mathbf \sigma,\mathbf q) = \|\xi\|-\sqrt{\frac{2}{3}}K(\alpha), \quad\xi:=\mathrm{dev}(\sigma) - \beta, \quad\mathrm{tr}(\beta)=0\\
  &\dot{\mathbf\varepsilon}^p=\mathbf\gamma\frac{\xi}{\|\xi\|}\\
  &\dot{\beta}=\mathbf\gamma\frac{2}{3}H'(\alpha)\frac{\xi}{\|\xi\|}\\
  &\dot\alpha=\gamma\sqrt{\frac{2}{3}}\\
  &\gamma\geq 0, \quad f(\mathbf\sigma,\alpha,\beta)\leq 0, \quad\gamma f(\mathbf\sigma,\alpha,\beta) = 0\\
  &(\varepsilon,\varepsilon^p,\alpha,\beta)|_{t_n} = (\varepsilon_n,\varepsilon^p_n,\alpha_n,\beta_n)
\end{align*}
离散后得到
\begin{subequations}\label{eq:3-4-2:13}
  \begin{align}
    &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
    \label{eq:3-4-2:13b}
    &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\\
    \label{eq:3-4-2:13c}
    &\alpha_{n+1}=\alpha_{n}+\Delta\gamma\sqrt{\frac{2}{3}}\\
    \label{eq:3-4-2:13d}
    &\beta_{n+1}=\beta_{n} + \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1})\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
  \end{align}
\end{subequations}
\eqref{eq:3-4-2:13d}是根据\eqref{eq:3-4-2:13c}得到.
\begin{align*}
  \beta_{n+1}=\beta_{n} + \Delta\mathbf\gamma\frac{2}{3}\frac{H(\alpha_{n+1})-H(\alpha_{n})}{\alpha_{n+1}-\alpha_{n}}\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
  =\beta_{n} + \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1})\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align*}

先假设发生弹性变化$\sigma^{\mathrm{trial}}_{n+1}$, \textcolor{red}{这里注意需要给定$\varepsilon_{n+1}$}.
\begin{subequations}\label{eq:3-4-2:14}
  \begin{align}
    &\sigma^{\mathrm{trial}}_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n})\\
    &\alpha^{\mathrm{trial}}_{n+1}=\alpha_{n}\\
    &\beta^{\mathrm{trial}}_{n+1}=\beta_{n}
  \end{align}
\end{subequations}
根据$f^{\mathrm{trial}}(\mathbf\sigma^{\mathrm{trial}}_{n+1},\alpha^{\mathrm{trial}}_{n+1},\beta^{\mathrm{trial}}_{n+1})$来判断到底是弹性还是塑性.
\begin{align*}
  f^{\mathrm{trial}}(\mathbf\sigma^{\mathrm{trial}}_{n+1},\alpha^{\mathrm{trial}}_{n+1},\beta^{\mathrm{trial}}_{n+1})
  =\|\xi^{\mathrm{trial}}_{n+1}\| - \sqrt{\frac{2}{3}}K(\alpha^{\mathrm{trial}}_{n+1})
\end{align*}

如果是塑性变化需要对内变量进行更新，关键在于将$\xi_{n+1}$用$\xi^{\mathrm{trial}}_{n+1}$替换掉，$\xi^{\mathrm{trial}}_{n+1}$中的内变量是已知的。
\begin{align*}
  \xi^{\mathrm{trial}}_{n+1} = \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta^{\mathrm{trial}}_{n+1} 
  =& \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta_{n}
\end{align*}
\begin{align*}
  \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf I)\\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf I - \frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf I)\mathbf I\\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon^p_{n})  - \frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon^p_{n})) \mathbf I\\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon_{n}+ \varepsilon_{n} -\varepsilon^p_{n})  - \frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon_{n}+ \varepsilon_{n}-\varepsilon^p_{n})) \mathbf I\\
  =&2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + 2\mu\mathrm{dev}(\varepsilon_{n}-\varepsilon_{n}^p)\\
  =&2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + \mathrm{dev}(2\mu(\varepsilon_{n}-\varepsilon_{n}^p)) + \mathrm{dev}(\lambda\mathrm{tr}(\varepsilon_{n}-\varepsilon_{n}^p)\mathbf I)\\
    =&2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + \mathrm{dev}(\sigma_n)
\end{align*}
\begin{align*}
  \mathrm{dev}(\sigma_{n+1}) 
  =& \mathrm{dev}(2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n+1}^p)\mathbf I) \\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n+1}^p)\mathbf I - \frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p))\mathbf I - \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n+1}^p)\mathbf I \\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p)  - \frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon_{n+1}^p))\mathbf I \\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon_{n} + \varepsilon_{n} -\varepsilon_{n+1}^p)  - \frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon_{n} + \varepsilon_{n}-\varepsilon_{n+1}^p))\mathbf I \\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon_{n})\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon^p_{n}+\varepsilon^p_{n}-\varepsilon_{n})\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon^p_{n}) + \mathrm{dev}(\sigma_n)
\end{align*}
根据\eqref{eq:3-4-2:13b}和$\mathrm{tr}(\beta)=0$
\begin{align*}
    \mathrm{dev}(\sigma_{n+1}) =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}(\varepsilon^p_{n+1}-\varepsilon^p_{n}) + \mathrm{dev}(\sigma_n)\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\mathrm{dev}\left(\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right) + \mathrm{dev}(\sigma_n) \\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} - 2\mu\Delta\gamma\frac{1}{3}\mathrm{tr}\left(\frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right)\mathbf I + \mathrm{dev}(\sigma_n)\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} - 2\mu\Delta\gamma\frac{1}{3}\mathrm{tr}\left(\frac{\mathrm{dev}(\sigma_{n+1})-\beta_{n+1}}{\|\xi_{n+1}\|}\right)\mathbf I+ \mathrm{dev}(\sigma_n)\\
  =& 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} + \mathrm{dev}(\sigma_n)
\end{align*}

\iffalse
定义$s(\sigma):=\mathrm{dev}(\sigma)$和$e(\sigma):=\mathrm{dev}(\varepsilon)$。
\begin{align}\label{eq:3-5-1:1}
  \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) = s^{\mathrm{trial}}_{n+1} = 2\mu\mathrm{dev}(\varepsilon_{n+1}-\varepsilon_{n}) + \mathrm{dev}(\sigma_n)
\end{align}
\begin{align*}
  \xi^{\mathrm{trial}}_{n+1} = \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta_n =  s^{\mathrm{trial}}_{n+1} - \beta_n= 2\mu\Delta e_{n+1} + s_n - \beta_n
\end{align*}
\fi

\begin{align*}
 \mathrm{dev}(\sigma_{n+1})
  = \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align*}

\iffalse
\begin{align}\label{eq:3-4-2:16}
  s_{n+1}= s^{\mathrm{trial}}_{n+1} - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align}
\fi

\iffalse
目标是计算$\xi_{n+1}$再利用load/upload条件.
\begin{align*}
  \xi_{n+1} = \mathrm{dev}(\sigma_{n+1}) -\beta_{n+1} =  s_{n+1} -\beta_{n+1}
\end{align*}
根据\eqref{eq:3-4-2:16}
\begin{align*}
  \xi_{n+1} =  s_{n+1} -\beta_{n+1} = s^{\mathrm{trial}}_{n+1} - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} -\beta_{n+1}
\end{align*}
根据
\begin{align*}
  \xi^{\mathrm{trial}}_{n+1} = \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta^{\mathrm{trial}}_{n+1} 
  =& \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta_{n} = s^{\mathrm{trial}}_{n+1} - \beta_{n}
\end{align*}
\fi

\begin{align*}
  \xi_{n+1} = \mathrm{dev}(\sigma_{n+1}) -\beta_{n+1}
\end{align*}
\begin{align}\label{eq:3.38}
  \xi_{n+1} = \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} -\beta_{n+1}
\end{align}
\begin{align}\label{eq:3.39}
  \xi^{\mathrm{trial}}_{n+1} = \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta^{\mathrm{trial}}_{n+1} 
  =& \mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1}) - \beta_{n}
\end{align}
用\eqref{eq:3.38}减去\eqref{eq:3.39}有
\begin{align*}
  \xi_{n+1}  = \xi^{\mathrm{trial}}_{n+1} + \beta_{n} - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} -\beta_{n+1}\,.
\end{align*}
根据\eqref{eq:3-4-2:13d}
\begin{align}\label{eq:3-4-2:17}
  \begin{split}
  \xi_{n+1} &= \xi^{\mathrm{trial}}_{n+1} + \beta_{n} - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} -\beta_{n+1}\\
  &= \xi^{\mathrm{trial}}_{n+1}  - 2\mu\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|} - \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1})\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
  \end{split}
\end{align}
得到
\begin{align}\label{eq:3-4-2:18}
  \frac{\xi_{n+1}}{\|\xi_{n+1}\|} = \frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}\,.
\end{align}
将\eqref{eq:3-4-2:18}用到\eqref{eq:3-4-2:17}得到
\begin{align*}\
  \begin{split}
  \xi_{n+1} : \frac{\xi_{n+1}}{\|\xi_{n+1}\|} = \left(\xi^{\mathrm{trial}}_{n+1}  - 2\mu\Delta\gamma\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|} - \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1})\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right):\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}
  \end{split}
\end{align*}
\begin{align}\label{eq:3-4-2:19}
  \|\xi_{n+1}\| = \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma - \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1})\,.
\end{align}

根据塑性约束条件
\begin{align}
  \begin{split}
  &\|\xi_{n+1}\| - \sqrt{\frac{2}{3}}K(\alpha_{n+1}) \\
  =& \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  - \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1}) - \sqrt{\frac{2}{3}}K(\alpha_{n+1})
  = 0
  \end{split}
\end{align}
根据\eqref{eq:3-4-2:13c}
\begin{align}\label{eq:3-4-2:21}
  \begin{split}
    &\|\xi_{n+1}\| - \sqrt{\frac{2}{3}}K(\alpha_{n+1}) \\=& \|\xi^{\mathrm{trial}}_{n+1}\|  - 2\mu\Delta\gamma  -  \sqrt{\frac{2}{3}}\left( H\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)-H(\alpha_{n})\right) \\
    &- \sqrt{\frac{2}{3}}K\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)\\
    =& 0
  \end{split}
\end{align}

对\eqref{eq:3-4-2:21}用Newton方法可以求出$\Delta\gamma$, 对$\sigma_{n+1}$, $\alpha_{n+1}$, $\beta_{n+1}$, $\varepsilon^p_{n+1}$进行更新.
Newton method简单定义.
\begin{align*}
f'(x_k)(x_{k+1}-x_k) + f(x_k) = 0
\end{align*}
\begin{align*}
  &\lim_{t\rightarrow 0}\frac{f(x+tx')-f(x)}{t}\\
  =&-2\mu\lim_{t\rightarrow 0}\frac{\Delta\gamma+t\Delta\gamma'-\Delta\gamma}{t}
  -\sqrt{\frac{2}{3}}\lim_{t\rightarrow}\frac{H\left(\alpha_{n}+\sqrt{\frac{2}{3}}(\Delta\gamma+t\Delta\gamma')\right)-H\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)}{t}\\
  &- \sqrt{\frac{2}{3}}\lim_{t\rightarrow t}\frac{K\left(\alpha_{n}+\sqrt{\frac{2}{3}}(\Delta\gamma + t\Delta\gamma')\right)-K\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)}{t}\\
  =&-2\mu\Delta\gamma'-\frac{2}{3}H'\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)\Delta\gamma'- \frac{2}{3}K'\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)\Delta\gamma'
\end{align*}








\newpage
\subsubsection{多维von Mises Model}

\begin{subequations}
  \begin{align}
    &\mathbf\sigma = \mathbf D^e:\mathbf\varepsilon^e\\
    &\Phi(\mathbf\sigma,\sigma_y) = \sqrt{3J_2(\mathbf s(\mathbf \sigma))} - \sigma_y = \sqrt{\frac{3}{2}\|\mathbf s(\mathbf \sigma)\|^2} - \sigma_y(\bar\varepsilon^p)\\
    &\dot{\mathbf\varepsilon}^p = \dot{\gamma} \frac{\partial\Phi(\mathbf\sigma,\sigma_y)}{\partial\mathbf\sigma}= \dot{\gamma}\sqrt{\frac{3}{2}}\frac{\mathbf s}{\|\mathbf s\|}\\
    &\dot{\bar\varepsilon}^p =\sqrt{\frac{2}{3}}\|\dot{\mathbf\varepsilon}^p\|= \dot{\gamma}
  \end{align}
\end{subequations}
































\newpage
\subsection{有限元方法}

\subsubsection{偏微分方程和初始/边界条件}
\begin{subequations}
  \begin{align}
    \label{eq:3-4-15a}
    \rho\ddot{\mathbf u}-\nabla\cdot\mathbf \sigma=& \mathbf b & x\in\Omega \\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t & x\in\Gamma_N\\
    \mathbf u =& \mathbf g & x\in\Gamma_D\\
    \mathbf u(0,x) = & \mathbf h_1 & x\in\overline\Omega\\
    \dot{\mathbf u}(0,x) = & \mathbf h_2 & x\in\overline\Omega
  \end{align}
\end{subequations}

\subsubsection{变分形式}
\begin{align*}\label{eq:}
    \int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x  =&  \int_{\Omega}\left(
    \sum_{i=1}^3\frac{\partial \sigma_{i1}}{\partial x_i}v_1 + \sum_{i=1}^3\frac{\partial \sigma_{i2}}{\partial x_i}v_2 + \sum_{i=1}^3\frac{\partial \sigma_{i3}}{\partial x_i}v_3
    \right)\ud x  \notag\\ 
    =&  \int_{\Omega}\left(
    \nabla\cdot\mathbf\sigma_{\cdot 1}v_1 + \nabla\cdot\mathbf\sigma_{\cdot 2}v_2 + \nabla\cdot\mathbf\sigma_{\cdot 3}v_3
    \right)\ud x \notag\\
    =&\int_{\Gamma}\left(
    \mathbf n\cdot\mathbf \sigma_{\cdot 1}v_1 + \mathbf n\cdot\mathbf \sigma_{\cdot 2}v_2 + \mathbf n\cdot\mathbf\sigma_{\cdot 3}v_3\right)\ud s_x     \notag\\
    &-\int_{\Omega}\left(
    \nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}\right)\ud x\,.
\end{align*}

\begin{align*}
  &\nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}\\
  =&\frac{\partial v_1}{\partial x_1}\sigma_{11} + \frac{\partial v_1}{\partial x_2}\sigma_{21} + \frac{\partial v_1}{\partial x_3}\sigma_{31} 
   + \frac{\partial v_2}{\partial x_1}\sigma_{12} + \frac{\partial v_2}{\partial x_2}\sigma_{22} + \frac{\partial v_2}{\partial x_3}\sigma_{32} \\
  & + \frac{\partial v_3}{\partial x_1}\sigma_{13} + \frac{\partial v_3}{\partial x_2}\sigma_{23} + \frac{\partial v_3}{\partial x_3}\sigma_{33} 
\end{align*}

\begin{align*}
  \mathbf\sigma:\frac{1}{2}(\nabla_{\mathbf x}\mathbf v^T+\nabla_{\mathbf x}\mathbf v)
  = \mathbf\sigma:\frac{1}{2}\left(\begin{array}{ccc}
    2\frac{\partial v_1}{\partial x_1} &     \frac{\partial v_1}{\partial x_2} + \frac{\partial v_2}{\partial x_1} &     \frac{\partial v_1}{\partial x_3} + \frac{\partial v_3}{\partial x_1}\\
    \frac{\partial v_2}{\partial x_1} + \frac{\partial v_1}{\partial x_2} &     2\frac{\partial v_2}{\partial x_2} &     \frac{\partial v_2}{\partial x_3} + \frac{\partial v_3}{\partial x_2}\\
    \frac{\partial v_3}{\partial x_1} + \frac{\partial v_1}{\partial x_3} &     \frac{\partial v_3}{\partial x_2} + \frac{\partial v_2}{\partial x_3} &    2 \frac{\partial v_3}{\partial x_3}
  \end{array}\right)
  = \mathbf\sigma:\nabla^s\mathbf v
\end{align*}

\begin{align*}
  \nabla v_1\cdot\mathbf \sigma_{\cdot 1} + \nabla v_2\cdot\mathbf \sigma_{\cdot 2} + \nabla v_3\cdot\mathbf \sigma_{\cdot 3}
  =\mathbf\sigma:\nabla^s\mathbf v
\end{align*}

对\eqref{eq:3-4-15a}两边点乘$\mathbf v$做$\Omega$上积分得到
\begin{align*}
  \int_{\Omega}\rho\frac{\partial ^2 \mathbf u}{\partial t^2}\cdot\mathbf v\ud x -\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\\
  \int_{\Omega}\rho\frac{\partial ^2 \mathbf u}{\partial t^2}\cdot\mathbf v\ud x + \int_{\Omega}\mathbf\sigma:\nabla^s\mathbf v\ud x =& \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}

\begin{shaded}
\begin{definition}[\textbf{变分形式}]
找到$\mathbf u(t,x)\in (0,T]\times\mathbf V_{\mathbf g}$使得
  \begin{align*}
    \int_{\Omega}\rho\frac{\partial ^2 \mathbf u}{\partial t^2}\cdot\mathbf v\ud x + \int_{\Omega}\mathbf\sigma(\mathbf\varepsilon(\mathbf u)):\nabla^s\mathbf v\ud x =& \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
对所有的$\mathbf v\in\mathbf V_{0}$成立。
\end{definition}
\end{shaded}
  
\subsubsection{有限元离散}
用$\mathbf u_h(t,x)$替换$\mathbf u(t,x)$。
\begin{shaded}
\begin{definition}[\textbf{离散形式}]
找到$\mathbf u_h(t,x)\in (0,T]\times\mathbf V_{\mathbf g,h}$使得
\begin{align*}
  \int_{\Omega}\rho\frac{\partial ^2 \mathbf u_h}{\partial t^2}\cdot\mathbf v_h\ud x + \int_{\Omega}\mathbf\sigma(\mathbf\varepsilon(\mathbf u_h)):\nabla^s\mathbf v_h\ud x =
  \int_{\Gamma}\mathbf t_h\cdot\mathbf v_h\ud s_x + \int_{\Omega}\mathbf b_h\cdot\mathbf v_h\ud x
\end{align*}
对所有的$\mathbf v_h\in\mathbf V_{0,h}$成立。
\end{definition}
\end{shaded}

\subsubsection{线性方程组}
\begin{align*}
  M\ddot U + K(U) = f
\end{align*}

\subsubsection{时间离散}
\begin{align*}
  M\frac{U^{n+1}-2U^n+U^{n-1}}{k^2} + K\left(\frac{U^{n+1}+U^{n-1}}{2}\right) = f^{n}
\end{align*}
\begin{align}
  MU^{n+1} + k^2K\left(\frac{U^{n+1}+U^{n-1}}{2}\right) = k^2f^{n} + M(2U^n - U^{n-1})
\end{align}
\begin{align}
  U^0=\mathbf h_1 \qquad \frac{U^1-U^0}{k}=\mathbf h_2
\end{align}


quasistatic elastoplasticity
\begin{subequations}
  \begin{align}
    \label{}
    -\nabla\cdot\mathbf \sigma=& \mathbf b & x\in\Omega \\
    \mathbf \sigma\cdot\mathbf n =& \mathbf t & x\in\Gamma_N\\
    \mathbf u =& \mathbf g & x\in\Gamma_D
  \end{align}
\end{subequations}

\begin{align*}
  K\left(U^{n}+\Delta U^{n+1}\right) = f^{n+1}
\end{align*}
\begin{align}
    K\left(U^{n}+\Delta U^{n+1}\right) - f^{n+1} = 0
\end{align}


\clearpage
\subsubsection{非线性}
Newton方法简单定义.
\begin{align}
f'(x_k)(x_{k+1}-x_k) + f(x_k) = 0
\end{align}

先来求Frechet derivative.
\begin{align}
  F(U^{n+1}) = MU^{n+1} + k^2K\left(\frac{U^{n+1}+U^{n-1}}{2}\right) - k^2f^{n} - M(2U^n - U^{n-1}) = 0
\end{align}
\begin{align*}
  &\lim_{s\rightarrow 0}  \frac{F(U^{n+1}+s {U^{n+1}}') - F(U^{n+1}) }{s}\\
  =&\lim_{s\rightarrow 0}  \frac{M(U^{n+1}+s {U^{n+1}}') + k^2K\left(\frac{U^{n+1}+s {U^{n+1}}'+U^{n-1}}{2}\right)  - (MU^{n+1} + k^2K\left(\frac{U^{n+1}+U^{n-1}}{2}\right)) }{s}\\
  =&M{U^{n+1}}' + k^2 \lim_{s\rightarrow 0}\frac{K\left(\frac{U^{n+1}+s {U^{n+1}}'+U^{n-1}}{2}\right)  - K\left(\frac{U^{n+1}+U^{n-1}}{2}\right) }{s}
\end{align*}
\begin{align*}
  &\lim_{s\rightarrow 0}\frac{K\left(\frac{U^{n+1}+s {U^{n+1}}'+U^{n-1}}{2}\right)  - K\left(\frac{U^{n+1}+U^{n-1}}{2}\right) }{s}\\
  =&\lim_{s\rightarrow 0}\left(\frac{\int_{\Omega}(\mathbf\sigma_{n+1}(\mathbf\varepsilon_{n+1}(\frac{\mathbf u_h^{n+1} + s{\mathbf u_h^{n+1}}'+\mathbf u_h^{n-1}}{2}))-\mathbf\sigma_{n+1}(\mathbf\varepsilon_{n+1}(\frac{\mathbf u_h^{n+1}+\mathbf u_h^{n-1}}{2}))):\nabla^s\mathbf{v}_i\ud x}{s}\right)_{i}
\end{align*}
\begin{align*}
  &\lim_{s\rightarrow 0}\frac{\mathbf\sigma_{n+1}(\mathbf\varepsilon_{n+1}(\frac{\mathbf u^{n+1}_h + s{\mathbf u^{n+1}_h}' + \mathbf u^{n-1}_h}{2}))-\mathbf\sigma_{n+1}(\mathbf\varepsilon_{n+1}(\frac{\mathbf u_h^{n+1}+\mathbf u_h^{n-1}}{2}))}{s}\\
  =&\lim_{s\rightarrow 0}\frac{\mathbf\sigma_{n+1}(\mathbf\varepsilon_{n+1}(\frac{\mathbf u^{n+1}_h + s{\mathbf u^{n+1}_h}' + \mathbf u^{n-1}_h}{2}))-\mathbf\sigma_{n+1}(\mathbf\varepsilon_{n+1}(\frac{\mathbf u_h^{n+1}+ \mathbf u_h^{n-1}}{2}))}{(\mathbf\varepsilon_{n+1}(\frac{\mathbf u^{n+1}_h + s{\mathbf u^{n+1}_h}' + \mathbf u^{n-1}_h}{2})-\mathbf\varepsilon_{n+1}(\frac{\mathbf u^{n+1}_h + \mathbf u^{n-1}_h}{2}))_{ij}} \frac{(\mathbf\varepsilon_{n+1}(\frac{\mathbf u^{n+1}_h + s{\mathbf u^{n+1}_h}' + \mathbf u^{n-1}_h}{2})-\mathbf\varepsilon_{n+1}(\frac{\mathbf u^{n+1}_h + \mathbf u^{n-1}_h}{2}))_{ij}}{s}\\
    =&\frac{\partial\mathbf\sigma_{n+1}}{\partial\varepsilon_{n+1}}(\frac{\mathbf u^{n+1}_h+\mathbf u^{n-1}_h}{2}):\frac{1}{2}\nabla^s {\mathbf u^{n+1}_h}'
\end{align*}

因此需要计算三阶张量
\begin{align*}
  \frac{\partial\mathbf\sigma_{n+1}}{\partial\varepsilon_{n+1}}
\end{align*}
如果是弹性形变
\begin{align*}
  \frac{\partial\mathbf\sigma_{n+1}}{\partial\varepsilon_{n+1}}
  =\mathbf C
\end{align*}

如果是J2塑性形变
\begin{align*}
  &\|\xi_{n+1}\|-\sqrt{\frac{2}{3}}K(\alpha_{n+1}), \quad\xi_{n+1}:=\mathrm{dev}(\sigma_{n+1}) - \beta_{n+1}, \quad\mathrm{tr}(\beta_{n+1})=0\\
  &\sigma_{n+1} = \mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1})\\
  &\mathbf\varepsilon^p_{n+1}=\mathbf\varepsilon^p_{n} + \Delta \mathbf\gamma \frac{\xi_{n+1}}{\|\xi_{n+1}\|}\\
  &\alpha_{n+1}=\alpha_{n}+\Delta\gamma\sqrt{\frac{2}{3}}\\
  &\beta_{n+1}=\beta_{n} + \sqrt{\frac{2}{3}}\Delta H(\alpha_{n+1})\frac{\xi_{n+1}}{\|\xi_{n+1}\|}
\end{align*}
\begin{align*}
  \sigma_{n+1} = &\mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n+1}) \\
  = &\mathbf C:(\varepsilon_{n+1}-\varepsilon^p_{n}-(\varepsilon^p_{n+1}-\varepsilon^p_{n})) \\
  = &\mathbf C:\left(\varepsilon_{n+1}-\varepsilon^p_{n}-\Delta\gamma\frac{\xi_{n+1}}{\|\xi_{n+1}\|}\right)\\
  = &\mathbf C:\left(\varepsilon_{n+1}-\varepsilon^p_{n}-\Delta\gamma\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\\
  = &2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf 1 - 2\mu\Delta\gamma\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|} -\lambda\mathrm{tr}\left(\Delta\gamma\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf 1
\end{align*}
\begin{align*}
  \lambda\mathrm{tr}\left(\Delta\gamma\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf 1
  =\lambda\mathrm{tr}\left(\Delta\gamma\frac{\sigma^{\mathrm{trial}}_{n+1}-\frac{1}{3}\mathrm{tr}(\sigma^{\mathrm{trial}}_{n+1})-\beta_{n}}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf 1=0
\end{align*}
\begin{align*}
  \sigma_{n+1} =& 2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf 1 - 2\mu\Delta\gamma\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi^{\mathrm{trial}}_{n+1}\|} \\
  =& 2\mu(\varepsilon_{n+1}-\varepsilon^p_{n}) + \lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon^p_{n})\mathbf 1 - 2\mu\Delta\gamma(\varepsilon_{n+1})\mathbf n_{n+1}(\varepsilon_{n+1})
\end{align*}

\begin{notice}
\begin{align*}
  \sigma_{n+1} =& k\mathrm{tr}(\varepsilon_{n+1})\mathbf 1 + 2 \mu(e_{n+1}-\Delta\gamma\mathbf n_{n+1})\\
  =& k\mathrm{tr}(\varepsilon_{n+1})\mathbf 1 + 2 \mu(\mathrm{dev}(\varepsilon_{n+1})-\Delta\gamma\mathbf n_{n+1})\\
  =& \left(\lambda+\frac{2}{3}\mu\right)\mathrm{tr}(\varepsilon_{n+1})\mathbf 1 + 2 \mu\left(\varepsilon_{n+1}-\frac{1}{3}\mathrm{tr}\left(\varepsilon_{n+1}\right)\mathbf 1-\Delta\gamma\mathbf n_{n+1}\right)\\
  =& 2 \mu\varepsilon_{n+1} + \lambda\mathrm{tr}(\varepsilon_{n+1})\mathbf 1 - 2 \mu\Delta\gamma\mathbf n_{n+1}
\end{align*}
$k=\lambda+\frac{2}{3}\mu$. 在Simo书里很奇怪把$\varepsilon^p_n$都给忽略掉了. 
\end{notice}

\begin{align}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& 2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}} + \lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} - 2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}- 2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
\end{align}

\iffalse
\begin{notice}
  \begin{align*}
    \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& k\mathbf I\otimes\mathbf I + 2\mu\theta_{n+1}\left(\mathbf{II}-\frac{1}{3}\mathbf I\otimes\mathbf I\right) -2\mu\bar\theta_{n+1}\mathbf n_{n+1}\otimes\mathbf n_{n+1}\\
    =& \left(\lambda+\frac{2}{3}\mu\right)\mathbf I\otimes\mathbf I + 2\mu\left(1-\frac{2\mu\Delta\gamma}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\left(\mathbf{II}-\frac{1}{3}\mathbf I\otimes\mathbf I\right) -2\mu\bar\theta_{n+1}\mathbf n_{n+1}\otimes\mathbf n_{n+1}\\
    =& \left(\lambda+\frac{2}{3}\mu\right)\mathbf I\otimes\mathbf I + 2\mu\left(\mathbf{II}-\frac{1}{3}\mathbf I\otimes\mathbf I\right) - \frac{4\mu^2\Delta\gamma}{\|\xi^{\mathrm{trial}}_{n+1}\|}\left(\mathbf{II}-\frac{1}{3}\mathbf I\otimes\mathbf I\right) -2\mu\bar\theta_{n+1}\mathbf n_{n+1}\otimes\mathbf n_{n+1}
  \end{align*}
\end{notice}
\fi

\begin{align}
  \begin{split}
  &2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}}\\
  = &2\mu
  \left(\begin{array}{lll}
    \left(\begin{array}{lll}
    \frac{\partial\varepsilon_{11}}{\partial\varepsilon_{11}} & 0 & 0 \\
    0 & 0 & 0 \\
    0 & 0 & 0 
    \end{array}\right) & \left(\begin{array}{lll}
    0 & \frac{1}{2}\frac{\partial\varepsilon_{12}}{\partial\varepsilon_{12}} & 0 \\
    \frac{1}{2}\frac{\partial\varepsilon_{12}}{\partial\varepsilon_{21}} & 0 & 0 \\
    0 & 0 & 0 
    \end{array}\right) & \left(\begin{array}{lll}
    0 & 0 & \frac{1}{2}\frac{\partial\varepsilon_{13}}{\partial\varepsilon_{13}} \\
    0 & 0 & 0 \\
    \frac{1}{2}\frac{\partial\varepsilon_{13}}{\partial\varepsilon_{31}} & 0 & 0 
    \end{array}\right) \\
     \left(\begin{array}{lll}
    0 & \frac{1}{2}\frac{\partial\varepsilon_{21}}{\partial\varepsilon_{21}} & 0 \\
    \frac{1}{2}\frac{\partial\varepsilon_{21}}{\partial\varepsilon_{12}} & 0 & 0 \\
    0 & 0 & 0 
    \end{array}\right) & \left(\begin{array}{lll}
    0 & 0 & 0 \\
    0 & \frac{\partial\varepsilon_{22}}{\partial\varepsilon_{22}} & 0 \\
    0 & 0 & 0 
    \end{array}\right) & \left(\begin{array}{lll}
    0 & 0 & 0 \\
    0 & 0 & \frac{1}{2}\frac{\partial\varepsilon_{23}}{\partial\varepsilon_{23}} \\
    0 & \frac{1}{2}\frac{\partial\varepsilon_{23}}{\partial\varepsilon_{32}} & 0 
     \end{array}\right) \\
     \left(\begin{array}{lll}
    0 & 0 & \frac{1}{2}\frac{\partial\varepsilon_{31}}{\partial\varepsilon_{31}} \\
    0 & 0 & 0 \\
    \frac{1}{2}\frac{\partial\varepsilon_{31}}{\partial\varepsilon_{13}} & 0 & 0 
    \end{array}\right) & \left(\begin{array}{lll}
    0 & 0 & 0 \\
    0 & 0 & \frac{1}{2}\frac{\partial\varepsilon_{32}}{\partial\varepsilon_{23}} \\
    0 & \frac{1}{2}\frac{\partial\varepsilon_{32}}{\partial\varepsilon_{32}} & 0 
    \end{array}\right) & \left(\begin{array}{lll}
    0 & 0 & 0 \\
    0 & 0 & 0 \\
    0 & 0 & \frac{\partial\varepsilon_{33}}{\partial\varepsilon_{33}} 
    \end{array}\right) 
  \end{array}\right)\\
  =&2\mu\mathbf I
  \end{split}
\end{align}

\begin{align}
  \lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} = \lambda\mathbf 1\otimes\mathbf 1
\end{align}

\begin{align*}
  &\frac{\partial}{\partial\varepsilon_{n+1}}\left\{\|\xi^{\mathrm{trial}}_{n+1}\|  - \left(2\mu\Delta\gamma  + \sqrt{\frac{2}{3}}\left( H\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)-H(\alpha_{n})\right)\right) - \sqrt{\frac{2}{3}}K\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right) \right\}   \\
    =&\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}  - 2\mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}-\frac{2}{3}H'\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}} - \frac{2}{3}K'\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}    
  =0
\end{align*}

\begin{align*}
\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}  
  =\frac{\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}}{2\mu+\frac{2}{3}H'(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma) + \frac{2}{3}K'\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)}
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =\left(\begin{array}{ccc}
    \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{00}}} &   \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{01}}} &   \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{02}}}\\
    \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{10}}} &   \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{11}}} &   \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{12}}}\\
      \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{20}}} &   \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{21}}} &   \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{{n+1}_{22}}}
  \end{array}\right)
\end{align*}

\begin{align*}
  \xi^{\mathrm{trial}}_{n+1}
  =&\mathrm{dev}(\sigma^{\mathrm{trial}}_{n+1})-\beta_n\\
  =&\left(2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)+\lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1-\frac{1}{3}\mathrm{tr}(2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)+\lambda\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1)\mathbf 1-\beta_n\right)\\
  =&2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)-\frac{2}{3}\mu\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1-\beta_n
\end{align*}

\begin{align*}
  \|\xi^{\mathrm{trial}}_{n+1}\|
  =&\sqrt{\sum_{ij}\left(2\mu(\varepsilon_{n+1}-\varepsilon_{n}^p)-\frac{2}{3}\mu\mathrm{tr}(\varepsilon_{n+1}-\varepsilon_{n}^p)\mathbf 1-\beta_n\right)^2_{ij}}
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{{n+1}}\|}{\partial\varepsilon_{n+1}}
  =\frac{1}{2}\frac{1}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}&\left(
  \left(\begin{array}{ccc}2\xi^{\mathrm{trial}}_{{n+1}_{00}}2\mu&2\xi^{\mathrm{trial}}_{{n+1}_{01}}2\mu&2\xi^{\mathrm{trial}}_{{n+1}_{02}}2\mu\\
    2\xi^{\mathrm{trial}}_{{n+1}_{10}}2\mu&2\xi^{\mathrm{trial}}_{{n+1}_{11}}2\mu&2\xi^{\mathrm{trial}}_{{n+1}_{12}}2\mu\\
    2\xi^{\mathrm{trial}}_{{n+1}_{20}}2\mu&2\xi^{\mathrm{trial}}_{{n+1}_{21}}2\mu&2\xi^{\mathrm{trial}}_{{n+1}_{22}}2\mu
  \end{array}\right)\right. + \\ &\left.\left(\begin{array}{ccc}2\sum_i\xi^{\mathrm{trial}}_{{n+1}_{ii}}\left(-\frac{2}{3}\right)\mu&0&0\\
    0&2\sum_i\xi^{\mathrm{trial}}_{{n+1}_{ii}}\left(-\frac{2}{3}\right)\mu&0\\
    0&0&2\sum_i\xi^{\mathrm{trial}}_{{n+1}_{ii}}\left(-\frac{2}{3}\right)\mu\end{array}\right)\right)
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =&\frac{2\mu}{\|\xi^{\mathrm{trial}}_{{n+1}}\|}\left(\xi^{\mathrm{trial}}_{{n+1}} - \frac{1}{3}\mathrm{tr}(\xi^{\mathrm{trial}}_{{n+1}})\mathbf 1\right)
\end{align*}

\begin{align*}
  \frac{1}{3}\mathrm{tr}(\xi^{\mathrm{trial}}_{{n+1}})\mathbf 1
  = \frac{1}{3}\mathrm{tr}(\mathrm{dev}(\sigma^{\mathrm{trial}}_{{n+1}}) + \beta_{n})\mathbf 1
  = \frac{1}{3}\mathrm{tr}\left(\sigma^{\mathrm{trial}}_{{n+1}}-\frac{1}{3}\mathrm{tr}(\sigma^{\mathrm{trial}}_{{n+1}})\mathbf 1\right)\mathbf 1 = 0
\end{align*}

\begin{align*}
  \frac{\partial\|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}
  =&2\mu\mathbf n_{n+1}
\end{align*}

\begin{align}
  \begin{split}
  2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1} =& 2 \mu\frac{\frac{\partial \|\xi^{\mathrm{trial}}_{n+1}\|}{\partial\varepsilon_{n+1}}}{2\mu+\frac{2}{3}H'(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma) + \frac{2}{3}K'\left(\alpha_{n}+\sqrt{\frac{2}{3}}\Delta\gamma\right)}\otimes\mathbf n_{n+1}\\
  =& \frac{2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}}{1+\frac{1}{3\mu}H'(\alpha_{n+1}) + \frac{1}{3\mu}K'\left(\alpha_{n+1}\right)}
  \end{split}
\end{align}

\begin{align*}
  &2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =2 \mu\Delta\gamma\frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{\xi^{\mathrm{trial}}_{n+1}}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)
  =2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\frac{\partial \xi^{\mathrm{trial}}_{n+1}}{\partial\varepsilon_{n+1}}
  + 2 \mu\Delta\gamma\frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}\right)\otimes\xi^{\mathrm{trial}}_{n+1}
\end{align*}

\begin{align*}
  \frac{\partial \xi^{\mathrm{trial}}_{n+1}}{\partial\varepsilon_{n+1}}
 =2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
\end{align*}

\begin{align*}
  \frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)=&
  \frac{\partial}{\partial\varepsilon_{n+1}}\left(\frac{1}{\sqrt{\sum_i\sum_j{\xi^{\mathrm{trial}}_{{n+1}_{ij}}}^2}}\right)\\
  =&\left(\left(-\frac{1}{2}\right)\frac{2\xi^{\mathrm{trial}}_{{n+1}_{ij}}}{\left(\sum_i\sum_j{\xi^{\mathrm{trial}}_{{n+1}_{ij}}}^2\right)^{3/2}}
  \frac{\partial \xi^{\mathrm{trial}}_{{n+1}_{ij}}}{\partial\varepsilon_{{n+1}}}\right)_{ij}\\
  =&-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|^2}\mathbf n_{n+1}
\end{align*}

\begin{align}
  &2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}
  =2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  + 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}
\end{align}

\begin{align}
  \begin{split}
  \frac{\partial\sigma_{n+1}}{\partial\varepsilon_{n+1}} =& 2\mu\frac{\partial\varepsilon_{n+1}}{\partial\varepsilon_{n+1}} + \lambda\frac{\partial\mathrm{tr}(\varepsilon_{n+1})\mathbf 1}{\partial\varepsilon_{n+1}} - 2 \mu\frac{\partial\Delta\gamma}{\partial\varepsilon_{n+1}}\otimes\mathbf n_{n+1}- 2 \mu\Delta\gamma\frac{\partial\mathbf n_{n+1}}{\partial\varepsilon_{n+1}}\\
  =& 2\mu\mathbf I + \lambda\mathbf 1\otimes\mathbf 1 - \frac{2 \mu\mathbf n_{n+1}\otimes\mathbf n_{n+1}}{1+\frac{1}{3\mu}H'(\alpha_{n+1}) + \frac{1}{3\mu}K'\left(\alpha_{n+1}\right)}  \\
  & -2 \mu\Delta\gamma\frac{1}{\|\xi_{n+1}^{\mathrm{trial}}\|}2\mu\left(\mathbf I - \frac{1}{3}\mathbf 1\otimes\mathbf 1\right)
  - 2 \mu\Delta\gamma\left(-\frac{2\mu}{\|\xi^{\mathrm{trial}}_{n+1}\|}\right)\mathbf n_{n+1}\otimes\mathbf n_{n+1}
  \end{split}
\end{align}







\clearpage
\subsubsection{算例}




\clearpage
\section{热力耦合方程}

\subsection{偏微分方程和边界条件}
这里需要注意的是方程中$\mathbf\sigma$不是全部应力，是去掉温度场影响后的应力。
\begin{align*}
  & -\nabla\cdot\mathbf \sigma = \mathbf b \\
  & \rho c\frac{\ud T}{\ud t} + \nabla\cdot \left(\mathbf K \nabla T\right)  = r\\
  & \varepsilon_T = \alpha(T-T_0)\delta_{ij} \\
  &\mathbf\sigma = \mathbf D(\mathbf\varepsilon-\mathbf\varepsilon_T)
\end{align*}

\begin{align*}
  \mathbf\sigma =& \mathbf D(\mathbf\varepsilon-\mathbf\varepsilon_T)\\
  =&2\mu(\mathbf\varepsilon-\mathbf\varepsilon_T) + \lambda\mathrm{tr}(\mathbf \varepsilon-\mathbf\varepsilon_T)\mathbf 1\\
  =&2\mu\mathbf\varepsilon + \lambda\mathrm{tr}(\mathbf \varepsilon)\mathbf 1 - 2\mu\mathbf\varepsilon_T - \lambda\mathrm{tr}(\mathbf\varepsilon_T)\mathbf 1\\
  =&2\mu\mathbf\varepsilon + \lambda\mathrm{tr}(\mathbf \varepsilon)\mathbf 1 - 2\mu\mathbf\varepsilon_T - \lambda3\alpha (T-T_0)\mathbf 1
\end{align*}

\subsection{变分形式}
\begin{align*}
    -\int_{\Omega}\nabla\cdot\mathbf \sigma\cdot\mathbf v\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x \\
    -\int_{\Gamma}\mathbf\sigma\cdot\mathbf n\cdot\mathbf v\ud s_x      +\int_{\Omega}\mathbf\sigma:\mathbf\varepsilon(\mathbf v)\ud x =& \int_{\Omega}\mathbf b\cdot\mathbf v\ud x\\
  \int_{\Omega}\left(2\mu\mathbf \varepsilon(\mathbf u) :\mathbf\varepsilon(\mathbf v)+\lambda\nabla\cdot\mathbf u \nabla\cdot\mathbf v\right)\ud x =&
  \int_{\Gamma} \alpha(T-T_0)(3\lambda+2\mu)\mathbf 1:\mathbf\varepsilon(\mathbf v)\ud x + \int_{\Gamma}\mathbf t\cdot\mathbf v\ud s_x + \int_{\Omega}\mathbf b\cdot\mathbf v\ud x
\end{align*}
\begin{align*}
  \int_{\Omega}(-\nabla\cdot(2\mu\mathbf\varepsilon + \lambda\mathrm{tr}(\mathbf \varepsilon)\mathbf 1))\cdot\mathbf v \ud x
  = \int_{\Omega}\mathbf b\cdot\mathbf v\ud x  + \int_{\Omega} T\nabla\cdot\mathbf v \ud x - \int_{\Gamma}\mathbf n\cdot\mathbf v T\ud s_x 
\end{align*}
\begin{align*}
  \int_{\Omega}\frac{\ud T}{\ud t}v\ud x - \int_{\Omega}\nabla\cdot \left(\nabla T\right)v\ud x   =& \int_{\Omega}rv\ud x \\
  \int_{\Omega}\frac{\ud T}{\ud t}v\ud x + \int_{\Omega}\nabla T\cdot\nabla v\ud x   =& \int_{\Omega}rv\ud x + \int_{\Gamma}\mathbf n\cdot\nabla T v\ud s_x 
\end{align*}

\subsection{有限元离散}
\subsection{线性方程组}
\subsection{算例}


\begin{problem}[热应力2D和Abaqus比较]
杨氏模量为2.5，泊松比为0.25，热传导为1，比热为1，密度为1，膨胀系数为1，底部固定，上边温度为1，左右下边热流为0，上边方向向上拖拽力为0.1。  
\end{problem}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:1.png}
    \caption{$T$，level 5-6，$\mathrm{time}=0.5$, $T_{max}=0.6247779726982117$}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:2.png}
    \caption{$\mathbf u$，level 5-6，$\mathrm{time}=0.5$, $\|\mathbf u\|_{max}=1.1456380793904821$}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:3.png}
    \caption{$T$，$h=0.025$, $k=0.0125$，$\mathrm{time}=0.5$, $T_{max}=6.221\mathrm e-01$}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:4.png}
    \caption{$\mathbf u$，level 5-6，$\mathrm{time}=0.5$, $\|\mathbf u\|_{max}=1.144$}
\end{figure}


\begin{problem}[热应力3D和Abaqus比较]
杨氏模量为2.5，泊松比为0.25，热传导为1，比热为1，密度为1，膨胀系数为1，底部固定，上边温度为1，左右下边热流为0，上边方向向上拖拽力为0.1。  
\end{problem}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:5.png}
    \caption{$T$，level 0-6，$\mathrm{time}=0.5$, $T_{max}=0.6236979961395264$}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:6.png}
    \caption{$\mathbf u$，level 0-6，$\mathrm{time}=0.5$, $\|\mathbf u\|_{max}=1.1469914204042906$}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:7.png}
    \caption{$T$，$h=0.05$, $k=0.0125$，$\mathrm{time}=0.5$, $T_{max}=6.218\mathrm e-01$}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4cm]{fig/3/3.10/3.10.5:8.png}
    \caption{$\mathbf u$，$h=0.05$, $k=0.0125$，$\mathrm{time}=0.5$, $\|\mathbf u\|_{max}=1.144$}
\end{figure}

\begin{problem}[薄壁件热应力]
以下三个图是三个不同时间点热源移动到不同位置时薄壁件热应力变形。
\end{problem}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:9.png}
    \caption{薄壁件热应力，第一时间点}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:10.png}
    \caption{薄壁件热应力，第二时间点}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:11.png}
    \caption{薄壁件热应力，第三时间点}
\end{figure}

\begin{problem}[圆柱薄壁小件热应力]
以下三个图是三个不同时间点热源移动到不同位置时圆柱薄壁小件热应力变形。
\end{problem}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:12.png}
    \caption{薄壁件热应力，第一时间点}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:13.png}
    \caption{薄壁件热应力，第二时间点}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:14.png}
    \caption{薄壁件热应力，第三时间点}
\end{figure}

\begin{problem}[圆柱薄壁大件热应力]
以下三个图是三个不同时间点热源移动到不同位置时圆柱薄壁大件热应力变形。
\end{problem}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:15.png}
    \caption{薄壁件热应力，第一时间点}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:16.png}
    \caption{薄壁件热应力，第二时间点}
\end{figure}

\begin{figure}[!htbp]
  \centering
    \includegraphics[height=4.5cm]{fig/3/3.10/3.10.5:17.png}
    \caption{薄壁件热应力，第三时间点}
\end{figure}

\clearpage
\section{切削仿真}

\begin{figure}[!htbp]
  \centering
  \subfigure[machining 1]{
    \label{}
    \includegraphics[height=4cm]{fig/3/3.10/1.png}
  }
  \subfigure[machining 2]{
    \label{}
    \includegraphics[height=4cm]{fig/3/3.10/2.png}
  }
  \subfigure[machining 3]{
    \label{}
    \includegraphics[height=4cm]{fig/3/3.10/3.png}
  }
  \subfigure[machining 4]{
    \label{}
    \includegraphics[height=4cm]{fig/3/3.10/4.png}
  }
  \caption{machining}
  \label{}
\end{figure}

